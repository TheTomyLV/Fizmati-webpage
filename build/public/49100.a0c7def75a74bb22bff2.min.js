(self.webpackChunknodebb=self.webpackChunknodebb||[]).push([[49100,70565,83014,99617],{74344:(B,b,l)=>{"use strict";l.r(b),l.d(b,{del:()=>T,get:()=>f,head:()=>i,patch:()=>P,post:()=>c,put:()=>h});var C=l(85233),w=l.n(C),v=l(63281),g=l.n(v);const p=config.relative_path+"/api/v3";async function s(t,a){if(t.url=t.url.startsWith("/api")?config.relative_path+t.url:p+t.url,typeof a=="function"){m(t).then(n=>a(null,n),n=>a(n));return}try{return await m(t)}catch(n){if(n.message==="A valid login session was not found. Please log in and try again.")return(0,v.confirm)("[[error:api.reauth-required]]",o=>{o&&ajaxify.go("login")});throw n}}async function m(t){const{url:a}=t;delete t.url,t.data&&!(t.data instanceof FormData)&&(t.data=JSON.stringify(t.data||{}),t.headers["content-type"]="application/json; charset=utf-8"),{options:t}=await(0,C.fire)("filter:api.options",{options:t}),t.data&&(t.body=t.data,delete t.data);const n=await fetch(a,t),{headers:o}=n,E=o.get("content-type"),k=E&&E.startsWith("application/json");let d;if(t.method!=="head"&&(k?d=await n.json():d=await n.text()),!n.ok)throw d?new Error(k?d.status.message:d):new Error(n.statusText);return k&&d&&d.hasOwnProperty("status")&&d.hasOwnProperty("response")?d.response:d}function f(t,a,n){return s({url:t+(a&&Object.keys(a).length?"?"+$.param(a):"")},n)}function i(t,a,n){return s({url:t+(a&&Object.keys(a).length?"?"+$.param(a):""),method:"head"},n)}function c(t,a,n){return s({url:t,method:"post",data:a,headers:{"x-csrf-token":config.csrf_token}},n)}function P(t,a,n){return s({url:t,method:"patch",data:a,headers:{"x-csrf-token":config.csrf_token}},n)}function h(t,a,n){return s({url:t,method:"put",data:a,headers:{"x-csrf-token":config.csrf_token}},n)}function T(t,a,n){return s({url:t,method:"delete",data:a,headers:{"x-csrf-token":config.csrf_token}},n)}},69986:(B,b,l)=>{"use strict";var C,w;C=[l(32230),l(7237),l(42840),l(16943),l(85233),l(7927)],w=function(v,g,p,s,m,f){const i={};let c={};const P=({notifications:t})=>new Promise(a=>{for(let n=0;n<t.length;n+=1)t[n].timeagoLong=$.timeago(new Date(parseInt(t[n].datetime,10)));v.toggleTimeagoShorthand(function(){for(let n=0;n<t.length;n+=1)t[n].timeago=$.timeago(new Date(parseInt(t[n].datetime,10))),t[n].timeagoShort=t[n].timeago;v.toggleTimeagoShorthand(),a({notifications:t})})});m.on("filter:notifications.load",P),i.loadNotifications=function(t,a){a=a||function(){},socket.emit("notifications.get",null,function(n,o){if(n)return f.error(n);const E=o.unread.concat(o.read).sort(function(k,d){return parseInt(k.datetime,10)>parseInt(d.datetime,10)?-1:1});m.fire("filter:notifications.load",{notifications:E}).then(({notifications:k})=>{app.parseAndTranslate("partials/notifications_list",{notifications:k},function(d){t.html(d),t.off("click").on("click","[data-nid]",function(R){const F=$(this);if(T(F)&&(R.stopPropagation(),R.preventDefault(),g.get("notifications/list").dropdown("toggle")),!F.hasClass("unread"))return;const x=F.attr("data-nid");h(x,!0)}),g.get("notifications").on("click",".mark-all-read",i.markAllRead),i.handleUnreadButton(t),m.fire("action:notifications.loaded",{notifications:E,list:t}),a()})})})},i.handleUnreadButton=function(t){t.on("click",".mark-read",function(){const a=$(this),n=a.parents("[data-nid]"),o=n.hasClass("unread"),E=n.attr("data-nid");return h(E,o,function(){n.toggleClass("unread"),a.find(".unread").toggleClass("hidden",o),a.find(".read").toggleClass("hidden",!o)}),!1})},i.onNewNotification=function(t){ajaxify.currentPage==="notifications"&&ajaxify.refresh(),!(ajaxify.data.template.chats&&parseInt(ajaxify.data.roomId,10)===parseInt(t.roomId,10))&&(socket.emit("notifications.getCount",function(a,n){if(a)return f.error(a);i.updateNotifCount(n)}),c[t.nid]||(c[t.nid]=!0))},i.markNotification=function(t,a,n){h(t,a,n)};function h(t,a,n){socket.emit("notifications.mark"+(a?"Read":"Unread"),t,function(o){if(o)return f.error(o);a&&c[t]&&delete c[t],n&&n()})}function T(t){const a=t.attr("data-pid"),n=t.attr("data-path"),o=g.get("post","pid",a);return n.startsWith(config.relative_path+"/post/")&&a&&o.length&&ajaxify.data.template.topic?(p.scrollToIndex(o.attr("data-index"),!0),!0):!1}return i.updateNotifCount=function(t){const a=g.get("notifications/icon");t=Math.max(0,t),a.toggleClass("fa-bell",t>0).toggleClass("fa-bell-o",t<=0);const n=t>99?"99+":t;a.toggleClass("unread-count",t>0),a.attr("data-content",n),g.get("notifications/count").toggleClass("hidden",t<=0).text(n);const o={count:t,updateFavicon:!0};m.fire("action:notification.updateCount",o),o.updateFavicon&&s.setBubble(n),p.setAppBadge&&p.setAppBadge(t)},i.markAllRead=function(){socket.emit("notifications.markAllRead",function(t){t&&f.error(t),c={};const a=$('[component="notifications/list"] [data-nid]');a.removeClass("unread"),a.find(".mark-read .unread").addClass("hidden"),a.find(".mark-read .read").removeClass("hidden")})},i}.apply(b,C),w!==void 0&&(B.exports=w)},16943:(B,b,l)=>{var C,w;/*!
* Tinycon - A small library for manipulating the Favicon
* Tom Moor, http://tommoor.com
* Copyright (c) 2015 Tom Moor
* @license MIT Licensed
*/(function(){var v={},g=null,p=null,s=null,m=null,f={},i=Math.ceil(window.devicePixelRatio)||1,c=16*i,P={width:7,height:9,font:10*i+"px arial",color:"#ffffff",background:"#F03D25",fallback:!0,crossOrigin:!0,abbreviate:!0},h=function(){var e=navigator.userAgent.toLowerCase();return function(r){return e.indexOf(r)!==-1}}(),T={ie:h("trident"),chrome:h("chrome"),webkit:h("chrome")||h("safari"),safari:h("safari")&&!h("chrome"),mozilla:h("mozilla")&&!h("chrome")&&!h("safari")},t=function(){for(var e=document.getElementsByTagName("link"),r=0,u=e.length;r<u;r++)if((e[r].getAttribute("rel")||"").match(/\bicon\b/i))return e[r];return!1},a=function(){for(var e=document.getElementsByTagName("link"),r=0,u=e.length;r<u;r++){var O=typeof e[r]<"u";O&&(e[r].getAttribute("rel")||"").match(/\bicon\b/i)&&e[r].parentNode.removeChild(e[r])}},n=function(){if(!p||!g){var e=t();g=e?e.getAttribute("href"):"/favicon.ico",p||(p=g)}return g},o=function(){return m||(m=document.createElement("canvas"),m.width=c,m.height=c),m},E=function(e){if(e){a();var r=document.createElement("link");r.type="image/x-icon",r.rel="icon",r.href=e,document.getElementsByTagName("head")[0].appendChild(r)}},k=function(e){window.console&&window.console.log(e)},d=function(e,O){if(!o().getContext||T.ie||T.safari||f.fallback==="force")return R(e);var u=o().getContext("2d"),O=O||"#000000",_=n();s=document.createElement("img"),s.onload=function(){u.clearRect(0,0,c,c),u.drawImage(s,0,0,s.width,s.height,0,0,c,c),(e+"").length>0&&F(u,e,O),M()},!_.match(/^data/)&&f.crossOrigin&&(s.crossOrigin="anonymous"),s.src=_},R=function(e){if(f.fallback){var r=document.title;r[0]==="("&&(r=r.slice(r.indexOf(" "))),(e+"").length>0?document.title="("+e+") "+r:document.title=r}},F=function(e,r,u){typeof r=="number"&&r>99&&f.abbreviate&&(r=x(r));var O=(r+"").length-1,_=f.width*i+6*i*O,W=f.height*i,D=c-W,I=c-_-i,A=16*i,N=16*i,y=2*i;e.font=(T.webkit?"bold ":"")+f.font,e.fillStyle=f.background,e.strokeStyle=f.background,e.lineWidth=i,e.beginPath(),e.moveTo(I+y,D),e.quadraticCurveTo(I,D,I,D+y),e.lineTo(I,A-y),e.quadraticCurveTo(I,A,I+y,A),e.lineTo(N-y,A),e.quadraticCurveTo(N,A,N,A-y),e.lineTo(N,D+y),e.quadraticCurveTo(N,D,N-y,D),e.closePath(),e.fill(),e.beginPath(),e.strokeStyle="rgba(0,0,0,0.3)",e.moveTo(I+y/2,A),e.lineTo(N-y/2,A),e.stroke(),e.fillStyle=f.color,e.textAlign="right",e.textBaseline="top",e.fillText(r,i===2?29:15,T.mozilla?7*i:6*i)},M=function(){o().getContext&&E(o().toDataURL())},x=function(e){for(var r=[["G",1e9],["M",1e6],["k",1e3]],u=0;u<r.length;++u)if(e>=r[u][1]){e=S(e/r[u][1])+r[u][0];break}return e},S=function(e,r){var u=new Number(e);return u.toFixed(r)};v.setOptions=function(e){f={},e.colour&&(e.color=e.colour);for(var r in P)f[r]=e.hasOwnProperty(r)?e[r]:P[r];return this},v.setImage=function(e){return g=e,M(),this},v.setBubble=function(e,r){return e=e||"",d(e,r),this},v.reset=function(){g=p,E(p)},v.setOptions(P),C=v,w=typeof C=="function"?C.call(b,l,b,B):C,w!==void 0&&(B.exports=w)})()}}]);
