"use strict";(self.webpackChunknodebb=self.webpackChunknodebb||[]).push([[18099],{35127:(H,K,s)=>{var D,C;D=[s(27145),s(32230),s(22143),s(45482),s(47913),s(88186),s(98755),s(83713),s(38259),s(2585),s(98166),s(84964),s(75203),s(62023),s(74344),s(63281),s(7927),s(85233),s(44882),s(7073),s(10577)],C=function(w,A,S,E,v,f,B,c,r,n,d,m,x,y,P,L,a,l,p,W,k){var i={active:void 0,posts:{},bsEnvironment:void 0,formatting:void 0};$(window).off("resize",G).on("resize",G),G(),$(window).on("action:composer.topics.post",function(e,t){localStorage.removeItem("category:"+t.data.cid+":bookmark"),localStorage.removeItem("category:"+t.data.cid+":bookmark:clicked")}),$(window).on("popstate",function(){var e=utils.findBootstrapEnvironment();if(i.active&&(e==="xs"||e==="sm")){if(!i.posts[i.active].modified){i.discard(i.active),i.discardConfirm&&i.discardConfirm.length&&(i.discardConfirm.modal("hide"),delete i.discardConfirm);return}A.translate("[[modules:composer.discard]]",function(t){i.discardConfirm=L.confirm(t,function(o){o?i.discard(i.active):i.posts[i.active].modified=!0}),i.posts[i.active].modified=!1})}});function N(){var e=i.bsEnvironment;(ajaxify.data.template.compose===!0||e==="xs"||e==="sm")&&history.back()}function G(){var e=utils.findBootstrapEnvironment(),t=e==="xs"||e==="sm";c.toggle&&(c.env!==e&&t&&(c.env=e,c.toggle(!1)),c.env=e),i.active!==void 0&&(r.reposition($('.composer[data-uuid="'+i.active+'"]')),!t&&window.location.pathname.startsWith(config.relative_path+"/compose")?history.back():t&&!window.location.pathname.startsWith(config.relative_path+"/compose")&&ne()),i.bsEnvironment=e}function g(e){var t,o;e.hasOwnProperty("cid")?t="cid":e.hasOwnProperty("tid")?t="tid":e.hasOwnProperty("pid")&&(t="pid"),o=e[t];for(var h in i.posts)if(i.posts[h].hasOwnProperty(t)&&o===i.posts[h][t])return h;return!1}function u(e){if(e){var t=utils.generateUUID(),o=g(e);if(o)return w.updateActive(o),i.load(o);var h="[[topic:composer.new-topic]]";e.action==="posts.reply"?h="[[topic:composer.replying-to]]":e.action==="posts.edit"&&(h="[[topic:composer.editing-in]]"),A.translate(h,function(I){w.push("composer",t,{title:I.replace("%1",'"'+e.title+'"')})}),i.posts[t]=e,i.load(t)}}async function b(e,t){$('.composer[data-uuid="'+e+'"]').find(".composer-submit").removeAttr("disabled");const{showAlert:o}=await l.fire("filter:composer.error",{post_uuid:e,message:t,showAlert:!0});o&&a.alert({type:"danger",timeout:1e4,title:"",message:t,alert_id:"post_error"})}i.findByTid=function(e){for(var t in i.posts)if(i.posts.hasOwnProperty(t)&&i.posts[t].hasOwnProperty("tid")&&parseInt(i.posts[t].tid,10)===parseInt(e,10))return t;return null},i.addButton=function(e,t,o){E.addButton(e,t,o)},i.newTopic=async e=>{let t={save_id:e.save_id,action:"topics.post",cid:e.cid,handle:e.handle,title:e.title||"",body:e.body||"",tags:e.tags||[],modified:!!(e.title&&e.title.length||e.body&&e.body.length),isMain:!0};({pushData:t}=await l.fire("filter:composer.topic.push",{data:e,pushData:t})),u(t)},i.addQuote=function(e){e.uuid=e.uuid||i.active;var t=(e.title||"").replace(/([\\`*_{}[\]()#+\-.!])/g,"\\$1").replace(/\[/g,"&#91;").replace(/\]/g,"&#93;").replace(/%/g,"&#37;").replace(/,/g,"&#44;");e.body&&(e.body="> "+e.body.replace(/\n/g,`
> `)+`

`);var o="["+t+"]("+config.relative_path+"/post/"+(e.selectedPid||e.toPid)+")";if(e.uuid===void 0){e.title&&(e.selectedPid||e.toPid)?i.newReply({tid:e.tid,toPid:e.toPid,title:e.title,body:"[[modules:composer.user-said-in, "+e.username+", "+o+`]]
`+e.body}):i.newReply({tid:e.tid,toPid:e.toPid,title:e.title,body:"[[modules:composer.user-said, "+e.username+`]]
`+e.body});return}else e.uuid!==i.active&&i.load(e.uuid);var h=$('.composer[data-uuid="'+e.uuid+'"]'),I=h.find("textarea"),T=I.val();e.title&&(e.selectedPid||e.toPid)?A.translate("[[modules:composer.user-said-in, "+e.username+", "+o+`]]
`,config.defaultLang,M):A.translate("[[modules:composer.user-said, "+e.username+`]]
`,config.defaultLang,M);function M(X){i.posts[e.uuid].body=(T.length?T+`

`:"")+X+e.body,I.val(i.posts[e.uuid].body),O(h),c.render(h)}},i.newReply=function(e){A.translate(e.body,config.defaultLang,function(t){u({save_id:e.save_id,action:"posts.reply",tid:e.tid,toPid:e.toPid,title:e.title,body:t,modified:!!(t&&t.length),isMain:!1})})},i.editPost=function(e){socket.emit("plugins.composer.push",e.pid,function(t,o){if(t)return a.error(t);o.save_id=e.save_id,o.action="posts.edit",o.pid=e.pid,o.modified=!1,e.body&&(o.body=e.body,o.modified=!0),e.title&&(o.title=e.title,o.modified=!0),u(o)})},i.load=function(e){var t=$('.composer[data-uuid="'+e+'"]');t.length?(j(e),r.reposition(t),O(t),q()):i.formatting?ie(e):socket.emit("plugins.composer.getFormattingOptions",function(o,h){if(o)return a.error(o);i.formatting=h,ie(e)})},i.enhance=function(e,t,o){!t&&!o&&(t=utils.generateUUID(),i.posts[t]=ajaxify.data,o=ajaxify.data,e.attr("data-uuid",t)),B.init(e,i.posts[t]),d.init(e,i.posts),E.addHandler(e),E.addComposerButtons(),c.handleToggler(e),m.showAlert(e,o),S.initialize(t),f.init(e,i.posts[t]),n.init(e,t),e.on("change","input, textarea",function(){i.posts[t].modified=!0}),e.on("click",".composer-submit",function(T){T.preventDefault(),T.stopPropagation(),$(this).attr("disabled",!0),R(t)}),s.e(42441).then(function(){var T=[s(42441)];(function(M){M(e.get(0)).bind("mod+enter",function(){e.find(".composer-submit").attr("disabled",!0),R(t)})}).apply(null,T)}).catch(s.oe),e.find(".composer-discard").on("click",function(T){if(T.preventDefault(),!i.posts[t].modified)return i.discard(t),N();E.exitFullscreen();var M=$(this).prop("disabled",!0);A.translate("[[modules:composer.discard]]",function(X){L.confirm(X,function(_){_&&(i.discard(t),N()),M.prop("disabled",!1)})})}),e.find(".composer-minimize, .minimize .trigger").on("click",function(T){T.preventDefault(),T.stopPropagation(),i.minimize(t)});const h=e.find("textarea");h.on("input propertychange",utils.debounce(function(){c.render(e)},250)),h.on("scroll",function(){c.matchScroll(e)}),v.init(e,o);const I=v.get(o.save_id);c.render(e,function(){c.matchScroll(e)}),re(e),Z(e),O(e),o.action==="posts.edit"&&i.updateThumbCount(t,e),k.isEnabled||$('[data-format="zen"]').addClass("hidden"),l.fire("action:composer.enhanced",{postContainer:e,postData:o,draft:I})};async function V(e){return ajaxify.data.template.category&&parseInt(e.cid,10)===parseInt(ajaxify.data.cid,10)?ajaxify.data:parseInt(e.cid,10)?await P.get(`/api/category/${e.cid}`,{}):null}async function ie(e){var t=i.posts[e],o=t?t.hasOwnProperty("cid"):!1,h=t?!!t.isMain:!1,I=t?!!t.pid:!1,T=t?parseInt(t.uid,10)===0:!1;const M=t.timestamp>Date.now();var X=t.title.replace(/%/g,"&#37;").replace(/,/g,"&#44;");t.category=await V(t);const _=t.category?t.category.privileges:ajaxify.data.privileges;var z={topicTitle:X,titleLength:X.length,body:utils.escapeHTML(t.body),mobile:i.bsEnvironment==="xs"||i.bsEnvironment==="sm",resizable:!0,thumb:t.thumb,isTopicOrMain:o||h,maximumTitleLength:config.maximumTitleLength,maximumPostLength:config.maximumPostLength,minimumTagLength:config.minimumTagLength,maximumTagLength:config.maximumTagLength,"composer:showHelpTab":config["composer:showHelpTab"],isTopic:o,isEditing:I,canSchedule:!!(h&&_&&(_["topics:schedule"]&&!I||M&&_.view_scheduled)),showHandleInput:config.allowGuestHandles&&(app.user.uid===0||I&&T&&app.user.isAdmin),handle:t?t.handle||"":void 0,formatting:i.formatting,tagWhitelist:t.category?t.category.tagWhitelist:ajaxify.data.tagWhitelist,privileges:app.user.privileges,selectedCategory:t.category,submitOptions:[]};z.mobile&&(ne(),app.toggleNavbar(!1)),t.mobile=i.bsEnvironment==="xs"||i.bsEnvironment==="sm",{postData:t,createData:z}=await l.fire("filter:composer.create",{postData:t,createData:z}),app.parseAndTranslate("composer",z,function(F){if(!$('.composer.composer[data-uuid="'+e+'"]').length){F=$(F),F.find(".title").each(function(){$(this).text(A.unescape($(this).text()))}),F.attr("data-uuid",e),$(document.body).append(F);var U=$(F[0]);if(r.reposition(U),i.enhance(U,e,t),j(e),U.on("click",function(){w.isActive(e)||w.updateActive(e)}),r.handleResize(U),i.bsEnvironment==="xs"||i.bsEnvironment==="sm"){var Y=U.find(".composer-submit"),Q=U.find(".mobile-navbar .composer-submit"),oe=U.find(".write"),te=oe.attr("tabindex");Y.removeAttr("tabindex"),Q.attr("tabindex",parseInt(te,10)+1)}$(window).trigger("action:composer.loaded",{postContainer:U,post_uuid:e,composerData:i.posts[e],formatting:i.formatting}),x.apply(U.find(".write")),O(U),q()}})}function ne(){var e="compose?p="+window.location.pathname,t=window.location.pathname.slice(1)+window.location.search;t.startsWith(config.relative_path.slice(1))&&(t=t.slice(config.relative_path.length)),window.history.replaceState({url:null,returnPath:t},t,config.relative_path+"/"+t),window.history.pushState({url:e},e,`${config.relative_path}/${t}`)}function re(e){e.find('[data-action="help"]').on("click",async function(){const o=await socket.emit("plugins.composer.renderHelp");o&&o.length>0&&L.dialog({size:"large",message:o,onEscape:!0,backdrop:!0})})}function Z(e){var t=e.attr("data-uuid"),o=i.posts[t]&&i.posts[t].action==="posts.edit",h=utils.findBootstrapEnvironment(),I=h==="xs"||h==="sm";o||I||W.enableQuickSearch({searchElements:{inputEl:e.find("input.title"),resultEl:e.find(".quick-search-container")},searchOptions:{composer:1},hideOnNoMatches:!0,hideDuringSearch:!0})}function j(e){i.active&&i.active!==e&&i.minimize(i.active),i.active=e;const t=$('.composer[data-uuid="'+e+'"]');t.css("visibility","visible"),$(window).trigger("action:composer.activate",{post_uuid:e,postContainer:t})}function O(e){setTimeout(function(){var t=e.find("input.title");t.length?t.focus():e.find("textarea").focus().putCursorAtEnd()},20)}async function R(e){var t=i.posts[e],o=$('.composer[data-uuid="'+e+'"]'),h=o.find(".handle"),I=o.find(".title"),T=o.find("textarea"),M=o.find("input#topic-thumb-url"),X=t.hasOwnProperty("template")&&t.template.compose===!0;const _=o.find(".composer-submit");I.val(I.val().trim()),T.val(utils.rtrim(T.val())),M.length&&M.val(M.val().trim());var z=t.action,F=(t.hasOwnProperty("cid")||parseInt(t.pid,10))&&o.find("input.title").length,U=!F||F&&parseInt(t.cid,10),Y={post_uuid:e,postData:t,postContainer:o,titleEl:I,titleLen:I.val().length,bodyEl:T,bodyLen:T.val().length};if(await l.fire("filter:composer.check",Y),$(window).trigger("action:composer.check",Y),Y.error)return b(e,Y.error);if(S.inProgress[e]&&S.inProgress[e].length)return b(e,"[[error:still-uploading]]");if(F&&Y.titleLen<parseInt(config.minimumTitleLength,10))return b(e,"[[error:title-too-short, "+config.minimumTitleLength+"]]");if(F&&Y.titleLen>parseInt(config.maximumTitleLength,10))return b(e,"[[error:title-too-long, "+config.maximumTitleLength+"]]");if(z==="topics.post"&&!U)return b(e,"[[error:category-not-selected]]");if(Y.bodyLen<parseInt(config.minimumPostLength,10))return b(e,"[[error:content-too-short, "+config.minimumPostLength+"]]");if(Y.bodyLen>parseInt(config.maximumPostLength,10))return b(e,"[[error:content-too-long, "+config.maximumPostLength+"]]");if(F&&!f.isEnoughTags(e))return b(e,"[[error:not-enough-tags, "+f.minTagCount()+"]]");if(d.isActive()&&d.getTimestamp()<=Date.now())return b(e,"[[error:scheduling-to-past]]");let Q={uuid:e},oe="post",te="";z==="topics.post"?(te="/topics",Q={...Q,handle:h?h.val():void 0,title:I.val(),content:T.val(),thumb:M.val()||"",cid:B.getSelectedCid(),tags:f.getTags(e),timestamp:d.getTimestamp()}):z==="posts.reply"?(te=`/topics/${t.tid}`,Q={...Q,tid:t.tid,handle:h?h.val():void 0,content:T.val(),toPid:t.toPid}):z==="posts.edit"&&(oe="put",te=`/posts/${t.pid}`,Q={...Q,pid:t.pid,handle:h?h.val():void 0,content:T.val(),title:I.val(),thumb:M.val()||"",tags:f.getTags(e),timestamp:d.getTimestamp()});var ae={composerEl:o,action:z,composerData:Q,postData:t,redirect:!0};await l.fire("filter:composer.submit",ae),l.fire("action:composer.submit",Object.freeze(ae));var ce=$('#taskbar .composer[data-uuid="'+e+'"] i'),se=o.find(".write");ce.removeClass("fa-plus").addClass("fa-circle-o-notch fa-spin"),i.minimize(e),se.prop("readonly",!0),P[oe](te,Q).then(J=>{_.removeAttr("disabled"),t.submitted=!0,i.discard(e),v.removeDraft(t.save_id),J.queued?a.alert({type:"success",title:"[[global:alert.success]]",message:J.message,timeout:1e4,clickfn:function(){ajaxify.go(`/post-queue/${J.id}`)}}):z==="topics.post"?ae.redirect&&ajaxify.go("topic/"+J.slug,void 0,X||i.bsEnvironment==="xs"||i.bsEnvironment==="sm"):z==="posts.reply"?X||i.bsEnvironment==="xs"||i.bsEnvironment==="sm"?window.history.back():ae.redirect&&(ajaxify.data.template.name!=="topic"||ajaxify.data.template.topic&&parseInt(t.tid,10)!==parseInt(ajaxify.data.tid,10))&&ajaxify.go("post/"+J.pid):N(),l.fire("action:composer."+z,{composerData:Q,data:J})}).catch(J=>{if(i.load(e),se.prop("readonly",!1),J.message==="[[error:email-not-confirmed]]")return p.showEmailConfirmWarning(J.message);b(e,J.message)})}function q(){$("html").addClass("composing")}function ee(){$("#content").css({paddingBottom:0}),$("html").removeClass("composing"),app.toggleNavbar(!0),E.exitFullscreen()}return i.discard=function(e){if(i.posts[e]){var t=i.posts[e],o=$('.composer[data-uuid="'+e+'"]');o.remove(),v.removeDraft(t.save_id),y.deleteAll(e),w.discard("composer",e),$('[data-action="post"]').removeAttr("disabled"),l.fire("action:composer.discard",{post_uuid:e,postData:t}),delete i.posts[e],i.active=void 0}d.reset(),ee()},i.close=i.discard,i.minimize=function(e){var t=$('.composer[data-uuid="'+e+'"]');t.css("visibility","hidden"),i.active=void 0,w.minimize("composer",e),$(window).trigger("action:composer.minimize",{post_uuid:e}),ee()},i.minimizeActive=function(){i.active&&i.miminize(i.active)},i.updateThumbCount=function(e,t){const o=i.posts[e];if(o.action==="topics.post"||o.action==="posts.edit"&&o.isMain){const h=[y.get(e)];o.pid&&h.push(y.getByPid(o.pid)),Promise.all(h).then(I=>{I=I.reduce((T,M)=>(T=T.concat(M),T)),I.length&&t.find('[data-format="thumbs"]').find(".badge").text(I.length).toggleClass("hidden",!I.length)})}},i}.apply(K,D),C!==void 0&&(H.exports=C)},77678:(H,K,s)=>{var D,C;D=[s(50548),s(27145),s(74344)],C=function(w,A,S){var E={},v;E.init=function(r,n){var d=r.find(".category-list-container");d.length&&(r.on("action:composer.resize",function(){f(r)}),E.updateTaskbar(r,n),v=w.init(d.find('[component="category-selector"]'),{privilege:"topics:create",states:["watching","notwatching","ignoring"],onSelect:function(m){n.hasOwnProperty("cid")&&c(r,n,m)}}),v&&(n.cid&&n.category?v.selectedCategory={cid:n.cid,name:n.category.name}:ajaxify.data.template.compose&&ajaxify.data.selectedCategory&&(v.selectedCategory={cid:ajaxify.data.cid,name:ajaxify.data.selectedCategory}),r.find(".category-name").translateText(v.selectedCategory?v.selectedCategory.name:"[[modules:composer.select-category]]").on("click",function(){w.modal({privilege:"topics:create",states:["watching","notwatching","ignoring"],openOnLoad:!0,showLinks:!1,onSubmit:function(m){r.find(".category-name").text(m.name),v.selectCategory(m.cid),n.hasOwnProperty("cid")&&c(r,n,m)}})}),f(r)))};function f(r){r.find('.category-list-container [component="category-selector"]').toggleClass("dropup",r.outerHeight()<$(window).height()/2)}E.getSelectedCid=function(){var r;return v&&(r=v.getSelectedCategory()),r?r.cid:0},E.updateTaskbar=function(r,n){parseInt(n.cid,10)&&S.get(`/categories/${n.cid}`,{}).then(function(d){B(r,d)})};function B(r,n){if(n){var d=r.attr("data-uuid");A.update("composer",d,{image:n.backgroundImage,color:n.color,"background-color":n.bgColor,icon:n.icon&&n.icon.slice(3)})}}async function c(r,n,d){n.cid=d.cid;const m=await window.fetch(`${config.relative_path}/api/category/${d.cid}`).then(x=>x.json());n.category=m,B(r,m),s.e(10656).then(function(){var x=[s(98166),s(88186),s(84964)];(function(y,P,L){y.onChangeCategory(m),P.onChangeCategory(r,n,d.cid,m),L.onChangeCategory(r,n),$(window).trigger("action:composer.changeCategory",{postContainer:r,postData:n,selectedCategory:d,categoryData:m})}).apply(null,x)}).catch(s.oe)}return E}.apply(K,D),C!==void 0&&(H.exports=C)},25484:(H,K)=>{var s,D;s=[],D=function(){const C={};return C.showAlert=async function(w,A){const S=w.find('[component="composer/post-queue/alert"]');if(!config.postQueue||app.user.isAdmin||app.user.isGlobalMod||app.user.isMod){S.remove();return}const E=await socket.emit("plugins.composer.shouldQueue",{postData:A});S.toggleClass("show",E),S.toggleClass("pe-none",!E)},C.onChangeCategory=async function(w,A){config.postQueue&&C.showAlert(w,A)},C}.apply(K,s),D!==void 0&&(H.exports=D)},73398:(H,K,s)=>{var D,C;D=[s(59006),s(63281),s(7927),s(32230)],C=function(w,A,S,E){const v={},f={timestamp:0,open:!1,edit:!1,posts:{}};let B=[],c,r,n,d;const m={el:null,defaultText:"",activeText:""},x={el:null,icon:null,defaultText:"",activeText:""};let y,P;$(window).on("action:composer.activate",p),v.init=function(g,u){f.timestamp=0,f.posts=u,E.translateKeys(["[[topic:composer.post-later]]","[[modules:composer.change-schedule-date]]"]).then(b=>{m.defaultText=b[0],m.activeText=b[1]}),B=g[0].querySelectorAll(".display-scheduler"),c=g[0].querySelectorAll(".display-scheduler i"),m.el=g[0].querySelector(".dropdown-item.display-scheduler"),r=g[0].querySelector(".dropdown-item.cancel-scheduling"),n=g.find('[component="composer/submit/container"]'),d=g.find('[component="composer/submit/options/container"]'),x.el=g[0].querySelector(".composer-submit:not(.btn-sm)"),x.icon=x.el.querySelector("i"),x.defaultText=x.el.lastChild.textContent,x.activeText=x.el.getAttribute("data-text-variant"),r.addEventListener("click",i),B.forEach(b=>b.addEventListener("click",L))},v.getTimestamp=function(){return!v.isActive()||isNaN(f.timestamp)?0:f.timestamp},v.isActive=function(){return f.timestamp>0},v.isOpen=function(){return f.open},v.reset=function(){f.timestamp=0},v.onChangeCategory=function(g){G(g.privileges["topics:schedule"]),N(!1);const u=g.privileges["topics:schedule"]||d.attr("data-submit-options")>0;n.find(".composer-submit").toggleClass("rounded-1",!u),d.toggleClass("hidden",!u),v.reset()};async function L(){const g=await w.render("modals/topic-scheduler");A.dialog({message:g,title:"[[modules:composer.schedule-for]]",className:"topic-scheduler",onShown:a,onHidden:l,onEscape:!0,buttons:{cancel:{label:f.timestamp?"[[modules:composer.cancel-scheduling]]":"[[modules:bootbox.cancel]]",className:(f.timestamp?"btn-warning":"btn-outline-secondary")+(f.edit?" hidden":""),callback:i},set:{label:"[[modules:composer.set-schedule-date]]",className:"btn-primary",callback:k}}})}function a(g){f.open=!0;const u=g.target.querySelector(".datetime-picker");y=u.querySelector('input[type="date"]'),P=u.querySelector('input[type="time"]'),W()}function l(){f.open=!1}function p(g,{post_uuid:u}){f.edit=!1;const b=f.posts[u];b&&b.isMain&&b.timestamp>Date.now()&&(f.timestamp=b.timestamp,f.edit=!0,N())}function W(){const g=new Date,u=new Date(g.getTime()-g.getTimezoneOffset()*6e4).toJSON();if(y.setAttribute("min",u.slice(0,10)),P.setAttribute("min",u.slice(11,-8)),v.isActive()){const b=new Date(f.timestamp-g.getTimezoneOffset()*6e4).toJSON();y.value=b.slice(0,10),P.value=b.slice(11,-8)}}function k(){const g=y.value&&P.value,u=new Date(`${y.value} ${P.value}`).getTime();if(!g||isNaN(u)||u<Date.now()){f.timestamp=0;const b=u<Date.now()?"[[error:scheduling-to-past]]":"[[error:invalid-schedule-date]]";return S.alert({type:"danger",timeout:3e3,title:"",alert_id:"post_error",message:b}),!1}f.timestamp||N(!0),f.timestamp=u}function i(){f.timestamp&&(N(!1),f.timestamp=0)}function N(g=!0){c.forEach(u=>u.classList.toggle("active",g)),x.icon&&(x.icon.classList.toggle("fa-check",!g),x.icon.classList.toggle("fa-clock-o",g)),m.el&&(m.el.textContent=g?m.activeText:m.defaultText,r.classList.toggle("hidden",!g)),x.el.lastChild.textContent=g?x.activeText:x.defaultText}function G(g){B.forEach(u=>u.classList.toggle("hidden",!g))}return v}.apply(K,D),C!==void 0&&(H.exports=C)},13720:(H,K,s)=>{var D,C;D=[s(7927)],C=function(w){var A={},S,E;A.init=function(c,r){var n=c.find(".tags");if(n.length){S=ajaxify.data.hasOwnProperty("minTags")?ajaxify.data.minTags:config.minimumTagsPerTopic,E=ajaxify.data.hasOwnProperty("maxTags")?ajaxify.data.maxTags:config.maximumTagsPerTopic,n.tagsinput({tagClass:"badge bg-info rounded-1",confirmKeys:[13,44],trimValue:!0});var d=c.find(".bootstrap-tagsinput input");v(c,r,ajaxify.data),app.loadJQueryUI(function(){d.autocomplete({delay:100,position:{my:"left bottom",at:"left top",collision:"flip"},appendTo:c.find(".bootstrap-tagsinput"),open:function(){$(this).autocomplete("widget").css("z-index",2e4)},source:function(y,P){socket.emit("topics.autocompleteTags",{query:y.term,cid:r.cid},function(L,a){if(L)return w.error(L);a&&P(a),$(".ui-autocomplete a").attr("data-ajaxify","false")})},select:function(){f(d)}}),B(r.tags,n),n.on("beforeItemAdd",function(y){var P=E&&E<=A.getTags(c.attr("data-uuid")).length,L=utils.cleanUpTag(y.item,config.maximumTagLength),a=L!==y.item;if(y.cancel=a||y.item.length<config.minimumTagLength||y.item.length>config.maximumTagLength||P,y.item.length<config.minimumTagLength)return w.error("[[error:tag-too-short, "+config.minimumTagLength+"]]");if(y.item.length>config.maximumTagLength)return w.error("[[error:tag-too-long, "+config.maximumTagLength+"]]");if(P)return w.error("[[error:too-many-tags, "+E+"]]");a&&n.tagsinput("add",L)});var m=!1,x=!1;n.on("itemRemoved",function(y){if(x){x=!1;return}y.item&&socket.emit("topics.canRemoveTag",{tag:y.item},function(P,L){if(P)return w.error(P);L||(w.error("[[error:cant-remove-system-tag]]"),m=!0,n.tagsinput("add",y.item))})}),n.on("itemAdded",function(y){if(m){m=!1;return}var P=r.hasOwnProperty("cid")?r.cid:ajaxify.data.cid;socket.emit("topics.isTagAllowed",{tag:y.item,cid:P||0},function(L,a){if(L)return w.error(L);if(!a)return x=!0,n.tagsinput("remove",y.item);$(window).trigger("action:tag.added",{cid:P,tagEl:n,tag:y.item}),d.length&&d.autocomplete("close")})})}),d.attr("tabIndex",n.attr("tabIndex")),d.on("blur",function(){f(d)}),$('[component="composer/tag/dropdown"]').on("click","li",function(){var m=$(this).attr("data-tag");return m&&B([m],n),!1})}},A.isEnoughTags=function(c){return A.getTags(c).length>=S},A.minTagCount=function(){return S},A.onChangeCategory=function(c,r,n,d){var m=c.find('[component="composer/tag/dropdown"]');m.length&&(v(c,r,d),m.toggleClass("hidden",!d.tagWhitelist||!d.tagWhitelist.length),d.tagWhitelist&&app.parseAndTranslate("composer","tagWhitelist",{tagWhitelist:d.tagWhitelist},function(x){m.find(".dropdown-menu").html(x)}))};function v(c,r,n){var d=c.find(".tags"),m=c.find(".bootstrap-tagsinput input");m.length&&(n.hasOwnProperty("minTags")&&(S=n.minTags),n.hasOwnProperty("maxTags")&&(E=n.maxTags),n.tagWhitelist&&n.tagWhitelist.length?(m.attr("readonly",""),m.attr("placeholder",""),d.tagsinput("items").slice().forEach(function(x){n.tagWhitelist.indexOf(x)===-1&&d.tagsinput("remove",x)})):(m.removeAttr("readonly"),m.attr("placeholder",c.find("input.tags").attr("placeholder"))),c.find(".tags-container").toggleClass("haswhitelist",!!(n.tagWhitelist&&n.tagWhitelist.length)),c.find(".tags-container").toggleClass("hidden",n.privileges&&n.privileges.hasOwnProperty("topics:tag")&&!n.privileges["topics:tag"]||E===0&&!r&&!r.tags&&!r.tags.length),n.privileges&&n.privileges.hasOwnProperty("topics:tag")&&!n.privileges["topics:tag"]&&d.tagsinput("removeAll"),$(window).trigger("action:tag.toggleInput",{postContainer:c,tagWhitelist:n.tagWhitelist,tagsInput:m}))}function f(c){var r=jQuery.Event("keypress");r.which=13,r.keyCode=13,setTimeout(function(){c.trigger(r)},100)}function B(c,r){if(c&&c.length)for(var n=0;n<c.length;++n)r.tagsinput("add",c[n])}return A.getTags=function(c){return $('.composer[data-uuid="'+c+'"] .tags').tagsinput("items")},A}.apply(K,D),C!==void 0&&(H.exports=C)},77070:(H,K,s)=>{var D,C;D=[s(83713),s(98755),s(32230),s(7927),s(33371),s(86569)],C=function(w,A,S,E,v){var f={inProgress:{}},B="";f.initialize=function(a){d(a),m(a),c(a),r(a),S.translate("[[modules:composer.uploading, 0%]]",function(l){B=l})};function c(a){var l=$('.composer[data-uuid="'+a+'"]');l.find("#files").on("change",function(p){var W=(p.target||{}).files||($(this).val()?[{name:$(this).val(),type:utils.fileMimeType($(this).val())}]:null);W&&P({files:W,post_uuid:a,route:"/api/post/upload"})})}function r(a){var l=$('.composer[data-uuid="'+a+'"]');l.on("click",".topic-thumb-clear-btn",function(p){l.find("input#topic-thumb-url").val("").trigger("change"),n(l.find("input#topic-thumb-file")),$(this).addClass("hide"),p.preventDefault()}),l.on("paste change keypress","input#topic-thumb-url",function(){var p=$(this);setTimeout(function(){var W=p.val();W?l.find(".topic-thumb-clear-btn").removeClass("hide"):(n(l.find("input#topic-thumb-file")),l.find(".topic-thumb-clear-btn").addClass("hide")),l.find("img.topic-thumb-preview").attr("src",W)},100)})}function n(a){a.wrap("<form />").closest("form").get(0).reset(),a.unwrap()}function d(a){var l=$('.composer[data-uuid="'+a+'"]');v.handleDragDrop({container:l,callback:function(p){P({files:p.files,post_uuid:a,route:"/api/post/upload",formData:p.formData})}})}function m(a){var l=$('.composer[data-uuid="'+a+'"]');v.handlePaste({container:l,callback:function(p){P({files:p.files,fileNames:p.fileNames,post_uuid:a,route:"/api/post/upload",formData:p.formData})}})}function x(a){return a.replace(/[-[\]{}()*+?.,\\^$|#\s]/g,"\\$&")}function y(a,l,p){return a.slice(0,l)+p+a.slice(l)}function P(a){var l=[...a.files],p=a.post_uuid,W=$('.composer[data-uuid="'+p+'"]'),k=W.find("textarea"),i=k.val(),N=W.find("#fileForm"),G=!1;N.attr("action",config.relative_path+a.route);var g=A.getSelectedCid();!g&&ajaxify.data.cid&&(g=ajaxify.data.cid);var u=0,b=!1;for(u=0;u<l.length;++u)if(b=l[u].type.match(/image./),b&&!app.user.privileges["upload:post:image"]||!b&&!app.user.privileges["upload:post:file"])return E.error("[[error:no-privileges]]");var V=[];let ie="";for(u=0;u<l.length;++u){if(V.push(u+"_"+Date.now()+"_"+(a.fileNames?a.fileNames[u]:l[u].name)),b=l[u].type.match(/image./),!app.user.isAdmin&&l[u].size>parseInt(config.maximumFileSize,10)*1024)return N[0].reset(),E.error("[[error:file-too-big, "+config.maximumFileSize+"]]");ie+=(b?"!":"")+"["+V[u]+"]("+B+") "}const ne=k.getCursorPosition(),re=i.length;i=y(i,ne,ie),N.length&&W.find('[data-action="post"]').prop("disabled",!0),k.val(i),$(window).trigger("action:composer.uploadStart",{post_uuid:p,files:V.map(function(Z,j){return{filename:Z.replace(/^\d+_\d{13}_/,""),isImage:/image./.test(l[j].type)}}),text:B}),N.off("submit").submit(function(){function Z(j,O,R){var q;R&&(q=j.replace(/^\d+_\d{13}_/,""));var ee=k.val(),e=new RegExp(x(j)+"]\\([^)]+\\)","g");k.val(ee.replace(e,(q||j)+"]("+O+")")),$(window).trigger("action:composer.uploadUpdate",{post_uuid:p,filename:j,text:O})}return f.inProgress[p]=f.inProgress[p]||[],f.inProgress[p].push(1),a.formData&&a.formData.append("cid",g),$(this).ajaxSubmit({headers:{"x-csrf-token":config.csrf_token},resetForm:!0,clearForm:!0,formData:a.formData,data:{cid:g},error:function(j){G=!0,W.find('[data-action="post"]').prop("disabled",!1);const O=L(j,p);for(var R=0;R<l.length;++R)Z(V[R],O,!0);w.render(W)},uploadProgress:function(j,O,R,q){S.translate("[[modules:composer.uploading, "+q+"%]]",function(ee){if(!G)for(var e=0;e<l.length;++e)Z(V[e],ee)})},success:function(j){const O=j.response.images;if(G=!0,O&&O.length)for(var R=0;R<O.length;++R)O[R].filename=V[R].replace(/^\d+_\d{13}_/,""),O[R].isImage=/image./.test(l[R].type),Z(V[R],O[R].url,!0);w.render(W),k.selectRange(ne+k.val().length-re),W.find('[data-action="post"]').prop("disabled",!1),$(window).trigger("action:composer.upload",{post_uuid:p,files:O})},complete:function(){N[0].reset(),f.inProgress[p].pop()}}),!1}),N.submit()}function L(a,l){var p=a.responseJSON&&(a.responseJSON.error||a.responseJSON.status&&a.responseJSON.status.message)||"[[error:parse-error]]";return a&&a.status===413&&(p=a.statusText||"Request Entity Too Large"),E.error(p),$(window).trigger("action:composer.uploadError",{post_uuid:l,message:p}),p}return f}.apply(K,D),C!==void 0&&(H.exports=C)}}]);
