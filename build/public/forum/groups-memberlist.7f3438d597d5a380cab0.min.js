"use strict";(self.webpackChunknodebb=self.webpackChunknodebb||[]).push([[61762,70565,83014,99617],{24987:(x,p,i)=>{var f,h;f=[i(74344),i(63281),i(7927)],h=function(m,k,c){const u={};let d,g;u.init=function(e){g=e||"groups/details",d=ajaxify.data.group.name,b(),E(),A()};function b(){$('[component="groups/members/add"]').on("click",function(){app.parseAndTranslate("admin/partials/groups/add-members",{},function(e){const a=[],o=k.dialog({title:"[[groups:details.add-member]]",message:e,buttons:{OK:{label:"[[groups:details.add-member]]",callback:function(){const s=[];o.find("[data-uid][data-selected]").each(function(n,l){s.push(a[$(l).attr("data-uid")])}),y(s,function(){o.modal("hide")})}}}});o.on("click","[data-username]",function(){$(this).attr("data-selected")==="1"?$(this).removeAttr("data-selected"):$(this).attr("data-selected",1),$(this).find("i").toggleClass("invisible")}),o.find("input").on("keyup",function(){m.get("/api/users",{query:$(this).val(),paginate:!1},function(s,n){if(s)return c.error(s);n.users.forEach(function(l){a[l.uid]=l}),app.parseAndTranslate("admin/partials/groups/add-members","users",{users:n.users},function(l){o.find("#search-result").html(l)})})})})})}function y(e,a){function o(){e=e.filter(function(n){return!$('[component="groups/members"] [data-uid="'+n.uid+'"]').length}),r(e,function(n){$('[component="groups/members"] tbody').prepend(n)}),a()}const s=e.map(function(n){return n.uid});d==="administrators"?socket.emit("admin.user.makeAdmins",s,function(n){if(n)return c.error(n);o()}):Promise.all(s.map(n=>m.put("/groups/"+ajaxify.data.group.slug+"/membership/"+n))).then(o).catch(c.error)}function E(){const e=$('[component="groups/members/search"]');e.on("keyup",utils.debounce(function(){const a=e.val();socket.emit("groups.searchMembers",{groupName:d,query:a},function(o,s){if(o)return c.error(o);r(s.users,function(n){$('[component="groups/members"] tbody').html(n),$('[component="groups/members"]').attr("data-nextstart",20)})})},250))}function A(){$('[component="groups/members"]').on("scroll",function(){const e=$(this),a=(e[0].scrollHeight-e.innerHeight())*.9;e.scrollTop()>a&&!$('[component="groups/members/search"]').val()&&M()})}function M(){const e=$('[component="groups/members"]');e.attr("loading")||(e.attr("loading",1),socket.emit("groups.loadMoreMembers",{groupName:d,after:e.attr("data-nextstart")},function(a,o){if(a)return c.error(a);o&&o.users.length?t(o.users,function(){e.removeAttr("loading"),e.attr("data-nextstart",o.nextStart)}):e.removeAttr("loading")}))}function t(e,a){e=e.filter(function(o){return!$('[component="groups/members"] [data-uid="'+o.uid+'"]').length}),r(e,function(o){$('[component="groups/members"] tbody').append(o),a()})}function r(e,a){app.parseAndTranslate(g,"group.members",{group:{members:e,isOwner:ajaxify.data.group.isOwner}},a)}return u}.apply(p,f),h!==void 0&&(x.exports=h)},74344:(x,p,i)=>{i.r(p),i.d(p,{del:()=>M,get:()=>g,head:()=>b,patch:()=>E,post:()=>y,put:()=>A});var f=i(85233),h=i.n(f),m=i(63281),k=i.n(m);const c=config.relative_path+"/api/v3";async function u(t,r){if(t.url=t.url.startsWith("/api")?config.relative_path+t.url:c+t.url,typeof r=="function"){d(t).then(e=>r(null,e),e=>r(e));return}try{return await d(t)}catch(e){if(e.message==="A valid login session was not found. Please log in and try again.")return(0,m.confirm)("[[error:api.reauth-required]]",a=>{a&&ajaxify.go("login")});throw e}}async function d(t){const{url:r}=t;delete t.url,t.data&&!(t.data instanceof FormData)&&(t.data=JSON.stringify(t.data||{}),t.headers["content-type"]="application/json; charset=utf-8"),{options:t}=await(0,f.fire)("filter:api.options",{options:t}),t.data&&(t.body=t.data,delete t.data);const e=await fetch(r,t),{headers:a}=e,o=a.get("content-type"),s=o&&o.startsWith("application/json");let n;if(t.method!=="head"&&(s?n=await e.json():n=await e.text()),!e.ok)throw n?new Error(s?n.status.message:n):new Error(e.statusText);return s&&n&&n.hasOwnProperty("status")&&n.hasOwnProperty("response")?n.response:n}function g(t,r,e){return u({url:t+(r&&Object.keys(r).length?"?"+$.param(r):"")},e)}function b(t,r,e){return u({url:t+(r&&Object.keys(r).length?"?"+$.param(r):""),method:"head"},e)}function y(t,r,e){return u({url:t,method:"post",data:r,headers:{"x-csrf-token":config.csrf_token}},e)}function E(t,r,e){return u({url:t,method:"patch",data:r,headers:{"x-csrf-token":config.csrf_token}},e)}function A(t,r,e){return u({url:t,method:"put",data:r,headers:{"x-csrf-token":config.csrf_token}},e)}function M(t,r,e){return u({url:t,method:"delete",data:r,headers:{"x-csrf-token":config.csrf_token}},e)}}}]);
