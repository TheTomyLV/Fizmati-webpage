(self.webpackChunknodebb=self.webpackChunknodebb||[]).push([[80152,38786,70071,28306],{96105:(_,w,v)=>{"use strict";var h,c;h=[v(7237),v(69986)],c=function(f,r){const i={};return i.init=function(){const u=$(".notifications-list");u.on("click",'[component="notifications/item/link"]',function(){const C=$(this).parents("[data-nid]").attr("data-nid");r.markNotification(C,!0)}),r.handleUnreadButton(u),f.get("notifications/mark_all").on("click",function(){r.markAllRead(function(){f.get("notifications/item").removeClass("unread")})})},i}.apply(w,h),c!==void 0&&(_.exports=c)},69986:(_,w,v)=>{"use strict";var h,c;h=[v(32230),v(7237),v(42840),v(16943),v(85233),v(7927)],c=function(f,r,i,u,C,l){const s={};let m={};const S=({notifications:n})=>new Promise(o=>{for(let a=0;a<n.length;a+=1)n[a].timeagoLong=$.timeago(new Date(parseInt(n[a].datetime,10)));f.toggleTimeagoShorthand(function(){for(let a=0;a<n.length;a+=1)n[a].timeago=$.timeago(new Date(parseInt(n[a].datetime,10))),n[a].timeagoShort=n[a].timeago;f.toggleTimeagoShorthand(),o({notifications:n})})});C.on("filter:notifications.load",S),s.loadNotifications=function(n,o){o=o||function(){},socket.emit("notifications.get",null,function(a,d){if(a)return l.error(a);const I=d.unread.concat(d.read).sort(function(B,F){return parseInt(B.datetime,10)>parseInt(F.datetime,10)?-1:1});C.fire("filter:notifications.load",{notifications:I}).then(({notifications:B})=>{app.parseAndTranslate("partials/notifications_list",{notifications:B},function(F){n.html(F),n.off("click").on("click","[data-nid]",function(D){const P=$(this);if(T(P)&&(D.stopPropagation(),D.preventDefault(),r.get("notifications/list").dropdown("toggle")),!P.hasClass("unread"))return;const M=P.attr("data-nid");p(M,!0)}),r.get("notifications").on("click",".mark-all-read",s.markAllRead),s.handleUnreadButton(n),C.fire("action:notifications.loaded",{notifications:I,list:n}),o()})})})},s.handleUnreadButton=function(n){n.on("click",".mark-read",function(){const o=$(this),a=o.parents("[data-nid]"),d=a.hasClass("unread"),I=a.attr("data-nid");return p(I,d,function(){a.toggleClass("unread"),o.find(".unread").toggleClass("hidden",d),o.find(".read").toggleClass("hidden",!d)}),!1})},s.onNewNotification=function(n){ajaxify.currentPage==="notifications"&&ajaxify.refresh(),!(ajaxify.data.template.chats&&parseInt(ajaxify.data.roomId,10)===parseInt(n.roomId,10))&&(socket.emit("notifications.getCount",function(o,a){if(o)return l.error(o);s.updateNotifCount(a)}),m[n.nid]||(m[n.nid]=!0))},s.markNotification=function(n,o,a){p(n,o,a)};function p(n,o,a){socket.emit("notifications.mark"+(o?"Read":"Unread"),n,function(d){if(d)return l.error(d);o&&m[n]&&delete m[n],a&&a()})}function T(n){const o=n.attr("data-pid"),a=n.attr("data-path"),d=r.get("post","pid",o);return a.startsWith(config.relative_path+"/post/")&&o&&d.length&&ajaxify.data.template.topic?(i.scrollToIndex(d.attr("data-index"),!0),!0):!1}return s.updateNotifCount=function(n){const o=r.get("notifications/icon");n=Math.max(0,n),o.toggleClass("fa-bell",n>0).toggleClass("fa-bell-o",n<=0);const a=n>99?"99+":n;o.toggleClass("unread-count",n>0),o.attr("data-content",a),r.get("notifications/count").toggleClass("hidden",n<=0).text(a);const d={count:n,updateFavicon:!0};C.fire("action:notification.updateCount",d),d.updateFavicon&&u.setBubble(a),i.setAppBadge&&i.setAppBadge(n)},s.markAllRead=function(){socket.emit("notifications.markAllRead",function(n){n&&l.error(n),m={};const o=$('[component="notifications/list"] [data-nid]');o.removeClass("unread"),o.find(".mark-read .unread").addClass("hidden"),o.find(".mark-read .read").removeClass("hidden")})},s}.apply(w,h),c!==void 0&&(_.exports=c)},66603:(_,w,v)=>{"use strict";var h;h=function(){function c(){this._store={},this._keys=[]}c.prototype.isMock=!0,c.prototype.setItem=function(i,u){i=String(i),this._keys.indexOf(i)===-1&&this._keys.push(i),this._store[i]=u},c.prototype.getItem=function(i){return i=String(i),this._keys.indexOf(i)===-1?null:this._store[i]},c.prototype.removeItem=function(i){i=String(i),this._keys=this._keys.filter(function(u){return u!==i}),this._store[i]=null},c.prototype.clear=function(){this._keys=[],this._store={}},c.prototype.key=function(i){return i=parseInt(i,10)||0,this._keys[i]},Object.defineProperty&&Object.defineProperty(c.prototype,"length",{get:function(){return this._keys.length}});let f;const r=Date.now().toString();try{if(f=window.localStorage,f.setItem(r,r),f.getItem(r)!==r)throw Error("localStorage behaved unexpectedly");return f.removeItem(r),f}catch(i){console.warn(i),console.warn("localStorage failed, falling back on sessionStorage");try{if(f=window.sessionStorage,f.setItem(r,r),f.getItem(r)!==r)throw Error("sessionStorage behaved unexpectedly");return f.removeItem(r),f}catch(u){return console.warn(u),console.warn("sessionStorage failed, falling back on memory storage"),new c}}}.call(w,v,w,_),h!==void 0&&(_.exports=h)},16943:(_,w,v)=>{var h,c;/*!
* Tinycon - A small library for manipulating the Favicon
* Tom Moor, http://tommoor.com
* Copyright (c) 2015 Tom Moor
* @license MIT Licensed
*/(function(){var f={},r=null,i=null,u=null,C=null,l={},s=Math.ceil(window.devicePixelRatio)||1,m=16*s,S={width:7,height:9,font:10*s+"px arial",color:"#ffffff",background:"#F03D25",fallback:!0,crossOrigin:!0,abbreviate:!0},p=function(){var t=navigator.userAgent.toLowerCase();return function(e){return t.indexOf(e)!==-1}}(),T={ie:p("trident"),chrome:p("chrome"),webkit:p("chrome")||p("safari"),safari:p("safari")&&!p("chrome"),mozilla:p("mozilla")&&!p("chrome")&&!p("safari")},n=function(){for(var t=document.getElementsByTagName("link"),e=0,g=t.length;e<g;e++)if((t[e].getAttribute("rel")||"").match(/\bicon\b/i))return t[e];return!1},o=function(){for(var t=document.getElementsByTagName("link"),e=0,g=t.length;e<g;e++){var k=typeof t[e]<"u";k&&(t[e].getAttribute("rel")||"").match(/\bicon\b/i)&&t[e].parentNode.removeChild(t[e])}},a=function(){if(!i||!r){var t=n();r=t?t.getAttribute("href"):"/favicon.ico",i||(i=r)}return r},d=function(){return C||(C=document.createElement("canvas"),C.width=m,C.height=m),C},I=function(t){if(t){o();var e=document.createElement("link");e.type="image/x-icon",e.rel="icon",e.href=t,document.getElementsByTagName("head")[0].appendChild(e)}},B=function(t){window.console&&window.console.log(t)},F=function(t,k){if(!d().getContext||T.ie||T.safari||l.fallback==="force")return D(t);var g=d().getContext("2d"),k=k||"#000000",R=a();u=document.createElement("img"),u.onload=function(){g.clearRect(0,0,m,m),g.drawImage(u,0,0,u.width,u.height,0,0,m,m),(t+"").length>0&&P(g,t,k),O()},!R.match(/^data/)&&l.crossOrigin&&(u.crossOrigin="anonymous"),u.src=R},D=function(t){if(l.fallback){var e=document.title;e[0]==="("&&(e=e.slice(e.indexOf(" "))),(t+"").length>0?document.title="("+t+") "+e:document.title=e}},P=function(t,e,g){typeof e=="number"&&e>99&&l.abbreviate&&(e=M(e));var k=(e+"").length-1,R=l.width*s+6*s*k,W=l.height*s,N=m-W,A=m-R-s,y=16*s,b=16*s,E=2*s;t.font=(T.webkit?"bold ":"")+l.font,t.fillStyle=l.background,t.strokeStyle=l.background,t.lineWidth=s,t.beginPath(),t.moveTo(A+E,N),t.quadraticCurveTo(A,N,A,N+E),t.lineTo(A,y-E),t.quadraticCurveTo(A,y,A+E,y),t.lineTo(b-E,y),t.quadraticCurveTo(b,y,b,y-E),t.lineTo(b,N+E),t.quadraticCurveTo(b,N,b-E,N),t.closePath(),t.fill(),t.beginPath(),t.strokeStyle="rgba(0,0,0,0.3)",t.moveTo(A+E/2,y),t.lineTo(b-E/2,y),t.stroke(),t.fillStyle=l.color,t.textAlign="right",t.textBaseline="top",t.fillText(e,s===2?29:15,T.mozilla?7*s:6*s)},O=function(){d().getContext&&I(d().toDataURL())},M=function(t){for(var e=[["G",1e9],["M",1e6],["k",1e3]],g=0;g<e.length;++g)if(t>=e[g][1]){t=U(t/e[g][1])+e[g][0];break}return t},U=function(t,e){var g=new Number(t);return g.toFixed(e)};f.setOptions=function(t){l={},t.colour&&(t.color=t.colour);for(var e in S)l[e]=t.hasOwnProperty(e)?t[e]:S[e];return this},f.setImage=function(t){return r=t,O(),this},f.setBubble=function(t,e){return t=t||"",F(t,e),this},f.reset=function(){r=i,I(i)},f.setOptions(S),h=f,c=typeof h=="function"?h.call(w,v,w,_):h,c!==void 0&&(_.exports=c)})()}}]);
