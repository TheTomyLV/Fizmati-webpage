"use strict";(self.webpackChunknodebb=self.webpackChunknodebb||[]).push([[8798,70565,50232,83014,99617,81018],{81018:(y,u,r)=>{var l,h;l=[r(7927),r(74344),r(93216)],h=function(d,D,m){const c={};c.init=function(){Promise.all([r.e(42441),r.e(61006),r.e(46862),r.e(54271)]).then(function(){var a=[r(30524)];(function(i){$('[component="chat/nav-wrapper"]').on("click",'[component="chat/recent/room"], [component="chat/public/room"]',function(o){o.stopPropagation(),o.preventDefault();const f=this.getAttribute("data-roomid");i.switchChat(f)}).on("click",".mark-read",function(o){o.stopPropagation();const f=this.closest("[data-roomid]");m.toggleReadState(f)}),$('[component="chat/recent"]').on("scroll",utils.debounce(function(){const o=$(this),f=(o[0].scrollHeight-o.height())*.9;o.scrollTop()>f&&g()},100))}).apply(null,a)}).catch(r.oe)};function g(){const a=$('[component="chat/recent"]');a.attr("loading")||(a.attr("loading",1),socket.emit("modules.chats.getRecentChats",{uid:ajaxify.data.uid,after:a.attr("data-nextstart")},function(i,o){if(i)return d.error(i);o&&o.rooms.length?p(o,function(){a.removeAttr("loading"),a.attr("data-nextstart",o.nextStart)}):a.removeAttr("loading")}))}function p(a,i){if(!a.rooms.length)return i();a.loadingMore=!0,app.parseAndTranslate("chats","rooms",a,function(o){$('[component="chat/recent"]').append(o),o.find(".timeago").timeago(),i()})}return c}.apply(u,l),h!==void 0&&(y.exports=h)},74344:(y,u,r)=>{r.r(u),r.d(u,{del:()=>R,get:()=>p,head:()=>a,patch:()=>o,post:()=>i,put:()=>f});var l=r(85233),h=r.n(l),d=r(63281),D=r.n(d);const m=config.relative_path+"/api/v3";async function c(t,e){if(t.url=t.url.startsWith("/api")?config.relative_path+t.url:m+t.url,typeof e=="function"){g(t).then(n=>e(null,n),n=>e(n));return}try{return await g(t)}catch(n){if(n.message==="A valid login session was not found. Please log in and try again.")return(0,d.confirm)("[[error:api.reauth-required]]",E=>{E&&ajaxify.go("login")});throw n}}async function g(t){const{url:e}=t;delete t.url,t.data&&!(t.data instanceof FormData)&&(t.data=JSON.stringify(t.data||{}),t.headers["content-type"]="application/json; charset=utf-8"),{options:t}=await(0,l.fire)("filter:api.options",{options:t}),t.data&&(t.body=t.data,delete t.data);const n=await fetch(e,t),{headers:E}=n,P=E.get("content-type"),A=P&&P.startsWith("application/json");let s;if(t.method!=="head"&&(A?s=await n.json():s=await n.text()),!n.ok)throw s?new Error(A?s.status.message:s):new Error(n.statusText);return A&&s&&s.hasOwnProperty("status")&&s.hasOwnProperty("response")?s.response:s}function p(t,e,n){return c({url:t+(e&&Object.keys(e).length?"?"+$.param(e):"")},n)}function a(t,e,n){return c({url:t+(e&&Object.keys(e).length?"?"+$.param(e):""),method:"head"},n)}function i(t,e,n){return c({url:t,method:"post",data:e,headers:{"x-csrf-token":config.csrf_token}},n)}function o(t,e,n){return c({url:t,method:"patch",data:e,headers:{"x-csrf-token":config.csrf_token}},n)}function f(t,e,n){return c({url:t,method:"put",data:e,headers:{"x-csrf-token":config.csrf_token}},n)}function R(t,e,n){return c({url:t,method:"delete",data:e,headers:{"x-csrf-token":config.csrf_token}},n)}}}]);
