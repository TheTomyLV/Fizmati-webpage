"use strict";(self.webpackChunknodebb=self.webpackChunknodebb||[]).push([[58609,70565,83014,28253,52256,66623,99617,10999,26340,86193],{44931:(k,D,c)=>{c.r(D),c.d(D,{enableCheckboxes:()=>a,enableFilterForm:()=>e,getSelected:()=>x,handleBulkActions:()=>m,handleGraphs:()=>b,init:()=>u});var g=c(69449),p=c(39941),A=c.n(p),C=c(36012),E=c.n(C),h=c(86193),l=c.n(h),s=c(74344),n=c(7927),i=c(7237),d=c.n(i);g.kL.register(g.ST,g.uw,g.f$,g.jn,g.od,g.u,g.Gu);const o=new Map([["cids",[]],["assignee",[]],["targetUid",[]],["reporterId",[]]]);function u(){e(),a(),m(),ajaxify.data.filters.hasOwnProperty("cid")&&o.set("cids",Array.isArray(ajaxify.data.filters.cid)?ajaxify.data.filters.cid:[ajaxify.data.filters.cid]),p.init($('[component="category/dropdown"]'),{privilege:"moderate",selectedCids:o.get("cids"),updateButton:function({selectedCids:r}){o.set("cids",r),t()}}),["assignee","targetUid","reporterId"].forEach(r=>{ajaxify.data.filters.hasOwnProperty("filter")&&o.set(r,ajaxify.data.selected[r]);const f=$(`[component="flags/filter/${r}"]`);C.init(f,{selectedUsers:o.get(r),template:"partials/flags/filters",selectedBlock:`selected.${r}`,onSelect:function(_){o.set(r,_)},onHidden:function(){t()}})}),i.get("flags/list").on("click","[data-flag-id]",function(r){if(["BUTTON","A"].includes(r.target.nodeName))return;const f=this.getAttribute("data-flag-id");ajaxify.go("flags/"+f)}),$("#flags-daily-wrapper").one("shown.bs.collapse",function(){b()}),h.user($("#filter-assignee, #filter-targetUid, #filter-reporterId"),(r,f)=>{setTimeout(()=>{r.target.value=f.item.user.uid})})}function e(){const r=i.get("flags/filters");if(r&&r.get(0).nodeName!=="FORM"){const f=r.get(0),_=f.querySelector("form");f.addEventListener("click",O=>{const y=O.target.closest("[data-value]");if(!y)return;const v=y.getAttribute("data-name"),P=y.getAttribute("data-value");_[v].value=P,t()})}else{for(const f in ajaxify.data.filters)ajaxify.data.filters.hasOwnProperty(f)&&r.find('[name="'+f+'"]').val(ajaxify.data.filters[f]);r.find('[name="sort"]').val(ajaxify.data.sort),document.getElementById("apply-filters").addEventListener("click",function(){t()}),r.find('button[data-target="#more-filters"]').click(f=>{const _=f.target.getAttribute("data-text-variant");_&&(f.target.setAttribute("data-text-variant",f.target.textContent),f.target.firstChild.textContent=_)})}}function t(){let r=i.get("flags/filters").get(0);if(!r)return;r.nodeName!=="FORM"&&(r=r.querySelector("form"));const f=new FormData(r);o.get("cids").forEach(function(y){f.append("cid",y)}),["assignee","targetUid","reporterId"].forEach(y=>{o.get(y).forEach(({uid:v})=>{f.append(y,v)})});const _=Array.from(f.values()).filter(Boolean),O=new URLSearchParams(f).toString();ajaxify.go("flags?"+(_?O:"reset=1"))}function a(){const r=document.querySelector('[component="flags/list"]'),f=r.querySelectorAll('[data-flag-id] input[type="checkbox"]'),_=document.querySelector('[component="flags/bulk-actions"] button');let O;document.querySelector('[data-action="toggle-all"]').addEventListener("click",function(){const y=this.checked;f.forEach(function(v){v.checked=y}),_.disabled=!y}),r.addEventListener("click",function(y){const v=y.target.closest('input[type="checkbox"]');if(v){if(y.stopImmediatePropagation(),O&&y.shiftKey&&O!==v){const P=v.checked;let B=!1;f.forEach(function(L){[v,O].some(function(M){return M===L})&&(B=!B),B&&(L.checked=P)})}_.disabled=!Array.prototype.some.call(f,function(P){return P.checked}),O=v}y.target.querySelector('input[type="checkbox"]')&&y.stopImmediatePropagation()})}function m(){document.querySelector('[component="flags/bulk-actions"]').addEventListener("click",function(r){const f=r.target.closest("[data-action]");if(f){const _=f.getAttribute("data-action"),y=x().map(v=>{const P={};return _==="bulk-assign"?P.assignee=app.user.uid:_==="bulk-mark-resolved"&&(P.state="resolved"),s.put(`/flags/${v}`,P)});Promise.allSettled(y).then(function(v){const P=v.filter(function(L){return L.status==="fulfilled"}).length,B=v.filter(function(L){return L.status==="rejected"});P&&(n.success("[[flags:bulk-success, "+P+"]]"),ajaxify.refresh()),B.forEach(function(L){n.error(L.reason)})})}})}function x(){const r=document.querySelectorAll('[component="flags/list"] [data-flag-id] input[type="checkbox"]'),f=[];return r.forEach(function(_){_.checked&&f.push(_.closest("[data-flag-id]").getAttribute("data-flag-id"))}),f}function b(){const r=document.getElementById("flags:daily"),f=utils.getDaysArray().map(function(O,y){return y%3?"":O});utils.isMobile()&&(g.kL.defaults.plugins.tooltip.enabled=!1);const _={"flags:daily":{labels:f,datasets:[{label:"",backgroundColor:"rgba(151,187,205,0.2)",borderColor:"rgba(151,187,205,1)",pointBackgroundColor:"rgba(151,187,205,1)",pointHoverBackgroundColor:"#fff",pointBorderColor:"#fff",pointHoverBorderColor:"rgba(151,187,205,1)",data:ajaxify.data.analytics}]}};r.width=$(r).parent().width(),new g.kL(r.getContext("2d"),{type:"line",data:_["flags:daily"],options:{responsive:!0,animation:!1,scales:{y:{beginAtZero:!0}}}})}},74344:(k,D,c)=>{c.r(D),c.d(D,{del:()=>u,get:()=>s,head:()=>n,patch:()=>d,post:()=>i,put:()=>o});var g=c(85233),p=c.n(g),A=c(63281),C=c.n(A);const E=config.relative_path+"/api/v3";async function h(e,t){if(e.url=e.url.startsWith("/api")?config.relative_path+e.url:E+e.url,typeof t=="function"){l(e).then(a=>t(null,a),a=>t(a));return}try{return await l(e)}catch(a){if(a.message==="A valid login session was not found. Please log in and try again.")return(0,A.confirm)("[[error:api.reauth-required]]",m=>{m&&ajaxify.go("login")});throw a}}async function l(e){const{url:t}=e;delete e.url,e.data&&!(e.data instanceof FormData)&&(e.data=JSON.stringify(e.data||{}),e.headers["content-type"]="application/json; charset=utf-8"),{options:e}=await(0,g.fire)("filter:api.options",{options:e}),e.data&&(e.body=e.data,delete e.data);const a=await fetch(t,e),{headers:m}=a,x=m.get("content-type"),b=x&&x.startsWith("application/json");let r;if(e.method!=="head"&&(b?r=await a.json():r=await a.text()),!a.ok)throw r?new Error(b?r.status.message:r):new Error(a.statusText);return b&&r&&r.hasOwnProperty("status")&&r.hasOwnProperty("response")?r.response:r}function s(e,t,a){return h({url:e+(t&&Object.keys(t).length?"?"+$.param(t):"")},a)}function n(e,t,a){return h({url:e+(t&&Object.keys(t).length?"?"+$.param(t):""),method:"head"},a)}function i(e,t,a){return h({url:e,method:"post",data:t,headers:{"x-csrf-token":config.csrf_token}},a)}function d(e,t,a){return h({url:e,method:"patch",data:t,headers:{"x-csrf-token":config.csrf_token}},a)}function o(e,t,a){return h({url:e,method:"put",data:t,headers:{"x-csrf-token":config.csrf_token}},a)}function u(e,t,a){return h({url:e,method:"delete",data:t,headers:{"x-csrf-token":config.csrf_token}},a)}},86193:(k,D,c)=>{var g,p;g=[c(74344),c(7927)],p=function(A,C){const E={},h={delay:200,appendTo:null};E.init=s=>{const n={...h,...s},{input:i,onSelect:d}=n;app.loadJQueryUI(function(){i.autocomplete({...n,open:function(){$(this).autocomplete("widget").css("z-index",100005)},select:function(o,u){l(i,d,o,u)}})})},E.user=function(s,n,i){typeof n=="function"&&(i=n,n={}),n=n||{},E.init({input:s,onSelect:i,source:(d,o)=>{n.query=d.term,A.get("/api/users",n,function(u,e){if(u)return C.error(u);if(e&&e.users){const t=e.users.map(function(a){const m=$("<div></div>").html(a.username).text();return a&&{label:m,value:m,user:{uid:a.uid,name:a.username,slug:a.userslug,username:a.username,userslug:a.userslug,picture:a.picture,banned:a.banned,"icon:text":a["icon:text"],"icon:bgColor":a["icon:bgColor"]}}});o(t)}$(".ui-autocomplete a").attr("data-ajaxify","false")})}})},E.group=function(s,n){E.init({input:s,onSelect:n,source:(i,d)=>{socket.emit("groups.search",{query:i.term},function(o,u){if(o)return C.error(o);if(u&&u.length){const e=u.map(function(t){return t&&{label:t.name,value:t.name,group:t}});d(e)}$(".ui-autocomplete a").attr("data-ajaxify","false")})}})},E.tag=function(s,n){E.init({input:s,onSelect:n,delay:100,source:(i,d)=>{socket.emit("topics.autocompleteTags",{query:i.term,cid:ajaxify.data.cid||0},function(o,u){if(o)return C.error(o);u&&d(u),$(".ui-autocomplete a").attr("data-ajaxify","false")})}})};function l(s,n,i,d){n=n||function(){};const o=jQuery.Event("keypress");o.which=13,o.keyCode=13,setTimeout(function(){s.trigger(o)},100),n(i,d)}return E}.apply(D,g),p!==void 0&&(k.exports=p)},39941:(k,D,c)=>{var g,p;g=[c(22905),c(74344),c(85233)],p=function(A,C,E){const h={};h.init=function(s,n){if(!s||!s.length)return;n=n||{},n.states=n.states||["watching","notwatching","ignoring"],n.template=n.template||"partials/category/filter-dropdown-left",E.fire("action:category.filter.options",{el:s,options:n}),A.init(s,n);let i=[],d=[];Array.isArray(n.selectedCids)?i=n.selectedCids.map(String):Array.isArray(ajaxify.data.selectedCids)&&(i=ajaxify.data.selectedCids.map(String)),d=i.slice(),s.on("hidden.bs.dropdown",function(){let o=d.length!==i.length;if(d.forEach(function(u,e){u!==i[e]&&(o=!0)}),d=i.slice(),o&&(n.updateButton?n.updateButton({el:s,changed:o,selectedCids:i.slice()}):n.updateButton!==!1&&l(s,i)),n.onHidden){n.onHidden({changed:o,selectedCids:i.slice()});return}if(o){let u=window.location.pathname;const e=utils.params();i.length?e.cid=i:delete e.cid,delete e.page,Object.keys(e).length&&(u+="?"+decodeURIComponent($.param(e))),ajaxify.go(u)}}),s.on("click",'[component="category/list"] [data-cid]',function(){const o=s.find('[component="category/list"]'),u=$(this),e=u.find("a").attr("href");if(e&&e!=="#"&&e.length)return;const t=u.attr("data-cid"),a=u.find('[component="category/select/icon"]');return t!=="all"?(i.includes(t)?i.splice(i.indexOf(t),1):i.push(t),i.sort(function(m,x){return m-x}),a.toggleClass("invisible"),o.find('[data-cid="all"] i').toggleClass("invisible",!!i.length)):(s.find('[component="category/select/icon"]').addClass("invisible"),o.find('[data-cid="all"] i').removeClass("invisible"),i=[]),n.selectedCids=i,n.onSelect&&n.onSelect({cid:t,selectedCids:i.slice()}),!1})};function l(s,n){n.length>1?i({icon:"fa-plus",name:"[[unread:multiple-categories-selected]]",bgColor:"#ddd"}):n.length===1?C.get(`/categories/${n[0]}`,{}).then(i):i();function i(d){app.parseAndTranslate("partials/category/filter-dropdown-content",{selectedCategory:d},function(o){s.find("button").replaceWith($("<div/>").html(o).find("button"))})}}return h}.apply(D,g),p!==void 0&&(k.exports=p)},22905:(k,D,c)=>{var g,p;g=[c(7927),c(73138)],p=function(A,C){const E={};return E.init=function(h,l){let s=null;l=l||{},l.privilege=l.privilege||"topics:read",l.states=l.states||["watching","notwatching","ignoring"],l.cacheList=l.hasOwnProperty("cacheList")?l.cacheList:!0;let n=[];Array.isArray(l.localCategories)&&(n=l.localCategories.map(e=>({...e}))),l.selectedCids=l.selectedCids||ajaxify.data.selectedCids||[];const i=h.find('[component="category-selector-search"]');if(!i.length)return;const d=i.parent('[component="category/dropdown"]').length>0||i.parent('[component="category-selector"]').length>0;h.on("show.bs.dropdown",function(){d&&(h.find(".dropdown-toggle").css({visibility:"hidden"}),i.removeClass("hidden"),i.css({"z-index":h.find(".dropdown-toggle").css("z-index")+1}));function e(){const t=i.find("input").val();t.length>1||!t&&!s?o(t,function(a){s=l.cacheList&&(s||a),u(a)}):!t&&s&&u(s)}i.on("click",function(t){t.preventDefault(),t.stopPropagation()}),i.find("input").val("").on("keyup",utils.debounce(e,300)),e()}),h.on("shown.bs.dropdown",function(){["xs","sm"].includes(utils.findBootstrapEnvironment())||i.find("input").focus()}),h.on("hide.bs.dropdown",function(){d&&(h.find(".dropdown-toggle").css({visibility:"inherit"}),i.addClass("hidden")),i.off("click"),i.find("input").off("keyup")});function o(e,t){socket.emit("categories.categorySearch",{search:e,query:utils.params(),parentCid:l.parentCid||0,selectedCids:l.selectedCids,privilege:l.privilege,states:l.states,showLinks:l.showLinks},function(a,m){if(a)return A.error(a);t(n.concat(m))})}function u(e){const t=l.selectedCids.map(String);e.forEach(function(a){a.selected=t.includes(String(a.cid))}),app.parseAndTranslate(l.template,{categoryItems:e.slice(0,200),selectedCategory:ajaxify.data.selectedCategory,allCategoriesUrl:ajaxify.data.allCategoriesUrl},function(a){h.find('[component="category/list"]').html(a.find('[component="category/list"]').html()),h.find('[component="category/list"] [component="category/no-matches"]').toggleClass("hidden",!!e.length);const m=C.Dropdown.getInstance(h.find(".dropdown-toggle").get(0));m&&m.update()})}},E}.apply(D,g),p!==void 0&&(k.exports=p)},22568:(k,D,c)=>{var g,p,A;(function(C){p=[c(20648)],g=C,A=typeof g=="function"?g.apply(D,p):g,A!==void 0&&(k.exports=A)})(function(C){const E=C("[^\\p{L}\\s\\d\\-_]","g"),h=/[^\w\s\d\-_]/g,l=/^\s+|\s+$/g,s=/\s+/g,n=/-+/g,i=/-$/g,d=/^-/g,o=/^[\w\d\s.,\-@]+$/;return function(e,t){return e?(e=String(e).replace(l,""),o.test(e)?e=e.replace(h,"-"):e=C.replace(e,E,"-"),e=t?e:e.toLocaleLowerCase(),e=e.replace(s,"-"),e=e.replace(n,"-"),e=e.replace(i,""),e=e.replace(d,""),e):""}})},36012:(k,D,c)=>{var g,p;g=[c(74344),c(85233),c(22568),c(59006)],p=function(A,C,E,h){const l={};return l.init=function(s,n){if(!s||!s.length)return;n=n||{};let i,d=[];n.selectedUsers&&(d=n.selectedUsers.map(t=>({...t}))),C.fire("action:user.filter.options",{el:s,options:n});async function o(){const t=n.selectedBlock||"userFilterSelected",a={};if(t.indexOf(".")!==-1){const x=t.split(".");a[x[0]]={},a[x[0]][x[1]]=d}else a[t]=d;const m=await app.parseAndTranslate(n.template,t,a);s.find('[component="user/filter/selected"]').html(m)}async function u(){await o(),n.onSelect&&n.onSelect(d)}async function e(){let t={users:[]};const a=s.find('[component="user/filter/search"]').val();if(a&&a.length>1)if(app.user.privileges["search:users"])t=await A.get("/api/users",{query:a});else try{const b=await A.get(`/api/user/${E(a)}`);t.users.push(b)}catch{}if(!t.users.length){s.find('[component="user/filter/results"]').translateHtml("[[users:no-users-found]]");return}t.users=t.users.slice(0,20);const m={};t.users.forEach(b=>{m[b.uid]=b});const x=await app.parseAndTranslate(n.template,"userFilterResults",{userFilterResults:t.users});s.find('[component="user/filter/results"]').html(x),s.find('[component="user/filter/results"] [data-uid]').on("click",async function(){const b=parseInt($(this).attr("data-uid"),10);d.find(r=>r.uid===b)||(d.push(m[b]),await u())})}s.find('[component="user/filter/search"]').on("keyup",()=>{s.find('[component="user/filter/results"]').html(i)}),s.find('[component="user/filter/search"]').on("keyup",utils.debounce(function(){app.user.privileges["search:users"]&&e()},1e3)),s.on("click",'[component="user/filter/delete"]',async function(){const t=$(this).attr("data-uid");d=d.filter(a=>parseInt(a.uid,10)!==parseInt(t,10)),await u()}),s.find('[component="user/filter/search"]').on("keyup",t=>{t.key==="Enter"&&!app.user.privileges["search:users"]&&e()}),s.on("shown.bs.dropdown",function(){s.find('[component="user/filter/search"]').trigger("focus")}),s.on("hidden.bs.dropdown",function(){n.onHidden&&n.onHidden(d)}),h.render(n.placeholderTemplate||"partials/userFilter-placeholders").then(t=>{i=t})},l}.apply(D,g),p!==void 0&&(k.exports=p)}}]);
