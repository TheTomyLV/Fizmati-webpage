"use strict";(self.webpackChunknodebb=self.webpackChunknodebb||[]).push([[56753,70565,21710,1897,83014,99617],{45561:(j,b,r)=>{var m,h;m=[r(7237),r(32230),r(59006),r(56351),r(997),r(74344),r(63281),r(7927)],h=function(A,E,x,s,l,n,c,u){const o={};o.init=function(){$("#state").val(ajaxify.data.state).removeAttr("disabled"),$("#assignee").val(ajaxify.data.assignee).removeAttr("disabled"),$("#content > div").on("click","[data-action]",function(){const i=this.getAttribute("data-action"),t=$(this).parents("[data-uid]").attr("data-uid"),a=document.getElementById("note");switch(i){case"assign":$("#assignee").val(app.user.uid);case"update":{const e=$("#attributes").serializeArray().reduce((f,y)=>(f[y.name]=y.value,f),{});n.put(`/flags/${ajaxify.data.flagId}`,e).then(({history:f})=>{u.success("[[flags:updated]]"),o.reloadHistory(f)}).catch(u.error);break}case"addEditNote":{const e=this.closest('[component="flag/note"]');let f,y;if(e){f=e.getAttribute("data-datetime");const p=e.getAttribute("data-index");y=ajaxify.data.notes[p].content}c.prompt({title:`[[flags:${f?"edit":"add"}-note]]`,inputType:"textarea",rows:3,value:y,callback:p=>{p&&n.post(`/flags/${ajaxify.data.flagId}/notes`,{note:p,datetime:f}).then(d=>{u.success("[[flags:note-added]]"),o.reloadNotes(d.notes),o.reloadHistory(d.history)}).catch(u.error)},onShown:p=>{console.log(p)}});break}case"appendNote":n.post(`/flags/${ajaxify.data.flagId}/notes`,{note:a.value,datetime:parseInt(a.getAttribute("data-datetime"),10)}).then(e=>{u.success("[[flags:note-added]]"),o.reloadNotes(e.notes),o.reloadHistory(e.history),a.removeAttribute("data-datetime")}).catch(u.error);break;case"delete-note":{const e=parseInt(this.closest("[data-datetime]").getAttribute("data-datetime"),10);c.confirm("[[flags:delete-note-confirm]]",function(f){f&&n.del(`/flags/${ajaxify.data.flagId}/notes/${e}`,{}).then(y=>{u.success("[[flags:note-deleted]]"),o.reloadNotes(y.notes),o.reloadHistory(y.history)}).catch(u.error)});break}case"chat":r.e(93216).then(function(){var e=[r(93216)];(function(f){f.newChat(t)}).apply(null,e)}).catch(r.oe);break;case"ban":s.banAccount(t,ajaxify.refresh);break;case"unban":s.unbanAccount(t);break;case"mute":s.muteAccount(t,ajaxify.refresh);break;case"unmute":s.unmuteAccount(t);break;case"delete-account":l.account(t,ajaxify.refresh);break;case"delete-content":l.content(t,ajaxify.refresh);break;case"delete-all":l.purge(t,ajaxify.refresh);break;case"delete-post":g("delete",n.del,`/posts/${ajaxify.data.target.pid}/state`);break;case"purge-post":g("purge",n.del,`/posts/${ajaxify.data.target.pid}`);break;case"restore-post":g("restore",n.put,`/posts/${ajaxify.data.target.pid}/state`);break;case"delete-flag":{c.confirm("[[flags:delete-flag-confirm]]",function(e){e&&n.del(`/flags/${ajaxify.data.flagId}`,{}).then(()=>{u.success("[[flags:flag-deleted]]"),ajaxify.go("flags")}).catch(u.error)});break}}})};function g(i,t,a){E.translate("[[topic:post-"+i+"-confirm]]",function(e){c.confirm(e,function(f){f&&t(a).then(ajaxify.refresh).catch(u.error)})})}return o.reloadNotes=function(i){ajaxify.data.notes=i,x.render("flags/detail",{notes:i},"notes").then(function(t){const a=A.get("flag/notes");a.empty(),a.html(t),a.find("span.timeago").timeago()})},o.reloadHistory=function(i){app.parseAndTranslate("flags/detail","history",{history:i},function(t){const a=A.get("flag/history");a.empty(),a.html(t),a.find("span.timeago").timeago()})},o}.apply(b,m),h!==void 0&&(j.exports=h)},997:(j,b,r)=>{var m,h;m=[r(74344),r(63281),r(7927)],h=function(A,E,x){const s={};s.account=function(n,c){l(n,"[[user:delete-this-account-confirm]]","/account","[[user:account-deleted]]",c)},s.content=function(n,c){l(n,"[[user:delete-account-content-confirm]]","/content","[[user:account-content-deleted]]",c)},s.purge=function(n,c){l(n,"[[user:delete-all-confirm]]","","[[user:account-deleted]]",c)};function l(n,c,u,o,g){E.confirm(c,function(i){i&&A.del(`/users/${n}${u}`,{}).then(()=>{if(x.success(o),typeof g=="function")return g()}).catch(x.error)})}return s}.apply(b,m),h!==void 0&&(j.exports=h)},56351:(j,b,r)=>{var m,h;m=[r(59006),r(74344),r(63281),r(7927)],h=function(A,E,x,s){const l={};return l.banAccount=function(n,c){n=n||ajaxify.data.theirid,A.render("modals/temporary-ban",{}).then(function(u){x.dialog({className:"ban-modal",title:"[[user:ban-account]]",message:u,show:!0,buttons:{close:{label:"[[global:close]]",className:"btn-link"},submit:{label:"[[user:ban-account]]",callback:function(){const o=$(".ban-modal form").serializeArray().reduce(function(i,t){return i[t.name]=t.value,i},{}),g=o.length>0?Date.now()+o.length*1e3*60*60*(parseInt(o.unit,10)?24:1):0;E.put("/users/"+n+"/ban",{until:g,reason:o.reason||""}).then(()=>{if(typeof c=="function")return c();ajaxify.refresh()}).catch(s.error)}}}})})},l.unbanAccount=function(n){E.del("/users/"+n+"/ban").then(()=>{ajaxify.refresh()}).catch(s.error)},l.muteAccount=function(n,c){n=n||ajaxify.data.theirid,A.render("modals/temporary-mute",{}).then(function(u){x.dialog({className:"mute-modal",title:"[[user:mute-account]]",message:u,show:!0,buttons:{close:{label:"[[global:close]]",className:"btn-link"},submit:{label:"[[user:mute-account]]",callback:function(){const o=$(".mute-modal form").serializeArray().reduce(function(i,t){return i[t.name]=t.value,i},{}),g=o.length>0?Date.now()+o.length*1e3*60*60*(parseInt(o.unit,10)?24:1):0;E.put("/users/"+n+"/mute",{until:g,reason:o.reason||""}).then(()=>{if(typeof c=="function")return c();ajaxify.refresh()}).catch(s.error)}}}})})},l.unmuteAccount=function(n){E.del("/users/"+n+"/mute").then(()=>{ajaxify.refresh()}).catch(s.error)},l}.apply(b,m),h!==void 0&&(j.exports=h)},74344:(j,b,r)=>{r.r(b),r.d(b,{del:()=>i,get:()=>n,head:()=>c,patch:()=>o,post:()=>u,put:()=>g});var m=r(85233),h=r.n(m),A=r(63281),E=r.n(A);const x=config.relative_path+"/api/v3";async function s(t,a){if(t.url=t.url.startsWith("/api")?config.relative_path+t.url:x+t.url,typeof a=="function"){l(t).then(e=>a(null,e),e=>a(e));return}try{return await l(t)}catch(e){if(e.message==="A valid login session was not found. Please log in and try again.")return(0,A.confirm)("[[error:api.reauth-required]]",f=>{f&&ajaxify.go("login")});throw e}}async function l(t){const{url:a}=t;delete t.url,t.data&&!(t.data instanceof FormData)&&(t.data=JSON.stringify(t.data||{}),t.headers["content-type"]="application/json; charset=utf-8"),{options:t}=await(0,m.fire)("filter:api.options",{options:t}),t.data&&(t.body=t.data,delete t.data);const e=await fetch(a,t),{headers:f}=e,y=f.get("content-type"),p=y&&y.startsWith("application/json");let d;if(t.method!=="head"&&(p?d=await e.json():d=await e.text()),!e.ok)throw d?new Error(p?d.status.message:d):new Error(e.statusText);return p&&d&&d.hasOwnProperty("status")&&d.hasOwnProperty("response")?d.response:d}function n(t,a,e){return s({url:t+(a&&Object.keys(a).length?"?"+$.param(a):"")},e)}function c(t,a,e){return s({url:t+(a&&Object.keys(a).length?"?"+$.param(a):""),method:"head"},e)}function u(t,a,e){return s({url:t,method:"post",data:a,headers:{"x-csrf-token":config.csrf_token}},e)}function o(t,a,e){return s({url:t,method:"patch",data:a,headers:{"x-csrf-token":config.csrf_token}},e)}function g(t,a,e){return s({url:t,method:"put",data:a,headers:{"x-csrf-token":config.csrf_token}},e)}function i(t,a,e){return s({url:t,method:"delete",data:a,headers:{"x-csrf-token":config.csrf_token}},e)}}}]);
