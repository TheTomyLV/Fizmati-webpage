"use strict";(self.webpackChunknodebb=self.webpackChunknodebb||[]).push([[5517,70565,21710,1897,83014,52256,66623,49286,99617],{2525:(j,v,d)=>{var C,h;C=[d(39941),d(50548),d(74344),d(7927),d(63281),d(56351),d(997)],h=function(A,x,b,s,o,e,n){const a={};a.init=function(){$('[data-bs-toggle="tooltip"]').tooltip(),A.init($('[component="category/dropdown"]'),{privilege:"moderate"}),t(),r(),f('[data-action="editContent"]',".post-content-editable","textarea",".post-content"),f('[data-action="editTitle"]',".topic-title-editable","input",".topic-title"),$(".posts-list").on("click",".topic-category[data-editable]",function(u){l(this),u.stopPropagation(),u.preventDefault()}),$('[component="post/content"] img:not(.not-responsive)').addClass("img-fluid")};function c(u){return new Promise(g=>{o.confirm(u,g)})}function f(u,g,m,p){$(".posts-list").on("click",u,function(){const y=$(this),E=y.parents("[data-id]").find(g),w=y.parents("[data-id]").find(p);E.length&&(w.addClass("hidden"),E.removeClass("hidden").find(m).focus())}),$(".posts-list").on("blur",g+" "+m,function(){const y=$(this),E=y.parent().parent().find(p),w=y.parents("[data-id]").attr("data-id"),D=u==='[data-action="editTitle"]';socket.emit("posts.editQueuedContent",{id:w,title:D?y.val():void 0,content:D?void 0:y.val()},function(P,S){if(P)return s.error(P);D?E.find(".title-text").text(S.postData.title):E.html(S.postData.content),y.parent().addClass("hidden"),E.removeClass("hidden")})})}function l(u){const g=$(u),m=g.parents("[data-id]").attr("data-id");return x.modal({onSubmit:function(p){Promise.all([b.get(`/categories/${p.cid}`,{}),socket.emit("posts.editQueuedContent",{id:m,cid:p.cid})]).then(function(y){const E=y[0];app.parseAndTranslate("post-queue","posts",{posts:[{category:E}]},function(w){g.find(".category-text").length?g.find(".category-text").text(w.find(".topic-category .category-text").text()):g.replaceWith(w.find(".topic-category"))})}).catch(s.error)}}),!1}function t(){const u=document.querySelector(".posts-list");u&&u.addEventListener("click",g=>{const m=g.target.closest("[data-action]");if(m){const p=m.getAttribute("data-action"),y=m.closest("[data-uid]").getAttribute("data-uid");switch(p){case"editCategory":{const E=g.target.closest("[data-id]").querySelector(".topic-category");l(E);break}case"ban":e.banAccount(y,ajaxify.refresh);break;case"unban":e.unbanAccount(y);break;case"mute":e.muteAccount(y,ajaxify.refresh);break;case"unmute":e.unmuteAccount(y);break;case"delete-account":n.account(y,ajaxify.go.bind(null,"post-queue"));break;case"delete-content":n.content(y,ajaxify.go.bind(null,"post-queue"));break;case"delete-all":n.purge(y,ajaxify.go.bind(null,"post-queue"));break;default:i.call(g.target);break}}})}async function i(){function u(){return new Promise(E=>{const w=o.dialog({title:"[[post-queue:notify-user]]",message:'<textarea class="form-control"></textarea>',buttons:{OK:{label:"[[modules:bootbox.send]]",callback:function(){const D=w.find("textarea").val();D&&E(D)}}}})})}const g=$(this).parents("[data-id]"),m=$(this).attr("data-action"),p=g.attr("data-id"),y=g.get(0).parentNode;if(!(!["accept","reject","notify"].includes(m)||m==="reject"&&!await c(ajaxify.data.canAccept?"[[post-queue:confirm-reject]]":"[[post-queue:confirm-remove]]")))return socket.emit("posts."+m,{id:p,message:m==="notify"?await u():void 0},function(E){if(E)return s.error(E);(m==="accept"||m==="reject")&&g.remove(),y.childElementCount===0&&(ajaxify.data.singlePost?ajaxify.go("/post-queue"+window.location.search):ajaxify.refresh())}),!1}function r(){$('[component="post-queue/bulk-actions"]').on("click","[data-action]",async function(){const u=$(this).attr("data-action");let g=$(".posts-list [data-id]");(u==="accept-selected"||u==="reject-selected")&&(g=g.filter((D,P)=>$(P).find('input[type="checkbox"]').is(":checked")));const m=g.map((D,P)=>$(P).attr("data-id")).get(),p=u==="reject-all"||u==="reject-selected",y=ajaxify.data.canAccept?`${u}-confirm`:`${u.replace(/^reject/,"remove")}-confirm`;if(!m.length||p&&!await c(`[[post-queue:${y}, ${m.length}]]`))return;const E=u.split("-")[0],w=m.map(D=>socket.emit("posts."+E,{id:D}));Promise.allSettled(w).then(function(D){const P=D.filter(k=>k.status==="fulfilled").length,S=D.filter(k=>k.status==="rejected");P&&(s.success(`[[post-queue:bulk-${E}-success, ${P}]]`),ajaxify.refresh()),S.forEach(k=>s.error(k.reason))})})}return a}.apply(v,C),h!==void 0&&(j.exports=h)},997:(j,v,d)=>{var C,h;C=[d(74344),d(63281),d(7927)],h=function(A,x,b){const s={};s.account=function(e,n){o(e,"[[user:delete-this-account-confirm]]","/account","[[user:account-deleted]]",n)},s.content=function(e,n){o(e,"[[user:delete-account-content-confirm]]","/content","[[user:account-content-deleted]]",n)},s.purge=function(e,n){o(e,"[[user:delete-all-confirm]]","","[[user:account-deleted]]",n)};function o(e,n,a,c,f){x.confirm(n,function(l){l&&A.del(`/users/${e}${a}`,{}).then(()=>{if(b.success(c),typeof f=="function")return f()}).catch(b.error)})}return s}.apply(v,C),h!==void 0&&(j.exports=h)},56351:(j,v,d)=>{var C,h;C=[d(59006),d(74344),d(63281),d(7927)],h=function(A,x,b,s){const o={};return o.banAccount=function(e,n){e=e||ajaxify.data.theirid,A.render("modals/temporary-ban",{}).then(function(a){b.dialog({className:"ban-modal",title:"[[user:ban-account]]",message:a,show:!0,buttons:{close:{label:"[[global:close]]",className:"btn-link"},submit:{label:"[[user:ban-account]]",callback:function(){const c=$(".ban-modal form").serializeArray().reduce(function(l,t){return l[t.name]=t.value,l},{}),f=c.length>0?Date.now()+c.length*1e3*60*60*(parseInt(c.unit,10)?24:1):0;x.put("/users/"+e+"/ban",{until:f,reason:c.reason||""}).then(()=>{if(typeof n=="function")return n();ajaxify.refresh()}).catch(s.error)}}}})})},o.unbanAccount=function(e){x.del("/users/"+e+"/ban").then(()=>{ajaxify.refresh()}).catch(s.error)},o.muteAccount=function(e,n){e=e||ajaxify.data.theirid,A.render("modals/temporary-mute",{}).then(function(a){b.dialog({className:"mute-modal",title:"[[user:mute-account]]",message:a,show:!0,buttons:{close:{label:"[[global:close]]",className:"btn-link"},submit:{label:"[[user:mute-account]]",callback:function(){const c=$(".mute-modal form").serializeArray().reduce(function(l,t){return l[t.name]=t.value,l},{}),f=c.length>0?Date.now()+c.length*1e3*60*60*(parseInt(c.unit,10)?24:1):0;x.put("/users/"+e+"/mute",{until:f,reason:c.reason||""}).then(()=>{if(typeof n=="function")return n();ajaxify.refresh()}).catch(s.error)}}}})})},o.unmuteAccount=function(e){x.del("/users/"+e+"/mute").then(()=>{ajaxify.refresh()}).catch(s.error)},o}.apply(v,C),h!==void 0&&(j.exports=h)},74344:(j,v,d)=>{d.r(v),d.d(v,{del:()=>l,get:()=>e,head:()=>n,patch:()=>c,post:()=>a,put:()=>f});var C=d(85233),h=d.n(C),A=d(63281),x=d.n(A);const b=config.relative_path+"/api/v3";async function s(t,i){if(t.url=t.url.startsWith("/api")?config.relative_path+t.url:b+t.url,typeof i=="function"){o(t).then(r=>i(null,r),r=>i(r));return}try{return await o(t)}catch(r){if(r.message==="A valid login session was not found. Please log in and try again.")return(0,A.confirm)("[[error:api.reauth-required]]",u=>{u&&ajaxify.go("login")});throw r}}async function o(t){const{url:i}=t;delete t.url,t.data&&!(t.data instanceof FormData)&&(t.data=JSON.stringify(t.data||{}),t.headers["content-type"]="application/json; charset=utf-8"),{options:t}=await(0,C.fire)("filter:api.options",{options:t}),t.data&&(t.body=t.data,delete t.data);const r=await fetch(i,t),{headers:u}=r,g=u.get("content-type"),m=g&&g.startsWith("application/json");let p;if(t.method!=="head"&&(m?p=await r.json():p=await r.text()),!r.ok)throw p?new Error(m?p.status.message:p):new Error(r.statusText);return m&&p&&p.hasOwnProperty("status")&&p.hasOwnProperty("response")?p.response:p}function e(t,i,r){return s({url:t+(i&&Object.keys(i).length?"?"+$.param(i):"")},r)}function n(t,i,r){return s({url:t+(i&&Object.keys(i).length?"?"+$.param(i):""),method:"head"},r)}function a(t,i,r){return s({url:t,method:"post",data:i,headers:{"x-csrf-token":config.csrf_token}},r)}function c(t,i,r){return s({url:t,method:"patch",data:i,headers:{"x-csrf-token":config.csrf_token}},r)}function f(t,i,r){return s({url:t,method:"put",data:i,headers:{"x-csrf-token":config.csrf_token}},r)}function l(t,i,r){return s({url:t,method:"delete",data:i,headers:{"x-csrf-token":config.csrf_token}},r)}},39941:(j,v,d)=>{var C,h;C=[d(22905),d(74344),d(85233)],h=function(A,x,b){const s={};s.init=function(e,n){if(!e||!e.length)return;n=n||{},n.states=n.states||["watching","notwatching","ignoring"],n.template=n.template||"partials/category/filter-dropdown-left",b.fire("action:category.filter.options",{el:e,options:n}),A.init(e,n);let a=[],c=[];Array.isArray(n.selectedCids)?a=n.selectedCids.map(String):Array.isArray(ajaxify.data.selectedCids)&&(a=ajaxify.data.selectedCids.map(String)),c=a.slice(),e.on("hidden.bs.dropdown",function(){let f=c.length!==a.length;if(c.forEach(function(l,t){l!==a[t]&&(f=!0)}),c=a.slice(),f&&(n.updateButton?n.updateButton({el:e,changed:f,selectedCids:a.slice()}):n.updateButton!==!1&&o(e,a)),n.onHidden){n.onHidden({changed:f,selectedCids:a.slice()});return}if(f){let l=window.location.pathname;const t=utils.params();a.length?t.cid=a:delete t.cid,delete t.page,Object.keys(t).length&&(l+="?"+decodeURIComponent($.param(t))),ajaxify.go(l)}}),e.on("click",'[component="category/list"] [data-cid]',function(){const f=e.find('[component="category/list"]'),l=$(this),t=l.find("a").attr("href");if(t&&t!=="#"&&t.length)return;const i=l.attr("data-cid"),r=l.find('[component="category/select/icon"]');return i!=="all"?(a.includes(i)?a.splice(a.indexOf(i),1):a.push(i),a.sort(function(u,g){return u-g}),r.toggleClass("invisible"),f.find('[data-cid="all"] i').toggleClass("invisible",!!a.length)):(e.find('[component="category/select/icon"]').addClass("invisible"),f.find('[data-cid="all"] i').removeClass("invisible"),a=[]),n.selectedCids=a,n.onSelect&&n.onSelect({cid:i,selectedCids:a.slice()}),!1})};function o(e,n){n.length>1?a({icon:"fa-plus",name:"[[unread:multiple-categories-selected]]",bgColor:"#ddd"}):n.length===1?x.get(`/categories/${n[0]}`,{}).then(a):a();function a(c){app.parseAndTranslate("partials/category/filter-dropdown-content",{selectedCategory:c},function(f){e.find("button").replaceWith($("<div/>").html(f).find("button"))})}}return s}.apply(v,C),h!==void 0&&(j.exports=h)},22905:(j,v,d)=>{var C,h;C=[d(7927),d(73138)],h=function(A,x){const b={};return b.init=function(s,o){let e=null;o=o||{},o.privilege=o.privilege||"topics:read",o.states=o.states||["watching","notwatching","ignoring"],o.cacheList=o.hasOwnProperty("cacheList")?o.cacheList:!0;let n=[];Array.isArray(o.localCategories)&&(n=o.localCategories.map(t=>({...t}))),o.selectedCids=o.selectedCids||ajaxify.data.selectedCids||[];const a=s.find('[component="category-selector-search"]');if(!a.length)return;const c=a.parent('[component="category/dropdown"]').length>0||a.parent('[component="category-selector"]').length>0;s.on("show.bs.dropdown",function(){c&&(s.find(".dropdown-toggle").css({visibility:"hidden"}),a.removeClass("hidden"),a.css({"z-index":s.find(".dropdown-toggle").css("z-index")+1}));function t(){const i=a.find("input").val();i.length>1||!i&&!e?f(i,function(r){e=o.cacheList&&(e||r),l(r)}):!i&&e&&l(e)}a.on("click",function(i){i.preventDefault(),i.stopPropagation()}),a.find("input").val("").on("keyup",utils.debounce(t,300)),t()}),s.on("shown.bs.dropdown",function(){["xs","sm"].includes(utils.findBootstrapEnvironment())||a.find("input").focus()}),s.on("hide.bs.dropdown",function(){c&&(s.find(".dropdown-toggle").css({visibility:"inherit"}),a.addClass("hidden")),a.off("click"),a.find("input").off("keyup")});function f(t,i){socket.emit("categories.categorySearch",{search:t,query:utils.params(),parentCid:o.parentCid||0,selectedCids:o.selectedCids,privilege:o.privilege,states:o.states,showLinks:o.showLinks},function(r,u){if(r)return A.error(r);i(n.concat(u))})}function l(t){const i=o.selectedCids.map(String);t.forEach(function(r){r.selected=i.includes(String(r.cid))}),app.parseAndTranslate(o.template,{categoryItems:t.slice(0,200),selectedCategory:ajaxify.data.selectedCategory,allCategoriesUrl:ajaxify.data.allCategoriesUrl},function(r){s.find('[component="category/list"]').html(r.find('[component="category/list"]').html()),s.find('[component="category/list"] [component="category/no-matches"]').toggleClass("hidden",!!t.length);const u=x.Dropdown.getInstance(s.find(".dropdown-toggle").get(0));u&&u.update()})}},b}.apply(v,C),h!==void 0&&(j.exports=h)},50548:(j,v,d)=>{var C,h;C=[d(22905),d(63281),d(85233),d(32230)],h=function(A,x,b,s){const o={};return o.init=function(e,n){if(!e||!e.length)return;n=n||{};const a=n.onSelect||function(){};n.states=n.states||["watching","notwatching","ignoring"],n.template=n.template||"partials/category/selector-dropdown-left",b.fire("action:category.selector.options",{el:e,options:n}),A.init(e,n);const c={el:e,selectedCategory:null};e.on("click","[data-cid]",function(){const l=$(this);return l.hasClass("disabled")?!1:(c.selectCategory(l.attr("data-cid")),a(c.selectedCategory))});let f=c.el.find('[component="category-selector-selected"]').html();return s.translate(f,l=>{f=l}),c.selectCategory=function(l){const t=c.el.find('[data-cid="'+l+'"]');c.selectedCategory={cid:l,name:t.attr("data-name")},t.length?c.el.find('[component="category-selector-selected"]').html(t.find('[component="category-markup"]').html()):c.el.find('[component="category-selector-selected"]').html(f)},c.getSelectedCategory=function(){return c.selectedCategory},c.getSelectedCid=function(){return c.selectedCategory?c.selectedCategory.cid:0},n.hasOwnProperty("selectedCategory")&&app.parseAndTranslate(n.template,{selectedCategory:n.selectedCategory},function(l){c.el.find('[component="category-selector-selected"]').html(l.find('[component="category-selector-selected"]').html())}),c},o.modal=function(e){e=e||{},e.onSelect=e.onSelect||function(){},e.onSubmit=e.onSubmit||function(){},app.parseAndTranslate("admin/partials/categories/select-category",{message:e.message},function(n){const a=x.dialog({title:e.title||"[[modules:composer.select-category]]",message:n,buttons:{save:{label:"[[global:select]]",className:"btn-primary",callback:f}}}),c=o.init(a.find('[component="category-selector"]'),e);function f(l){return l.preventDefault(),c.selectedCategory&&(e.onSubmit(c.selectedCategory),a.modal("hide")),!1}e.openOnLoad&&a.on("shown.bs.modal",function(){a.find(".dropdown-toggle").dropdown("toggle")}),a.find("form").on("submit",f)})},o}.apply(v,C),h!==void 0&&(j.exports=h)}}]);
