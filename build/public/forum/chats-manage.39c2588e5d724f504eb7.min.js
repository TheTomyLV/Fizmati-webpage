"use strict";(self.webpackChunknodebb=self.webpackChunknodebb||[]).push([[20797,70565,76956,83014,28253,99617,86193],{20363:(w,A,u)=>{var m,h;m=[u(74344),u(7927),u(32230),u(86193),u(75208)],h=function(p,l,r,g,y){const d={};d.init=function(e,c){let t;c.on("click",async function(){let a=[];app.user.isAdmin&&(a=await socket.emit("groups.getChatGroups",{}),Array.isArray(ajaxify.data.groups)&&a.forEach(E=>{E.selected=ajaxify.data.groups.includes(E.name)}));const n=await app.parseAndTranslate("modals/manage-room",{groups:a,user:app.user,room:ajaxify.data});t=bootbox.dialog({title:"[[modules:chat.manage-room]]",message:n,onEscape:!0}),t.attr("component","chat/manage-modal"),s(e,t),i(e,t),o(e,t);const x=t.find('[component="chat/manage/user/list"]'),D=t.find('[component="chat/manage/user/list/search"]');y.addSearchHandler(e,D,async E=>{D.val()?x.html(await app.parseAndTranslate("partials/chats/manage-room-users",E)):s(e,t)}),y.addInfiniteScrollHandler(e,x,async(E,_)=>{E.append(await app.parseAndTranslate("partials/chats/manage-room-users",_))});const b=t.find('[component="chat/manage/user/add/search"]'),f=t.find(".text-danger");g.user(b,function(E,_){f.text(""),p.post(`/chats/${e}/users`,{uids:[_.item.user.uid]}).then(v=>{s(e,t,v),b.val("")}).catch(v=>{r.translate(v.message,function(T){f.text(T)})})}),t.find('[component="chat/manage/save"]').on("click",()=>{const E=t.find('[component="chat/room/notification/setting"]');p.put(`/chats/${e}`,{groups:t.find('[component="chat/room/groups"]').val(),notificationSetting:E.val()}).then(_=>{ajaxify.data.groups=_.groups,ajaxify.data.notificationSetting=_.notificationSetting;const v=_.notificationOptions[0];$('[component="chat/notification/setting"] [data-icon]').first().attr("data-icon",v.icon),$('[component="chat/notification/setting/sub-label"]').translateText(v.subLabel),v.selected&&$('[component="chat/notification/setting/icon"]').attr("class",`fa ${v.icon}`),t.modal("hide")}).catch(l.error)})})};function i(e,c){c.on("click",'[data-action="kick"]',function(){const t=parseInt(this.getAttribute("data-uid"),10);p.del(`/chats/${e}/users/${t}`,{}).then(a=>{s(e,c,a)}).catch(l.error)})}function o(e,c){c.on("click",'[data-action="toggleOwner"]',async function(){const t=parseInt(this.getAttribute("data-uid"),10),a=$(this);await socket.emit("modules.chats.toggleOwner",{roomId:e,uid:t}),a.parents("[data-uid]").find('[component="chat/manage/user/owner/icon"]').toggleClass("hidden")})}async function s(e,c,t){const a=c.find('[component="chat/manage/user/list"]');if(!t)try{t=await p.get(`/chats/${e}/users`,{})}catch{a.find("li").text(await r.translate("[[error:invalid-data]]"))}a.find('[data-bs-toggle="tooltip"]').tooltip("dispose"),a.html(await app.parseAndTranslate("partials/chats/manage-room-users",t)),a.find('[data-bs-toggle="tooltip"]').tooltip()}return d}.apply(A,m),h!==void 0&&(w.exports=h)},75208:(w,A,u)=>{var m,h;m=[u(74344)],h=function(p){const l={};let r=0;l.init=function(i,o){const s=o.find('[component="chat/user/list"]');if(!s.length)return;const e=o.find('[component="chat/messages/pinned/container"]');o.find('[component="chat/user/list/btn"]').on("click",()=>{s.toggleClass("hidden"),s.hasClass("hidden")?y():(e.addClass("hidden"),g(i,s))}),$(window).off("action:ajaxify.start",y).one("action:ajaxify.start",y),l.addInfiniteScrollHandler(i,s,async(c,t)=>{c.append(await app.parseAndTranslate("partials/chats/user-list","users",t))})};function g(i,o){r&&clearInterval(r),r=setInterval(()=>{d(i,o)},5e3)}function y(){r&&(clearInterval(r),r=0)}async function d(i,o){if(ajaxify.data.template.chats&&app.isFocused&&o.scrollTop()===0&&!o.hasClass("hidden")){const s=await p.get(`/chats/${i}/users`,{start:0});o.find('[data-bs-toggle="tooltip"]').tooltip("dispose"),o.html(await app.parseAndTranslate("partials/chats/user-list","users",s)),o.find('[data-bs-toggle="tooltip"]').tooltip()}}return l.addInfiniteScrollHandler=function(i,o,s){o.on("scroll",utils.debounce(async()=>{const e=(o[0].scrollHeight-o.height())*.85;if(o.scrollTop()>e){const c=o.find("[data-index]").last().attr("data-index"),t=await p.get(`/chats/${i}/users`,{start:parseInt(c,10)+1});t&&t.users.length&&s(o,t)}},200))},l.addSearchHandler=function(i,o,s){o.on("keyup",utils.debounce(async()=>{const e=o.val(),c=await socket.emit("modules.chats.searchMembers",{username:e,roomId:i});s(c)},200))},l}.apply(A,m),h!==void 0&&(w.exports=h)},74344:(w,A,u)=>{u.r(A),u.d(A,{del:()=>c,get:()=>d,head:()=>i,patch:()=>s,post:()=>o,put:()=>e});var m=u(85233),h=u.n(m),p=u(63281),l=u.n(p);const r=config.relative_path+"/api/v3";async function g(t,a){if(t.url=t.url.startsWith("/api")?config.relative_path+t.url:r+t.url,typeof a=="function"){y(t).then(n=>a(null,n),n=>a(n));return}try{return await y(t)}catch(n){if(n.message==="A valid login session was not found. Please log in and try again.")return(0,p.confirm)("[[error:api.reauth-required]]",x=>{x&&ajaxify.go("login")});throw n}}async function y(t){const{url:a}=t;delete t.url,t.data&&!(t.data instanceof FormData)&&(t.data=JSON.stringify(t.data||{}),t.headers["content-type"]="application/json; charset=utf-8"),{options:t}=await(0,m.fire)("filter:api.options",{options:t}),t.data&&(t.body=t.data,delete t.data);const n=await fetch(a,t),{headers:x}=n,D=x.get("content-type"),b=D&&D.startsWith("application/json");let f;if(t.method!=="head"&&(b?f=await n.json():f=await n.text()),!n.ok)throw f?new Error(b?f.status.message:f):new Error(n.statusText);return b&&f&&f.hasOwnProperty("status")&&f.hasOwnProperty("response")?f.response:f}function d(t,a,n){return g({url:t+(a&&Object.keys(a).length?"?"+$.param(a):"")},n)}function i(t,a,n){return g({url:t+(a&&Object.keys(a).length?"?"+$.param(a):""),method:"head"},n)}function o(t,a,n){return g({url:t,method:"post",data:a,headers:{"x-csrf-token":config.csrf_token}},n)}function s(t,a,n){return g({url:t,method:"patch",data:a,headers:{"x-csrf-token":config.csrf_token}},n)}function e(t,a,n){return g({url:t,method:"put",data:a,headers:{"x-csrf-token":config.csrf_token}},n)}function c(t,a,n){return g({url:t,method:"delete",data:a,headers:{"x-csrf-token":config.csrf_token}},n)}},86193:(w,A,u)=>{var m,h;m=[u(74344),u(7927)],h=function(p,l){const r={},g={delay:200,appendTo:null};r.init=d=>{const i={...g,...d},{input:o,onSelect:s}=i;app.loadJQueryUI(function(){o.autocomplete({...i,open:function(){$(this).autocomplete("widget").css("z-index",100005)},select:function(e,c){y(o,s,e,c)}})})},r.user=function(d,i,o){typeof i=="function"&&(o=i,i={}),i=i||{},r.init({input:d,onSelect:o,source:(s,e)=>{i.query=s.term,p.get("/api/users",i,function(c,t){if(c)return l.error(c);if(t&&t.users){const a=t.users.map(function(n){const x=$("<div></div>").html(n.username).text();return n&&{label:x,value:x,user:{uid:n.uid,name:n.username,slug:n.userslug,username:n.username,userslug:n.userslug,picture:n.picture,banned:n.banned,"icon:text":n["icon:text"],"icon:bgColor":n["icon:bgColor"]}}});e(a)}$(".ui-autocomplete a").attr("data-ajaxify","false")})}})},r.group=function(d,i){r.init({input:d,onSelect:i,source:(o,s)=>{socket.emit("groups.search",{query:o.term},function(e,c){if(e)return l.error(e);if(c&&c.length){const t=c.map(function(a){return a&&{label:a.name,value:a.name,group:a}});s(t)}$(".ui-autocomplete a").attr("data-ajaxify","false")})}})},r.tag=function(d,i){r.init({input:d,onSelect:i,delay:100,source:(o,s)=>{socket.emit("topics.autocompleteTags",{query:o.term,cid:ajaxify.data.cid||0},function(e,c){if(e)return l.error(e);c&&s(c),$(".ui-autocomplete a").attr("data-ajaxify","false")})}})};function y(d,i,o,s){i=i||function(){};const e=jQuery.Event("keypress");e.which=13,e.keyCode=13,setTimeout(function(){d.trigger(e)},100),i(o,s)}return r}.apply(A,m),h!==void 0&&(w.exports=h)}}]);
