"use strict";(self.webpackChunknodebb=self.webpackChunknodebb||[]).push([[63388,48724,86815,61237],{59016:(m,g,s)=>{var p,d;p=[s(4695),s(80431),s(50395),s(7927)],d=function(l,h,f,r){const u={};u.prepareDOM=function(){app.user.uid>0&&l.initUnreadTopics(),h.prepareDOM(),f.prepareDOM(),t(),e(),o()};function t(){$('[component="header/usercontrol"] [data-status]').off("click").on("click",function(a){const n=$(this).attr("data-status");socket.emit("user.setStatus",n,function(i){if(i)return r.error(i);$('[data-uid="'+app.user.uid+'"] [component="user/status"], [component="header/profilelink"] [component="user/status"]').removeClass("away online dnd offline").addClass(n),$('[component="header/usercontrol"] [data-status]').each(function(){$(this).toggleClass("selected",$(this).attr("data-status")===n)}),app.user.status=n}),a.preventDefault()})}function e(){const a=utils.findBootstrapEnvironment();a==="xs"||a==="sm"||utils.isTouchDevice()||$("#header-menu #main-nav").tooltip({selector:".nav-item",placement:"bottom",trigger:"hover",container:"body",animation:!1})}function o(){$("body").on("click",'[component="user/logout"]',function(){return s.e(70145).then(function(){var a=[s(39002)];(function(n){n()}).apply(null,a)}).catch(s.oe),!1})}return u}.apply(g,p),d!==void 0&&(m.exports=d)},50395:(m,g,s)=>{var p,d;p=[s(7237),s(85233)],d=function(l,h){const f={};f.prepareDOM=function(){const o=$('[component="chat/dropdown"]');o.length&&(o.on("show.bs.dropdown",a=>{e("loadChatsDropdown",$(a.target).parent().find('[component="chat/list"]'))}),o.each((a,n)=>{const i=$(n).parent().find(".dropdown-menu");i.hasClass("show")&&e("loadChatsDropdown",i.find('[component="chat/list"]'))}),socket.removeListener("event:chats.receive",r),socket.on("event:chats.receive",r),socket.removeListener("event:chats.typing",u),socket.on("event:chats.typing",u),socket.removeListener("event:chats.roomRename",t),socket.on("event:chats.roomRename",t),socket.on("event:unread.updateChatCount",async function(a){if(a){const[C,v]=await app.require(["chat","forum/chats"]);if(C.isFromBlockedUser(a.fromUid)||C.isLookingAtRoom(a.roomId)||app.user.uid===parseInt(a.fromUid,10))return;v.markChatPageElUnread(a)}let n=await socket.emit("modules.chats.getUnreadCount",{});const i=l.get("chat/icon");n=Math.max(0,n),i.toggleClass("fa-comment",n>0).toggleClass("fa-comment-o",n<=0);const c=n>99?"99+":n;l.get("chat/icon").toggleClass("unread-count",n>0).attr("data-content",c),l.get("chat/count").toggleClass("hidden",n<=0).text(c),h.fire("action:chat.updateCount",{count:n})}))};function r(o){e("onChatMessageReceived",o)}function u(o){e("onUserTyping",o)}function t(o){e("onRoomRename",o)}async function e(o,a){(await app.require("chat"))[o](a)}return f}.apply(g,p),d!==void 0&&(m.exports=d)},80431:(m,g,s)=>{var p;p=function(){const d={};d.prepareDOM=function(){const r=$('[component="notifications"] [data-bs-toggle="dropdown"]');r.length&&(r.on("show.bs.dropdown",u=>{f("loadNotifications",$(u.target).parent().find('[component="notifications/list"]'))}),r.each((u,t)=>{const e=$(t).parent().find(".dropdown-menu");e.hasClass("show")&&f("loadNotifications",e.find('[component="notifications/list"]'))}),socket.removeListener("event:new_notification",l),socket.on("event:new_notification",l),socket.removeListener("event:notifications.updateCount",h),socket.on("event:notifications.updateCount",h))};function l(r){f("onNewNotification",r)}function h(r){f("updateNotifCount",r)}function f(r,u){Promise.all([s.e(42840),s.e(70071)]).then(function(){var t=[s(69986)];(function(e){e[r](u)}).apply(null,t)}).catch(s.oe)}return d}.call(g,s,g,m),p!==void 0&&(m.exports=p)},4695:(m,g,s)=>{var p,d;p=[s(85233)],d=function(l){const h={},f={ignoring:1,notwatching:2,watching:3};h.initUnreadTopics=function(){const t=app.user.unreadData;function e(n){if(n&&n.posts&&n.posts.length&&t){const i=n.posts[0];if(parseInt(i.uid,10)===parseInt(app.user.uid,10)||!i.topic.isFollowing&&i.categoryWatchState!==f.watching)return;const c=i.topic.tid;(!t[""][c]||!t.new[c]||!t.watched[c]||!t.unreplied[c])&&a(c),t[""][c]||(o(""),t[""][c]=!0),i.isMain&&parseInt(i.uid,10)!==parseInt(app.user.uid,10)&&!t.new[c]&&(o("new"),t.new[c]=!0),parseInt(i.topic.postcount,10)<=1&&!t.unreplied[c]&&(o("unreplied"),t.unreplied[c]=!0),i.topic.isFollowing&&!t.watched[c]&&(o("watched"),t.watched[c]=!0)}}function o(n){const i="/unread"+(n?"?filter="+n:""),c=1+parseInt($('a[href="'+config.relative_path+i+'"].navigation-link i').attr("data-content"),10);u(i,c)}function a(n){$('[data-tid="'+n+'"]').addClass("unread")}$(window).on("action:ajaxify.end",function(){ajaxify.data.template.topic&&["","new","watched","unreplied"].forEach(function(n){delete t[n][ajaxify.data.tid]})}),socket.removeListener("event:new_post",e),socket.on("event:new_post",e),socket.removeListener("event:unread.updateCount",r),socket.on("event:unread.updateCount",r)};function r(t){u("/unread",t.unreadTopicCount),u("/unread?filter=new",t.unreadNewTopicCount),u("/unread?filter=watched",t.unreadWatchedTopicCount),u("/unread?filter=unreplied",t.unreadUnrepliedTopicCount)}function u(t,e){if(!utils.isNumber(e))return;e=Math.max(0,e);const o=e>99?"99+":e,a=$('a[href="'+config.relative_path+t+'"].navigation-link');a.find("i").toggleClass("unread-count",e>0).attr("data-content",o),a.find('[component="navigation/count"]').toggleClass("hidden",e<=0).text(e),$('#mobile-menu [data-unread-url="'+t+'"]').attr("data-content",o),$('[component="unread/count"][data-unread-url="'+t+'"]').toggleClass("hidden",e<=0).text(o),l.fire("action:unread.updateCount",{url:t,count:e})}return h.updateUnreadTopicCount=u,h}.apply(g,p),d!==void 0&&(m.exports=d)}}]);
