(self.webpackChunknodebb=self.webpackChunknodebb||[]).push([[19285,84781,54354,43034,3564],{64451:(E,j,o)=>{"use strict";var C,b;C=[o(25142),o(60392),o(54939),o(91748),o(60447),o(42840),o(69241),o(6e4),o(7237),o(66603),o(85233),o(74344),o(7927),o(63281),o(42152)],b=function(m,I,s,y,k,n,l,r,t,i,a,c,h,v,D){const x={};let A=0,w="";$(window).on("action:ajaxify.start",function(d,f){y.removeListeners(),String(f.url).startsWith("topic/")||(n.disable(),t.get("navbar/title").find("span").text("").hide(),h.remove("bookmark"))}),x.init=async function(){const d=!A||parseInt(A,10)!==parseInt(ajaxify.data.tid,10);A=ajaxify.data.tid,w=ajaxify.currentPage,a.fire("action:topic.loading"),app.enterRoom("topic_"+A),d&&(k.signaturesShown={}),await k.onTopicPageLoad(t.get("post")),n.init('[component="topic"]>[component="post"]',ajaxify.data.postcount,x.toTop,x.toBottom,x.navigatorCallback),s.init(A),I.init(A,$(".topic")),y.init(),l.handleSort("topicPostSort","topic/"+ajaxify.data.slug),config.usePagination||m.init($('[component="topic"]'),k.loadMorePosts),g(),P(),N(),K(),Y(),Q(),H(A),e(),$(window).on("scroll",utils.debounce(B,250)),U(),a.fire("action:topic.loaded",ajaxify.data)};function U(){Promise.resolve().then(function(){var d=[o(42441)];(f=>{config.topicSearchEnabled&&Promise.resolve().then(function(){var p=[o(7073)];(function(u){f.bind(["command+f","ctrl+f"],function(S){S.preventDefault();let T=$('[component="navbar"] [component="search/form"]');T.length||(T=$('[component="sidebar/right"] [component="search/form"]')),T.find('[component="search/fields"] input[name="query"]').val("in:topic-"+ajaxify.data.tid+" "),u.showAndFocusInput(T)}),a.onPage("action:ajaxify.cleanup",()=>{f.unbind(["command+f","ctrl+f"])})}).apply(null,p)}).catch(o.oe),f.bind("j",p=>{if(p.target.classList.contains("mousetrap"))return;const u=n.getIndex(),S=n.getCount();u!==S&&n.scrollToIndex(u,!0,0)}),f.bind("k",p=>{if(p.target.classList.contains("mousetrap"))return;const u=n.getIndex();u!==1&&n.scrollToIndex(u-2,!0,0)})}).apply(null,d)}).catch(o.oe)}x.toTop=function(){n.scrollTop(0)},x.toBottom=function(){socket.emit("topics.postcount",ajaxify.data.tid,function(d,f){if(d)return h.error(d);n.scrollBottom(f-1)})};function H(d){if(window.location.hash){const u=$(utils.escapeHTML(window.location.hash));if(u.length){const S=u.parents("[data-pid]");return n.scrollToElement(S,!0,0)}}const f=ajaxify.data.bookmark||i.getItem("topic:"+d+":bookmark"),p=ajaxify.data.postIndex;if(L(p),n.shouldScrollToPost(p))return n.scrollToPostIndex(p-1,!0,0);f&&(!config.usePagination||config.usePagination&&ajaxify.data.pagination.currentPage===1)&&ajaxify.data.postcount>ajaxify.data.bookmarkThreshold&&h.alert({alert_id:"bookmark",message:"[[topic:bookmark-instructions]]",timeout:15e3,type:"info",clickfn:function(){n.scrollToIndex(Math.max(0,parseInt(f,10)-1),!0)},closefn:function(){i.removeItem("topic:"+d+":bookmark")}})}function e(){const d=document.querySelector('[component="topic/thumb/list"]');d&&d.addEventListener("click",async f=>{const p=f.target.closest("a");if(p){const u=Array.from(p.parentNode.children).indexOf(p);f.preventDefault();const S=ajaxify.data.thumbs.map(R=>({...R}));S.forEach((R,F)=>{R.selected=F===u});const T=await app.parseAndTranslate("modals/topic-thumbs-view",{src:p.href,thumbs:S});v.dialog({size:"lg",onEscape:!0,backdrop:!0,message:T}).on("click",'[component="topic/thumb/select"]',function(){$('[component="topic/thumb/select"]').removeClass("border-primary"),$(this).addClass("border-primary"),$('[component="topic/thumb/current"]').attr("src",$(this).attr("src"))})}})}function g(){t.get("topic").on("click","blockquote .toggle",function(){const d=$(this).parent("blockquote"),f=$(this);d.toggleClass("uncollapsed");const p=!d.hasClass("uncollapsed");f.toggleClass("fa-angle-down",p).toggleClass("fa-angle-up",!p)})}function P(){new D('[component="copy/code/btn"]',{text:function(f){const p=$(f);p.find("i").removeClass("fa-copy").addClass("fa-check"),setTimeout(()=>p.find("i").removeClass("fa-check").addClass("fa-copy"),2e3);const u=p.parent().find("code");return u.attr("data-lines")?u.find(".hljs-ln-code[data-line-number]").map((S,T)=>T.textContent).get().join(`
`):u.text()}});function d(){function f(R){return R.scrollHeight>R.clientHeight}function p(R){if(R.length){if(!R[0].scrollHeight)return setTimeout(p,100,R);f(R.get(0))&&R.parent().parent().find('[component="copy/code/btn"]').css({margin:"0.5rem 1.5rem 0 0"})}}let u=$('[component="topic"] [component="post/content"] code:not([data-button-added])');u=u.filter((R,F)=>$(F).text().includes(`
`));const S=$('<div class="hover-parent position-relative"></div>'),T=$('<button component="copy/code/btn" class="hover-visible position-absolute top-0 btn btn-sm btn-outline-secondary" style="right: 0px; margin: 0.5rem 0.5rem 0 0;"><i class="fa fa-fw fa-copy"></i></button>'),W=u.parent();W.wrap(S).parent().append(T),W.parent().find('[component="copy/code/btn"]').translateAttr("title","[[topic:copy-code]]"),W.each((R,F)=>{p($(F).find("code"))}),u.attr("data-button-added",1)}a.registerPage("action:posts.loaded",d),a.registerPage("action:topic.loaded",d),a.registerPage("action:posts.edited",d)}function N(){t.get("topic").on("click",'[component="post/parent"]',function(d){const f=$(this).attr("data-topid"),p=$('[component="topic"]>[component="post"][data-pid="'+f+'"]');if(p.length)return d.preventDefault(),n.scrollToIndex(p.attr("data-index"),!0),!1})}function K(){$('[component="topic"]').on("click",'[component="post/reply-count"]',function(){const d=$(this);o.e(21352).then(function(){var f=[o(21352)];(function(p){p.init(d)}).apply(null,f)}).catch(o.oe)})}function Y(){if(!ajaxify.data.showPostPreviewsOnHover||utils.isMobile())return;let d=0,f=!1;const p={};function u(){clearTimeout(d),$("#post-tooltip").remove(),f=!0}$(window).one("action:ajaxify.start",u),$('[component="topic"]').on("mouseenter",'[component="post"] a, [component="topic/event"] a',async function(){const S=$(this);f=!1;async function T(O){const M=p[O]||await c.get(`/posts/${O}/summary`);if($("#post-tooltip").remove(),M&&ajaxify.data.template.topic){p[O]=M;const z=await app.parseAndTranslate("partials/topic/post-preview",{post:M});if(f)return;z.hide().find(".timeago").timeago(),z.appendTo($("body")).fadeIn(300);const X=S.parents('[component="topic"]').find('[component="post/content"]').first(),Z=X.offset(),q=X.width(),_=S.offset();z.css({top:_.top+30,left:Z.left,width:q})}}const W=S.attr("href"),R=utils.urlToLocation(W),F=R.pathname,J=W&&W!=="#"&&window.location.hostname===R.hostname;$("#post-tooltip").remove();const V=J&&F&&F.match(/\/post\/([\d]+)/),G=J&&F&&F.match(/\/topic\/([\d]+)/);if(V){const O=V[1];if(parseInt(S.parents('[component="post"]').attr("data-pid"),10)===parseInt(O,10))return;d=setTimeout(async()=>{T(O)},300)}else G&&(d=setTimeout(async()=>{const O=G[1],M=await c.get("/topics/"+O,{});T(M.mainPid)},300))}).on("mouseleave",'[component="post"] a, [component="topic/event"] a',u)}function Q(){(config.enableQuickReply||config.theme&&config.theme.enableQuickReply)&&r.init()}function B(){const d=t.get("navbar/title").find("span");$(window).scrollTop()>50&&d.hasClass("hidden")?d.html(ajaxify.data.title).removeClass("hidden"):$(window).scrollTop()<=50&&!d.hasClass("hidden")&&d.html("").addClass("hidden"),$(window).scrollTop()>300&&h.remove("bookmark")}x.navigatorCallback=function(d,f){if(!ajaxify.data.template.topic||n.scrollActive)return;const p="topic/"+ajaxify.data.slug+(d>1?"/"+d:"");if(p!==w&&(w=p,d>=f&&app.user.uid&&c.put(`/topics/${ajaxify.data.tid}/read`),L(d),ajaxify.data.updateUrlWithPostIndex&&history.replaceState)){let u=window.location.search||"";config.usePagination||(u=u&&!/^\?page=\d+$/.test(u)?u:""),history.replaceState({url:p+u},null,window.location.protocol+"//"+window.location.host+config.relative_path+"/"+p+u)}};function L(d){const f="topic:"+ajaxify.data.tid+":bookmark",p=ajaxify.data.bookmark||i.getItem(f);config.topicPostSort==="newest_to_oldest"&&(d=Math.max(1,ajaxify.data.postcount-d+2)),ajaxify.data.postcount>ajaxify.data.bookmarkThreshold&&(!p||parseInt(d,10)>parseInt(p,10)||ajaxify.data.postcount<parseInt(p,10))&&(app.user.uid?(ajaxify.data.bookmark=Math.min(d,ajaxify.data.postcount),socket.emit("topics.bookmark",{tid:ajaxify.data.tid,index:ajaxify.data.bookmark},function(u){if(u)return ajaxify.data.bookmark=p,h.error(u)})):i.setItem(f,d)),(!p||parseInt(d,10)>=parseInt(p,10))&&h.remove("bookmark")}return x}.apply(j,C),b!==void 0&&(E.exports=b)},91748:(E,j,o)=>{"use strict";var C,b;C=[o(54939),o(60392),o(60447),o(47720),o(7237),o(32230),o(85233)],b=function(m,I,s,y,k,n,l){const r={},t={"event:user_status_change":i,"event:voted":a,"event:bookmarked":c,"event:topic_deleted":I.setDeleteState,"event:topic_restored":I.setDeleteState,"event:topic_purged":h,"event:topic_locked":I.setLockedState,"event:topic_unlocked":I.setLockedState,"event:topic_pinned":I.setPinnedState,"event:topic_unpinned":I.setPinnedState,"event:topic_moved":v,"event:post_edited":D,"event:post_purged":x,"event:post_deleted":A,"event:post_restored":A,"posts.bookmark":w,"posts.unbookmark":w,"posts.upvote":U,"posts.downvote":U,"posts.unvote":U,"event:new_notification":H,"event:new_post":s.onNewPost};r.init=function(){r.removeListeners();for(const e in t)t.hasOwnProperty(e)&&socket.on(e,t[e])},r.removeListeners=function(){for(const e in t)t.hasOwnProperty(e)&&socket.removeListener(e,t[e])};function i(e){app.updateUserStatus($('[data-uid="'+e.uid+'"] [component="user/status"]'),e.status)}function a(e){const g=$('[data-pid="'+e.post.pid+'"] [component="post/vote-count"]').filter(function(N,K){return parseInt($(K).closest("[data-pid]").attr("data-pid"),10)===parseInt(e.post.pid,10)}),P=$('.reputation[data-uid="'+e.post.uid+'"]');g.html(e.post.votes).attr("data-votes",e.post.votes),P.html(e.user.reputation).attr("data-reputation",e.user.reputation)}function c(e){$('[data-pid="'+e.post.pid+'"] .bookmarkCount').filter(function(g,P){return parseInt($(P).closest("[data-pid]").attr("data-pid"),10)===parseInt(e.post.pid,10)}).html(e.post.bookmarks).attr("data-bookmarks",e.post.bookmarks)}function h(e){ajaxify.data.category&&ajaxify.data.category.slug&&parseInt(e.tid,10)===parseInt(ajaxify.data.tid,10)&&ajaxify.go("category/"+ajaxify.data.category.slug,null,!0)}function v(e){e&&e.slug&&parseInt(e.tid,10)===parseInt(ajaxify.data.tid,10)&&ajaxify.go("topic/"+e.slug,null,!0)}function D(e){if(!e||!e.post||parseInt(e.post.tid,10)!==parseInt(ajaxify.data.tid,10))return;const g=k.get("post/content",e.post.pid).filter(function(B,L){return parseInt($(L).closest("[data-pid]").attr("data-pid"),10)===parseInt(e.post.pid,10)}),P=$(`[data-pid="${e.post.pid}"]`),N=P.find('[component="post/editor"]').filter(function(B,L){return parseInt($(L).closest("[data-pid]").attr("data-pid"),10)===parseInt(e.post.pid,10)}),K=k.get("topic/title"),Y=k.get("navbar/title").find("span"),Q=k.get("breadcrumb/current");if(e.topic.rescheduled)return ajaxify.go("topic/"+e.topic.slug,null,!0);if(K.length&&e.topic.title&&e.topic.renamed){ajaxify.data.title=e.topic.title;const B="topic/"+e.topic.slug+(window.location.search?window.location.search:"");history.replaceState({url:B},null,window.location.protocol+"//"+window.location.host+config.relative_path+"/"+B),K.fadeOut(250,function(){K.html(e.topic.title).fadeIn(250)}),Q.fadeOut(250,function(){Q.html(e.topic.title).fadeIn(250)}),Y.fadeOut(250,function(){Y.html(e.topic.title).fadeIn(250)})}e.post.changed?g.fadeOut(250,function(){if(g.html(n.unescape(e.post.content)),g.find("img:not(.not-responsive)").addClass("img-fluid"),y.wrapImagesInLinks(g.parent()),s.addBlockquoteEllipses(g.parent()),g.fadeIn(250),e.post.edited){const B={editor:e.editor,editedISO:utils.toISOString(e.post.edited)};app.parseAndTranslate("partials/topic/post-editor",B,function(L){N.replaceWith(L),P.find('[component="post/edit-indicator"]').removeClass("hidden").translateAttr("title",`[[global:edited-timestamp, ${B.editedISO}]]`),P.find('[component="post/editor"] .timeago').timeago(),l.fire("action:posts.edited",e)})}}):l.fire("action:posts.edited",e),e.topic.tags&&e.topic.tagsupdated&&o.e(62516).then(function(){var B=[o(62516)];(function(L){L.updateTopicTags([e.topic])}).apply(null,B)}).catch(o.oe),m.removeMenu(k.get("post","pid",e.post.pid))}function x(e){!e||parseInt(e.tid,10)!==parseInt(ajaxify.data.tid,10)||(k.get("post","pid",e.pid).fadeOut(500,function(){$(this).remove(),s.showBottomPostBar()}),ajaxify.data.postcount-=1,m.updatePostCount(ajaxify.data.postcount),o.e(21352).then(function(){var g=[o(21352)];(function(P){P.onPostPurged(e)}).apply(null,g)}).catch(o.oe))}function A(e){const g=k.get("post","pid",e.pid);if(!g.length)return;g.toggleClass("deleted");const P=g.hasClass("deleted");m.toggle(e.pid,P),!ajaxify.data.privileges.isAdminOrMod&&parseInt(e.uid,10)!==parseInt(app.user.uid,10)&&(g.find('[component="post/tools"]').toggleClass("hidden",P),P?g.find('[component="post/content"]').translateHtml("[[topic:post-is-deleted]]"):g.find('[component="post/content"]').html(n.unescape(e.content)))}function w(e){const g=$('[data-pid="'+e.post.pid+'"] [component="post/bookmark"]').filter(function(P,N){return parseInt($(N).closest("[data-pid]").attr("data-pid"),10)===parseInt(e.post.pid,10)});g.length&&(g.attr("data-bookmarked",e.isBookmarked),g.find('[component="post/bookmark/on"]').toggleClass("hidden",!e.isBookmarked),g.find('[component="post/bookmark/off"]').toggleClass("hidden",e.isBookmarked))}function U(e){const g=$('[data-pid="'+e.post.pid+'"]');g.find('[component="post/upvote"]').filter(function(P,N){return parseInt($(N).closest("[data-pid]").attr("data-pid"),10)===parseInt(e.post.pid,10)}).toggleClass("upvoted",e.upvote),g.find('[component="post/downvote"]').filter(function(P,N){return parseInt($(N).closest("[data-pid]").attr("data-pid"),10)===parseInt(e.post.pid,10)}).toggleClass("downvoted",e.downvote)}function H(e){const g=ajaxify.data.tid;e&&e.tid&&parseInt(e.tid,10)===parseInt(g,10)&&socket.emit("topics.markTopicNotificationsRead",[g])}return r}.apply(j,C),b!==void 0&&(E.exports=b)},47913:(E,j,o)=>{E.exports=o(66485)},45482:(E,j,o)=>{E.exports=o(35729)},83713:(E,j,o)=>{E.exports=o(51077)},38259:(E,j,o)=>{E.exports=o(65616)},6e4:(E,j,o)=>{"use strict";var C,b;C=[o(7237),o(44541),o(2585),o(74344),o(7927),o(33371),o(42441),o(66603)],b=function(m,I,s,y,k,n,l,r){const t={};t.init=function(){const a=m.get("topic/quickreply/text"),c=`qr:draft:tid:${ajaxify.data.tid}`,h={element:a,strategies:[],options:{style:{"z-index":100}}};i(),$(window).one("action:ajaxify.start",()=>{i()}),$(window).trigger("composer:autocomplete:init",h),s._active.core_qr=s.setup(h),l.bind("ctrl+return",x=>{x.target===a.get(0)&&m.get("topic/quickreply/button").get(0).click()}),n.init({dragDropAreaEl:$('[component="topic/quickreply/container"] .quickreply-message'),pasteEl:a,uploadFormEl:$('[component="topic/quickreply/upload"]'),inputEl:a,route:"/api/post/upload",callback:function(x){let A=a.val();x.forEach(w=>{A=A+(A?`
`:"")+(w.isImage?"!":"")+`[${w.filename}](${w.url})`}),a.val(A)}});let v=!0;m.get("topic/quickreply/button").on("click",function(x){if(x.preventDefault(),!v)return;const A=m.get("topic/quickreply/text").val(),w={tid:ajaxify.data.tid,handle:void 0,content:A},U=A.length;if(U<parseInt(config.minimumPostLength,10))return k.error("[[error:content-too-short, "+config.minimumPostLength+"]]");if(U>parseInt(config.maximumPostLength,10))return k.error("[[error:content-too-long, "+config.maximumPostLength+"]]");v=!1,y.post(`/topics/${ajaxify.data.tid}`,w,function(H,e){if(v=!0,H)return k.error(H);e&&e.queued&&k.alert({type:"success",title:"[[global:alert.success]]",message:e.message,timeout:1e4,clickfn:function(){ajaxify.go(`/post-queue/${e.id}`)}}),m.get("topic/quickreply/text").val(""),r.removeItem(c),s._active.core_qr.hide()})});const D=r.getItem(c);D&&a.val(D),a.on("keyup",utils.debounce(function(){const x=a.val();x?r.setItem(c,x):r.removeItem(c)},1e3)),m.get("topic/quickreply/expand").on("click",x=>{x.preventDefault(),r.removeItem(c);const A=m.get("topic/quickreply/text");I.newReply({tid:ajaxify.data.tid,title:ajaxify.data.title,body:A.val()}),A.val("")})};function i(){s._active.core_qr&&(s._active.core_qr.destroy(),s._active.core_qr=null)}return t}.apply(j,C),b!==void 0&&(E.exports=b)},69241:(E,j,o)=>{"use strict";var C,b;C=[o(7237)],b=function(m){const I={};return I.handleSort=function(s,y){const k=m.get("thread/sort");k.find("i").removeClass("fa-check");const n=utils.params().sort||config[s];k.find('a[data-sort="'+n+'"]').find("i").addClass("fa-check"),$("body").off("click",'[component="thread/sort"] a').on("click",'[component="thread/sort"] a',function(){const r=$(this).attr("data-sort"),t=utils.params();t.sort=r;const i=decodeURIComponent($.param(t));ajaxify.go(y+(i?"?"+i:""))})},I}.apply(j,C),b!==void 0&&(E.exports=b)},27145:(E,j,o)=>{"use strict";E=o.nmd(E);var C,b;C=[o(32230),o(85233)],b=function(m,I){const s={};let y=!1;s.init=function(){if(s.taskbar=$('[component="taskbar"]'),s.tasklist=s.taskbar.find("ul"),!s.taskbar.length||!s.tasklist.length){y=!0;return}s.taskbar.on("click","li",async function(){const t=$(this),i=t.attr("data-module"),a=t.attr("data-uuid"),c=await app.require(i);return t.hasClass("active")?c.minimize(a):(n(),c.load(a),s.toggleNew(a,!1),s.tasklist.removeClass("active"),t.addClass("active")),!1}),$(window).on("action:app.loggedOut",function(){s.closeAll()})},s.close=async function(t,i){if(y)return;if(s.tasklist.find('[data-module="'+E+'"][data-uuid="'+i+'"]').length){const c=await app.require(t);c&&typeof c.close=="function"&&c.close(i)}},s.closeAll=function(t){if(y)return;let i="[data-uuid]";t&&(i='[data-module="'+t+'"]'+i),s.tasklist.find(i).each(function(a,c){s.close(t||c.getAttribute("data-module"),c.getAttribute("data-uuid"))})},s.discard=function(t,i){if(y)return;s.tasklist.find('[data-module="'+t+'"][data-uuid="'+i+'"]').remove(),k()},s.push=function(t,i,a,c){if(c=c||function(){},y)return c();const h=s.tasklist.find('li[data-uuid="'+i+'"]'),v={module:t,uuid:i,options:a,element:h};I.fire("filter:taskbar.push",v),!h.length&&v.module?l(v,c):c(h)},s.get=function(t){return y?[]:$('[data-module="'+t+'"]').map(function(a,c){return $(c).data()})},s.minimize=function(t,i){if(y)return;s.tasklist.find('[data-module="'+t+'"][data-uuid="'+i+'"]').toggleClass("active",!1)},s.toggleNew=function(t,i,a){if(y)return;s.tasklist.find('[data-uuid="'+t+'"]').toggleClass("new",i),a||I.fire("action:taskbar.toggleNew",t)},s.updateActive=function(t){if(y)return;const i=s.tasklist.find("li");i.removeClass("active"),i.filter('[data-uuid="'+t+'"]').addClass("active"),$("[data-uuid]:not([data-module])").toggleClass("modal-unfocused",!0),$('[data-uuid="'+t+'"]:not([data-module])').toggleClass("modal-unfocused",!1)},s.isActive=function(t){return y?!1:s.tasklist.find('li[data-uuid="'+t+'"]').hasClass("active")};function k(){if(y)return;s.tasklist.find("li").length>0?s.taskbar.attr("data-active","1"):s.taskbar.removeAttr("data-active")}function n(){y||s.tasklist.find(".active").removeClass("active")}function l(t,i){if(y)return i();m.translate(t.options.title,function(a){const c=$("<div></div>").text(a||"NodeBB Task").html(),h=$("<li></li>").addClass(t.options.className).html('<a href="#"'+(t.options.image?` style="background-image: url('`+t.options.image.replace(/&#x2F;/g,"/")+`'); background-size: cover;"`:"")+">"+(t.options.icon?'<i class="fa '+t.options.icon+'"></i> ':"")+'<span aria-label="'+c+'" component="taskbar/title">'+c+"</span></a>").attr({title:c,"data-module":t.module,"data-uuid":t.uuid}).addClass(t.options.state!==void 0?t.options.state:"active");(!t.options.state||t.options.state==="active")&&n(),s.tasklist.append(h),k(),t.element=h,h.data(t),I.fire("action:taskbar.pushed",t),i(h)})}const r=function(t,i,a){switch(i){case"title":t.find('[component="taskbar/title"]').text(a);break;case"icon":t.find("i").attr("class","fa fa-"+a);break;case"image":t.find("a").css("background-image",a?'url("'+a.replace(/&#x2F;/g,"/")+'")':"");break;case"background-color":t.find("a").css("background-color",a);break;case"color":t.find("a").css("color",a);break}};return s.update=function(t,i,a){if(y)return;const c=s.tasklist.find('[data-module="'+t+'"][data-uuid="'+i+'"]');if(!c.length)return;const h=c.data();Object.keys(a).forEach(function(v){h[v]=a[v],r(c,v,a[v])}),c.data(h)},s}.apply(j,C),b!==void 0&&(E.exports=b)},62023:(E,j,o)=>{"use strict";var C,b;C=[o(74344),o(63281),o(7927),o(50431),o(59006),o(32230),o(62526)],b=function(m,I,s,y,k,n){const l={};return l.get=r=>m.get(`/topics/${r}/thumbs`,{}),l.getByPid=r=>m.get(`/posts/${r}`,{}).then(t=>l.get(t.tid)),l.delete=(r,t)=>m.del(`/topics/${r}/thumbs`,{path:t}),l.deleteAll=r=>{l.get(r).then(t=>{Promise.all(t.map(i=>l.delete(r,i.url)))})},l.upload=r=>new Promise(t=>{y.show({title:"[[topic:composer.thumb-title]]",method:"put",route:config.relative_path+`/api/v3/topics/${r}/thumbs`},function(i){t(i)})}),l.modal={},l.modal.open=function(r){const{id:t,pid:i}=r;let{modal:a}=r,c;return new Promise(h=>{Promise.all([l.get(t),i?l.getByPid(i):[]]).then(v=>new Promise(D=>{const x=v.reduce((A,w)=>A.concat(w));c=x.length,D(x)})).then(v=>k.render("modals/topic-thumbs",{thumbs:v})).then(v=>{a?n.translate(v,function(D){a.find(".bootbox-body").html(D),l.modal.handleSort({modal:a,numThumbs:c})}):(a=I.dialog({title:"[[modules:thumbs.modal.title]]",message:v,onEscape:!0,backdrop:!0,buttons:{add:{label:'<i class="fa fa-plus"></i> [[modules:thumbs.modal.add]]',className:"btn-success",callback:()=>(l.upload(t).then(()=>{l.modal.open({...r,modal:a}),Promise.all([o.e(61006),o.e(18099),o.e(10830),o.e(8311)]).then(function(){var D=[o(44541)];(x=>{x.updateThumbCount(t,$(`[component="composer"][data-uuid="${t}"]`)),h()}).apply(null,D)}).catch(o.oe)}),!1)},close:{label:"[[global:close]]",className:"btn-primary"}}}),l.modal.handleDelete({...r,modal:a}),l.modal.handleSort({modal:a,numThumbs:c}))})})},l.modal.handleDelete=r=>{r.modal.get(0).addEventListener("click",i=>{i.target.closest('button[data-action="remove"]')&&I.confirm("[[modules:thumbs.modal.confirm-remove]]",a=>{if(!a)return;const c=i.target.closest("[data-id]").getAttribute("data-id"),h=i.target.closest("[data-path]").getAttribute("data-path");m.del(`/topics/${c}/thumbs`,{path:h}).then(()=>{l.modal.open(r)}).catch(s.error)})})},l.modal.handleSort=({modal:r,numThumbs:t})=>{if(t>1){const i=r.find(".topic-thumbs-modal");i.sortable({items:"[data-id]"}),i.on("sortupdate",l.modal.handleSortChange)}},l.modal.handleSortChange=(r,t)=>{const i=t.item.get(0).parentNode.querySelectorAll("[data-id]");Array.from(i).forEach((a,c)=>{const h=a.getAttribute("data-id");let v=a.getAttribute("data-path");v=v.replace(new RegExp(`^${config.upload_url}`),""),m.put(`/topics/${h}/thumbs/order`,{path:v,order:c}).catch(s.error)})},l}.apply(j,C),b!==void 0&&(E.exports=b)},50431:(E,j,o)=>{"use strict";var C,b;C=[o(86569)],b=function(){const m={};m.show=function(n,l){const r=n.hasOwnProperty("fileSize")&&n.fileSize!==void 0?parseInt(n.fileSize,10):!1;app.parseAndTranslate("modals/upload-file",{showHelp:n.hasOwnProperty("showHelp")&&n.showHelp!==void 0?n.showHelp:!0,fileSize:r,title:n.title||"[[global:upload-file]]",description:n.description||"",button:n.button||"[[global:upload]]",accept:n.accept?n.accept.replace(/,/g,"&#44; "):""},function(t){t.modal("show"),t.on("hidden.bs.modal",function(){t.remove()});const i=t.find("#uploadForm");i.attr("action",n.route),i.find("#params").val(JSON.stringify(n.params)),t.find("#fileUploadSubmitBtn").on("click",function(){$(this).addClass("disabled"),i.submit()}),i.submit(function(){return I(t,r,l),!1})})},m.hideAlerts=function(n){$(n).find("#alert-status, #alert-success, #alert-error, #upload-progress-box").addClass("hide")};function I(n,l,r){s(n,"status","[[uploads:uploading-file]]"),n.find("#upload-progress-bar").css("width","0%"),n.find("#upload-progress-box").show().removeClass("hide");const t=n.find("#fileInput");if(!t.val())return s(n,"error","[[uploads:select-file-to-upload]]");if(!k(t[0],l))return s(n,"error","[[error:file-too-big, "+l+"]]");m.ajaxSubmit(n,r)}function s(n,l,r){m.hideAlerts(n),l==="error"&&n.find("#fileUploadSubmitBtn").removeClass("disabled"),r=r.replace(/&amp;#44/g,"&#44"),n.find("#alert-"+l).translateText(r).removeClass("hide")}m.ajaxSubmit=function(n,l){n.find("#uploadForm").ajaxSubmit({headers:{"x-csrf-token":config.csrf_token},error:function(t){t=y(t),s(n,"error",t.responseJSON?.status?.message||t.responseJSON?.error||`[[error:upload-error-fallback, ${t.status} ${t.statusText}]]`)},uploadProgress:function(t,i,a,c){n.find("#upload-progress-bar").css("width",c+"%")},success:function(t){let i=y(t);t.hasOwnProperty("response")&&t.hasOwnProperty("status")&&t.status.code==="ok"&&(i=t.response.images),l(i[0].url),s(n,"success","[[uploads:upload-success]]"),setTimeout(function(){m.hideAlerts(n),n.modal("hide")},750)}})};function y(n){if(typeof n=="string")try{return JSON.parse(n)}catch{return{error:"[[error:parse-error]]"}}return n}function k(n,l){return window.FileReader&&l?n.files[0].size<=l*1e3:!0}return m}.apply(j,C),b!==void 0&&(E.exports=b)}}]);
