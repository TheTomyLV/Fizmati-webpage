"use strict";(self.webpackChunknodebb=self.webpackChunknodebb||[]).push([[59078,70565,61762,83014,66623,49286,99617,71986,10999],{22009:(A,E,s)=>{var m,y;m=[s(24987),s(18487),s(32230),s(50548),s(7350),s(22568),s(74344),s(63281),s(7927),s(99764)],y=function(g,p,b,f,n,a,d,c,r,C){const v={};v.init=function(){const e=$("#group-icon"),i=$("#change-group-user-title"),u=$("#change-group-label-color"),h=$("#change-group-text-color"),l=$("#group-label-preview"),x=$("#group-label-preview-text"),k=ajaxify.data.group.name;$("#group-selector").on("change",function(){ajaxify.go("admin/manage/groups/"+$(this).val()+window.location.hash)}),g.init("admin/manage/group"),i.on("keyup",function(){x.translateText(i.val())}),u.on("keyup input",function(){l.css("background-color",u.val()||"#000000")}),h.on("keyup input",function(){l.css("color",h.val()||"#ffffff")}),t(),$("#group-icon-container").on("click",function(){const w=e.attr("value");p.init(e,function(){let D=e.attr("value");D!==w&&(D==="fa-nbb-none"&&(D="hidden"),$("#group-icon-preview").attr("class","fa fa-fw "+(D||"hidden")),app.flags=app.flags||{},app.flags._unsaved=!0)})}),f.init($('.edit-privileges-selector [component="category-selector"]'),{onSelect:function(w){o(w.cid)},showLinks:!0});const S=f.init($('.member-post-cids-selector [component="category-selector"]'),{onSelect:function(w){let D=($("#memberPostCids").val()||"").split(",").map(L=>parseInt(L,10));return D.push(w.cid),D=D.filter((L,M,P)=>P.indexOf(L)===M),$("#memberPostCids").val(D.join(",")),S.selectCategory(0),!1}});n.init($('[component="group-selector"]')),$("form [data-property]").on("change",function(){app.flags=app.flags||{},app.flags._unsaved=!0}),$('[data-action="delete"]').on("click",function(){c.confirm("[[admin/manage/groups:alerts.confirm-delete]]",function(w){w&&d.del(`/groups/${a(ajaxify.data.group.name)}`,{}).then(()=>{ajaxify.go("/admin/managegroups")}).catch(r.error)})}),$("#save").on("click",function(){return d.put(`/groups/${a(k)}`,{name:$("#change-group-name").val(),userTitle:i.val(),description:$("#change-group-desc").val(),icon:e.attr("value"),labelColor:u.val(),textColor:h.val(),userTitleEnabled:$("#group-userTitleEnabled").is(":checked"),private:$("#group-private").is(":checked"),hidden:$("#group-hidden").is(":checked"),memberPostCids:$("#memberPostCids").val(),disableJoinRequests:$("#group-disableJoinRequests").is(":checked"),disableLeave:$("#group-disableLeave").is(":checked")}).then(()=>{const w=$("#change-group-name").val();k!==w&&ajaxify.go("admin/manage/groups/"+encodeURIComponent(w),void 0,!0),C.toggleSaveSuccess($("#save"))}).catch(r.error),!1})};function t(){$('[component="groups/members"]').on("click","[data-action]",function(){const e=$(this),i=e.parents("[data-uid]"),u=i.find(".member-name .user-owner-icon"),h=!u.hasClass("invisible"),l=i.attr("data-uid");switch(e.attr("data-action")){case"toggleOwnership":d[h?"del":"put"](`/groups/${ajaxify.data.group.slug}/ownership/${l}`,{}).then(()=>{u.toggleClass("invisible")}).catch(r.error);break;case"kick":c.confirm("[[admin/manage/groups:edit.confirm-remove-user]]",function(k){k&&d.del("/groups/"+ajaxify.data.group.slug+"/membership/"+l).then(()=>{i.slideUp().remove()}).catch(r.error)});break;default:break}})}function o(e){if(e){const i="admin/manage/privileges/"+e+"?group="+ajaxify.data.group.nameEncoded;if(app.flags&&app.flags._unsaved===!0){b.translate("[[global:unsaved-changes]]",function(u){c.confirm(u,function(h){h&&(app.flags._unsaved=!1,ajaxify.go(i))})});return}ajaxify.go(i)}}return v}.apply(E,m),y!==void 0&&(A.exports=y)},24987:(A,E,s)=>{var m,y;m=[s(74344),s(63281),s(7927)],y=function(g,p,b){const f={};let n,a;f.init=function(e){a=e||"groups/details",n=ajaxify.data.group.name,d(),r(),C()};function d(){$('[component="groups/members/add"]').on("click",function(){app.parseAndTranslate("admin/partials/groups/add-members",{},function(e){const i=[],u=p.dialog({title:"[[groups:details.add-member]]",message:e,buttons:{OK:{label:"[[groups:details.add-member]]",callback:function(){const h=[];u.find("[data-uid][data-selected]").each(function(l,x){h.push(i[$(x).attr("data-uid")])}),c(h,function(){u.modal("hide")})}}}});u.on("click","[data-username]",function(){$(this).attr("data-selected")==="1"?$(this).removeAttr("data-selected"):$(this).attr("data-selected",1),$(this).find("i").toggleClass("invisible")}),u.find("input").on("keyup",function(){g.get("/api/users",{query:$(this).val(),paginate:!1},function(h,l){if(h)return b.error(h);l.users.forEach(function(x){i[x.uid]=x}),app.parseAndTranslate("admin/partials/groups/add-members","users",{users:l.users},function(x){u.find("#search-result").html(x)})})})})})}function c(e,i){function u(){e=e.filter(function(l){return!$('[component="groups/members"] [data-uid="'+l.uid+'"]').length}),o(e,function(l){$('[component="groups/members"] tbody').prepend(l)}),i()}const h=e.map(function(l){return l.uid});n==="administrators"?socket.emit("admin.user.makeAdmins",h,function(l){if(l)return b.error(l);u()}):Promise.all(h.map(l=>g.put("/groups/"+ajaxify.data.group.slug+"/membership/"+l))).then(u).catch(b.error)}function r(){const e=$('[component="groups/members/search"]');e.on("keyup",utils.debounce(function(){const i=e.val();socket.emit("groups.searchMembers",{groupName:n,query:i},function(u,h){if(u)return b.error(u);o(h.users,function(l){$('[component="groups/members"] tbody').html(l),$('[component="groups/members"]').attr("data-nextstart",20)})})},250))}function C(){$('[component="groups/members"]').on("scroll",function(){const e=$(this),i=(e[0].scrollHeight-e.innerHeight())*.9;e.scrollTop()>i&&!$('[component="groups/members/search"]').val()&&v()})}function v(){const e=$('[component="groups/members"]');e.attr("loading")||(e.attr("loading",1),socket.emit("groups.loadMoreMembers",{groupName:n,after:e.attr("data-nextstart")},function(i,u){if(i)return b.error(i);u&&u.users.length?t(u.users,function(){e.removeAttr("loading"),e.attr("data-nextstart",u.nextStart)}):e.removeAttr("loading")}))}function t(e,i){e=e.filter(function(u){return!$('[component="groups/members"] [data-uid="'+u.uid+'"]').length}),o(e,function(u){$('[component="groups/members"] tbody').append(u),i()})}function o(e,i){app.parseAndTranslate(a,"group.members",{group:{members:e,isOwner:ajaxify.data.group.isOwner}},i)}return f}.apply(E,m),y!==void 0&&(A.exports=y)},74344:(A,E,s)=>{s.r(E),s.d(E,{del:()=>v,get:()=>a,head:()=>d,patch:()=>r,post:()=>c,put:()=>C});var m=s(85233),y=s.n(m),g=s(63281),p=s.n(g);const b=config.relative_path+"/api/v3";async function f(t,o){if(t.url=t.url.startsWith("/api")?config.relative_path+t.url:b+t.url,typeof o=="function"){n(t).then(e=>o(null,e),e=>o(e));return}try{return await n(t)}catch(e){if(e.message==="A valid login session was not found. Please log in and try again.")return(0,g.confirm)("[[error:api.reauth-required]]",i=>{i&&ajaxify.go("login")});throw e}}async function n(t){const{url:o}=t;delete t.url,t.data&&!(t.data instanceof FormData)&&(t.data=JSON.stringify(t.data||{}),t.headers["content-type"]="application/json; charset=utf-8"),{options:t}=await(0,m.fire)("filter:api.options",{options:t}),t.data&&(t.body=t.data,delete t.data);const e=await fetch(o,t),{headers:i}=e,u=i.get("content-type"),h=u&&u.startsWith("application/json");let l;if(t.method!=="head"&&(h?l=await e.json():l=await e.text()),!e.ok)throw l?new Error(h?l.status.message:l):new Error(e.statusText);return h&&l&&l.hasOwnProperty("status")&&l.hasOwnProperty("response")?l.response:l}function a(t,o,e){return f({url:t+(o&&Object.keys(o).length?"?"+$.param(o):"")},e)}function d(t,o,e){return f({url:t+(o&&Object.keys(o).length?"?"+$.param(o):""),method:"head"},e)}function c(t,o,e){return f({url:t,method:"post",data:o,headers:{"x-csrf-token":config.csrf_token}},e)}function r(t,o,e){return f({url:t,method:"patch",data:o,headers:{"x-csrf-token":config.csrf_token}},e)}function C(t,o,e){return f({url:t,method:"put",data:o,headers:{"x-csrf-token":config.csrf_token}},e)}function v(t,o,e){return f({url:t,method:"delete",data:o,headers:{"x-csrf-token":config.csrf_token}},e)}},22905:(A,E,s)=>{var m,y;m=[s(7927),s(73138)],y=function(g,p){const b={};return b.init=function(f,n){let a=null;n=n||{},n.privilege=n.privilege||"topics:read",n.states=n.states||["watching","notwatching","ignoring"],n.cacheList=n.hasOwnProperty("cacheList")?n.cacheList:!0;let d=[];Array.isArray(n.localCategories)&&(d=n.localCategories.map(t=>({...t}))),n.selectedCids=n.selectedCids||ajaxify.data.selectedCids||[];const c=f.find('[component="category-selector-search"]');if(!c.length)return;const r=c.parent('[component="category/dropdown"]').length>0||c.parent('[component="category-selector"]').length>0;f.on("show.bs.dropdown",function(){r&&(f.find(".dropdown-toggle").css({visibility:"hidden"}),c.removeClass("hidden"),c.css({"z-index":f.find(".dropdown-toggle").css("z-index")+1}));function t(){const o=c.find("input").val();o.length>1||!o&&!a?C(o,function(e){a=n.cacheList&&(a||e),v(e)}):!o&&a&&v(a)}c.on("click",function(o){o.preventDefault(),o.stopPropagation()}),c.find("input").val("").on("keyup",utils.debounce(t,300)),t()}),f.on("shown.bs.dropdown",function(){["xs","sm"].includes(utils.findBootstrapEnvironment())||c.find("input").focus()}),f.on("hide.bs.dropdown",function(){r&&(f.find(".dropdown-toggle").css({visibility:"inherit"}),c.addClass("hidden")),c.off("click"),c.find("input").off("keyup")});function C(t,o){socket.emit("categories.categorySearch",{search:t,query:utils.params(),parentCid:n.parentCid||0,selectedCids:n.selectedCids,privilege:n.privilege,states:n.states,showLinks:n.showLinks},function(e,i){if(e)return g.error(e);o(d.concat(i))})}function v(t){const o=n.selectedCids.map(String);t.forEach(function(e){e.selected=o.includes(String(e.cid))}),app.parseAndTranslate(n.template,{categoryItems:t.slice(0,200),selectedCategory:ajaxify.data.selectedCategory,allCategoriesUrl:ajaxify.data.allCategoriesUrl},function(e){f.find('[component="category/list"]').html(e.find('[component="category/list"]').html()),f.find('[component="category/list"] [component="category/no-matches"]').toggleClass("hidden",!!t.length);const i=p.Dropdown.getInstance(f.find(".dropdown-toggle").get(0));i&&i.update()})}},b}.apply(E,m),y!==void 0&&(A.exports=y)},50548:(A,E,s)=>{var m,y;m=[s(22905),s(63281),s(85233),s(32230)],y=function(g,p,b,f){const n={};return n.init=function(a,d){if(!a||!a.length)return;d=d||{};const c=d.onSelect||function(){};d.states=d.states||["watching","notwatching","ignoring"],d.template=d.template||"partials/category/selector-dropdown-left",b.fire("action:category.selector.options",{el:a,options:d}),g.init(a,d);const r={el:a,selectedCategory:null};a.on("click","[data-cid]",function(){const v=$(this);return v.hasClass("disabled")?!1:(r.selectCategory(v.attr("data-cid")),c(r.selectedCategory))});let C=r.el.find('[component="category-selector-selected"]').html();return f.translate(C,v=>{C=v}),r.selectCategory=function(v){const t=r.el.find('[data-cid="'+v+'"]');r.selectedCategory={cid:v,name:t.attr("data-name")},t.length?r.el.find('[component="category-selector-selected"]').html(t.find('[component="category-markup"]').html()):r.el.find('[component="category-selector-selected"]').html(C)},r.getSelectedCategory=function(){return r.selectedCategory},r.getSelectedCid=function(){return r.selectedCategory?r.selectedCategory.cid:0},d.hasOwnProperty("selectedCategory")&&app.parseAndTranslate(d.template,{selectedCategory:d.selectedCategory},function(v){r.el.find('[component="category-selector-selected"]').html(v.find('[component="category-selector-selected"]').html())}),r},n.modal=function(a){a=a||{},a.onSelect=a.onSelect||function(){},a.onSubmit=a.onSubmit||function(){},app.parseAndTranslate("admin/partials/categories/select-category",{message:a.message},function(d){const c=p.dialog({title:a.title||"[[modules:composer.select-category]]",message:d,buttons:{save:{label:"[[global:select]]",className:"btn-primary",callback:C}}}),r=n.init(c.find('[component="category-selector"]'),a);function C(v){return v.preventDefault(),r.selectedCategory&&(a.onSubmit(r.selectedCategory),c.modal("hide")),!1}a.openOnLoad&&c.on("shown.bs.modal",function(){c.find(".dropdown-toggle").dropdown("toggle")}),c.find("form").on("submit",C)})},n}.apply(E,m),y!==void 0&&(A.exports=y)},7350:(A,E,s)=>{var m;m=function(){const y={};return y.init=function(g){if(utils.isTouchDevice())return;const p=g.find('[component="group-selector-search"]');if(!p.length)return;const b=p.parent('[component="group-selector"]').length>0,f=g.find('[component="group-list"] [data-name]');g.on("show.bs.dropdown",function(){function n(){const a=p.find("input").val().toLowerCase();let d=!0;f.each(function(){const c=$(this),r=c.attr("data-name").toLowerCase().indexOf(a)!==-1;d&&r&&(d=!1),c.toggleClass("hidden",!r)}),g.find('[component="group-list"] [component="group-no-matches"]').toggleClass("hidden",!d)}b&&(g.find(".dropdown-toggle").css({visibility:"hidden"}),p.removeClass("hidden"),p.css({"z-index":g.find(".dropdown-toggle").css("z-index")+1})),p.on("click",function(a){a.preventDefault(),a.stopPropagation()}),p.find("input").val("").on("keyup",n),n()}),g.on("shown.bs.dropdown",function(){p.find("input").focus()}),g.on("hide.bs.dropdown",function(){b&&(g.find(".dropdown-toggle").css({visibility:"inherit"}),p.addClass("hidden")),p.off("click").find("input").off("keyup")})},y}.call(E,s,E,A),m!==void 0&&(A.exports=m)},22568:(A,E,s)=>{var m,y,g;(function(p){y=[s(20648)],m=p,g=typeof m=="function"?m.apply(E,y):m,g!==void 0&&(A.exports=g)})(function(p){const b=p("[^\\p{L}\\s\\d\\-_]","g"),f=/[^\w\s\d\-_]/g,n=/^\s+|\s+$/g,a=/\s+/g,d=/-+/g,c=/-$/g,r=/^-/g,C=/^[\w\d\s.,\-@]+$/;return function(t,o){return t?(t=String(t).replace(n,""),C.test(t)?t=t.replace(f,"-"):t=p.replace(t,b,"-"),t=o?t:t.toLocaleLowerCase(),t=t.replace(a,"-"),t=t.replace(d,"-"),t=t.replace(c,""),t=t.replace(r,""),t):""}})}}]);
