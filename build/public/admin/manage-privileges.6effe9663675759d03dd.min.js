"use strict";(self.webpackChunknodebb=self.webpackChunknodebb||[]).push([[27678,88768,70565,83014,28253,66623,49286,99617,86193],{15606:(T,E,h)=>{var P,v;P=[h(74344),h(86193),h(63281),h(7927),h(32230),h(50548),h(42441),h(18310),h(99764)],v=function(A,x,b,p,d,u,c,l,f){const n={};let s;n.init=function(){s=isNaN(parseInt(ajaxify.data.selectedCategory.cid,10))?"admin":ajaxify.data.selectedCategory.cid,l.init(".privilege-table-container"),u.init($('[component="category-selector"]'),{onSelect:function(t){s=parseInt(t.cid,10),s=isNaN(s)?"admin":s,n.refreshPrivilegeTable(),ajaxify.updateHistory("admin/manage/privileges/"+(s||""))},localCategories:ajaxify.data.categories,privilege:"find",showLinks:!0}),n.setupPrivilegeTable(),I(),$(".privilege-filters button:first-child").click()},n.setupPrivilegeTable=function(){$(".privilege-table-container").on("change",'input[type="checkbox"]:not(.checkbox-helper)',function(){const t=this,e=$(this),i=e.parents("[data-privilege]"),o=i.index()+1,m=i.attr("data-privilege"),y=e.prop("checked"),C=e.parents("tr"),D=C.attr("data-group-name")||C.attr("data-uid"),L=parseInt(C.attr("data-private")||0,10),U=C.attr("data-group-name")!==void 0,N=U&&C.attr("data-group-name")==="banned-users"||C.attr("data-banned")!==void 0?"banned-users":"registered-users",j=e.prop("checked")===(i.attr("data-value")==="true")?null:y;D?(U&&m==="groups:moderate"&&!L&&y?b.confirm("[[admin/manage/privileges:alert.confirm-moderate]]",function(R){R?(i.attr("data-delta",j),n.applyDeltaState(t,j),n.exposeSingleAssumedPriv(o,N)):e.prop("checked",!e.prop("checked"))}):m.endsWith("admin:admins-mods")&&y?b.confirm("[[admin/manage/privileges:alert.confirm-admins-mods]]",function(R){R?(i.attr("data-delta",j),n.applyDeltaState(t,j),n.exposeSingleAssumedPriv(o,N)):e.prop("checked",!e.prop("checked"))}):(i.attr("data-delta",j),n.applyDeltaState(t,j),n.exposeSingleAssumedPriv(o,N)),l.updateState(e)):p.error("[[error:invalid-data]]")}),n.exposeAssumedPrivileges(),l.updateAll(),n.addEvents()},n.applyDeltaState=(t,e)=>{["bg-success","bg-opacity-75","border-success"].forEach(i=>{t.classList.toggle(i,e===!0)}),["bg-danger","bg-opacity-50","border-danger"].forEach(i=>{t.classList.toggle(i,e===!1)})},n.addEvents=function(){document.getElementById("save").addEventListener("click",function(){i("save",n.commit)}),document.getElementById("discard").addEventListener("click",function(){i("discard",n.discard)});const t=document.querySelector(".privilege-table-container");t.addEventListener("change",o=>{o.target.closest("td[data-privilege] input")&&(document.getElementById("discard").style.display=t.querySelectorAll("td[data-delta]").length?"unset":"none")});const e=$(".privilege-table-container");e.on("click",'[data-action="search.user"]',n.addUserToPrivilegeTable),e.on("click",'[data-action="search.group"]',n.addGroupToPrivilegeTable),e.on("click",'[data-action="copyToChildren"]',function(){i("copyToChildren",n.copyPrivilegesToChildren.bind(null,s,""))}),e.on("click",'[data-action="copyToChildrenGroup"]',function(){const o=$(this).parents("[data-group-name]").attr("data-group-name");i("copyToChildrenGroup",n.copyPrivilegesToChildren.bind(null,s,o))}),e.on("click",'[data-action="copyPrivilegesFrom"]',function(){n.copyPrivilegesFromCategory(s,"")}),e.on("click",'[data-action="copyPrivilegesFromGroup"]',function(){const o=$(this).parents("[data-group-name]").attr("data-group-name");n.copyPrivilegesFromCategory(s,o)}),e.on("click",'[data-action="copyToAll"]',function(){i("copyToAll",n.copyPrivilegesToAllCategories.bind(null,s,""))}),e.on("click",'[data-action="copyToAllGroup"]',function(){const o=$(this).parents("[data-group-name]").attr("data-group-name");i("copyToAllGroup",n.copyPrivilegesToAllCategories.bind(null,s,o))}),e.on("click",".privilege-filters button",M),c.bind("ctrl+s",function(o){i("save",n.commit),o.preventDefault()});function i(o,m){const y=B();b.confirm(`[[admin/manage/privileges:alert.confirm-${o}, ${y}]]<br /><br />[[admin/manage/privileges:alert.no-undo]]`,function(C){C&&m.call()})}},n.commit=function(){const t=document.querySelector(".privilege-table-container"),e=$.map(t.querySelectorAll("td[data-delta]"),function(i){const o=i.getAttribute("data-privilege"),m=i.parentNode,y=m.getAttribute("data-group-name")||m.getAttribute("data-uid"),C=i.getAttribute("data-delta")==="true"?1:0;return n.setPrivilege(y,o,C)});Promise.allSettled(e).then(i=>{n.refreshPrivilegeTable();const o=i.filter(m=>m.status==="rejected");o.length?o.forEach(m=>{p.error(m.reason)}):f.toggleSaveSuccess($("#save"))})},n.discard=function(){n.refreshPrivilegeTable(),p.success("[[admin/manage/privileges:alert.discarded]]")},n.refreshPrivilegeTable=function(t){A.get(`/categories/${s}/privileges`,{}).then(e=>{ajaxify.data.privileges={...ajaxify.data.privileges,...e};const i=parseInt(s,10)?"admin/partials/privileges/category":"admin/partials/privileges/global",o=ajaxify.currentPage.endsWith("admin/manage/privileges/admin");app.parseAndTranslate(i,{privileges:e,isAdminPriv:o}).then(m=>{const y=$(".privilege-filters button.btn-warning").map((C,D)=>$(D).index()).get();$(".privilege-table-container").html(m),n.exposeAssumedPrivileges(),document.querySelectorAll(".privilege-filters").forEach((C,D)=>{const L=y[D]===void 0?0:y[D];C.querySelectorAll("button")[L].click()}),w("data-group-name",t)})}).catch(alert.error)},n.exposeAssumedPrivileges=function(){const t=(m,y)=>`.privilege-table tr[data-banned] td[data-privilege="${m[y]}"] input`,e=a("banned-users");r(e,t);const i=(m,y)=>`.privilege-table tr[data-group-name]:not([data-group-name="registered-users"],[data-group-name="banned-users"],[data-group-name="guests"],[data-group-name="spiders"]) td[data-privilege="${m[y]}"] input, .privilege-table tr[data-uid]:not([data-banned]) td[data-privilege="${m[y]}"] input`,o=a("registered-users");r(o,i)},n.exposeSingleAssumedPriv=function(t,e){let i;switch(e){case"banned-users":i=()=>`.privilege-table tr[data-banned] td[data-privilege]:nth-child(${t}) input`;break;default:i=()=>`.privilege-table tr[data-group-name]:not([data-group-name="registered-users"],[data-group-name="banned-users"],[data-group-name="guests"],[data-group-name="spiders"]) td[data-privilege]:nth-child(${t}) input, .privilege-table tr[data-uid]:not([data-banned]) td[data-privilege]:nth-child(${t}) input`}const o=g(e,t);S(i,o)},n.setPrivilege=(t,e,i)=>A[i?"put":"del"](`/categories/${isNaN(s)?0:s}/privileges/${encodeURIComponent(e)}`,{member:t}),n.addUserToPrivilegeTable=function(){const t=b.dialog({title:"[[admin/manage/categories:alert.find-user]]",message:'<input class="form-control input-lg" placeholder="[[admin/manage/categories:alert.user-search]]" />',show:!0});t.on("shown.bs.modal",function(){const e=t.find("input");e.focus(),x.user(e,function(i,o){O(o.item.user,function(){t.modal("hide")})})})},n.addGroupToPrivilegeTable=function(){const t=b.dialog({title:"[[admin/manage/categories:alert.find-group]]",message:'<input class="form-control input-lg" placeholder="[[admin/manage/categories:alert.group-search]]" />',show:!0});t.on("shown.bs.modal",function(){const e=t.find("input");e.focus(),x.group(e,function(i,o){if(o.item.group.name==="administrators")return p.alert({type:"warning",message:"[[admin/manage/privileges:alert.admin-warning]]"});k(o.item.group.name,function(){t.modal("hide")})})})},n.copyPrivilegesToChildren=function(t,e){const i=F();socket.emit("admin.categories.copyPrivilegesToChildren",{cid:t,group:e,filter:i},function(o){if(o)return p.error(o.message);p.success("[[admin/manage/categories:privileges.copy-success]]")})},n.copyPrivilegesFromCategory=function(t,e){const i=B(),o="<br>"+(e?`[[admin/manage/privileges:alert.copyPrivilegesFromGroup-warning, ${i}]]`:`[[admin/manage/privileges:alert.copyPrivilegesFrom-warning, ${i}]]`)+"<br><br>[[admin/manage/privileges:alert.no-undo]]";u.modal({title:"[[admin/manage/privileges:alert.copyPrivilegesFrom-title]]",message:o,localCategories:[],showLinks:!0,onSubmit:function(m){socket.emit("admin.categories.copyPrivilegesFrom",{toCid:t,filter:F(),fromCid:m.cid,group:e},function(y){if(y)return p.error(y);ajaxify.refresh()})}})},n.copyPrivilegesToAllCategories=function(t,e){const i=F();socket.emit("admin.categories.copyPrivilegesToAllCategories",{cid:t,group:e,filter:i},function(o){if(o)return p.error(o);p.success("[[admin/manage/categories:privileges.copy-success]]")})};function a(t){const e=[];return $(`.privilege-table tr[data-group-name="${t}"] td input[type="checkbox"]:not(.checkbox-helper)`).parents("[data-privilege]").each(function(i,o){$(o).find("input").prop("checked")&&e.push(o.getAttribute("data-privilege"))}),e.concat(e.map(function(i){return i.startsWith("groups:")?i.slice(7):!1})).filter(Boolean)}function g(t,e){return $(`.privilege-table tr[data-group-name="${t}"] td:nth-child(${e}) input[type="checkbox"]`)[0].checked}function r(t,e){for(let i=0,o=t.length;i<o;i+=1)$(e(t,i)).each(function(y,C){C.checked||(C.indeterminate=!0)})}function S(t,e){$(t()).each((o,m)=>{m.indeterminate=m.checked?!1:e})}function w(t,e){if(e){const i=$("["+t+"]").filter(function(){return $(this).attr(t)===String(e)});if(i.length)return i.addClass("selected"),!0}return!1}function I(){if(ajaxify.data.group){if(w("data-group-name",ajaxify.data.group))return;k(ajaxify.data.group)}}function k(t,e){if(e=e||function(){},document.querySelector('.privilege-table [data-group-name="'+t+'"]'))return w("data-group-name",t),e();const o=ajaxify.data.privileges.keys.groups.reduce(function(m,y){return m[y]=!1,m},{});app.parseAndTranslate("admin/partials/privileges/"+(isNaN(s)||s===0?"global":"category"),"privileges.groups",{privileges:{groups:[{name:t,nameEscaped:d.escape(t),privileges:o}]}},function(m){const y=document.querySelector(".privilege-table tbody"),C=$(".privilege-filters").first().find("button.btn-warning").index();y.append(m.get(0)),n.exposeAssumedPrivileges(),w("data-group-name",t),document.querySelector(".privilege-filters").querySelectorAll("button")[C].click(),e()})}async function O(t,e){if(e=e||function(){},document.querySelector('.privilege-table [data-uid="'+t.uid+'"]'))return w("data-uid",t.uid),e();const o=ajaxify.data.privileges.keys.users.reduce(function(D,L){return D[L]=!1,D},{}),m=await app.parseAndTranslate("admin/partials/privileges/"+(isNaN(s)?"global":"category"),"privileges.users",{privileges:{users:[{picture:t.picture,username:t.username,banned:t.banned,uid:t.uid,"icon:text":t["icon:text"],"icon:bgColor":t["icon:bgColor"],privileges:o}]}}),y=document.querySelectorAll(".privilege-table tbody"),C=$(".privilege-filters").last().find("button.btn-warning").index();y[1].append(m.get(0)),n.exposeAssumedPrivileges(),w("data-uid",t.uid),document.querySelectorAll(".privilege-filters")[1].querySelectorAll("button")[C].click(),e()}function M(t){const e=$(t.target),i=e.attr("data-filter");e.closest("table").find("thead tr:last-child, tbody tr").each((m,y)=>{$(y).find("[data-type]").addClass("hidden"),$(y).find(`[data-type="${i}"]`).removeClass("hidden")}),l.updateAll(),e.siblings("button").removeClass("btn-warning"),e.addClass("btn-warning")}function F(){return $('[component="privileges/groups/filters"] .btn-warning').attr("data-filter")}function B(){const t=document.querySelector(".privilege-filters .btn-warning"),e=t?t.textContent.toLocaleLowerCase():"";return e.indexOf("privileges")>-1?e:`${e} privileges`.trim()}return n}.apply(E,P),v!==void 0&&(T.exports=v)},18310:(T,E,h)=>{var P;P=function(){const v={};let A;v.toggling=!1,v.init=function(p){A=$(p),A.on("change","input.checkbox-helper",x)},v.updateAll=function(){A.find("input.checkbox-helper").each((p,d)=>{v.updateState($(d))})},v.updateState=function(p){if(v.toggling)return;const d=p.closest("tr").find("input:not([disabled]):visible").toArray(),u=$(d.shift()),c=d.length&&d.every(l=>l.checked);u.prop("checked",c)};function x(p){const d=$(p.target);b(d)}function b(p){v.toggling=!0;const d=p.prop("checked");p.closest("tr").find("input:not(.checkbox-helper):visible").each((u,c)=>{const l=$(c);l.prop("checked")!==d&&l.click()}),v.toggling=!1}return v}.call(E,h,E,T),P!==void 0&&(T.exports=P)},74344:(T,E,h)=>{h.r(E),h.d(E,{del:()=>s,get:()=>u,head:()=>c,patch:()=>f,post:()=>l,put:()=>n});var P=h(85233),v=h.n(P),A=h(63281),x=h.n(A);const b=config.relative_path+"/api/v3";async function p(a,g){if(a.url=a.url.startsWith("/api")?config.relative_path+a.url:b+a.url,typeof g=="function"){d(a).then(r=>g(null,r),r=>g(r));return}try{return await d(a)}catch(r){if(r.message==="A valid login session was not found. Please log in and try again.")return(0,A.confirm)("[[error:api.reauth-required]]",S=>{S&&ajaxify.go("login")});throw r}}async function d(a){const{url:g}=a;delete a.url,a.data&&!(a.data instanceof FormData)&&(a.data=JSON.stringify(a.data||{}),a.headers["content-type"]="application/json; charset=utf-8"),{options:a}=await(0,P.fire)("filter:api.options",{options:a}),a.data&&(a.body=a.data,delete a.data);const r=await fetch(g,a),{headers:S}=r,w=S.get("content-type"),I=w&&w.startsWith("application/json");let k;if(a.method!=="head"&&(I?k=await r.json():k=await r.text()),!r.ok)throw k?new Error(I?k.status.message:k):new Error(r.statusText);return I&&k&&k.hasOwnProperty("status")&&k.hasOwnProperty("response")?k.response:k}function u(a,g,r){return p({url:a+(g&&Object.keys(g).length?"?"+$.param(g):"")},r)}function c(a,g,r){return p({url:a+(g&&Object.keys(g).length?"?"+$.param(g):""),method:"head"},r)}function l(a,g,r){return p({url:a,method:"post",data:g,headers:{"x-csrf-token":config.csrf_token}},r)}function f(a,g,r){return p({url:a,method:"patch",data:g,headers:{"x-csrf-token":config.csrf_token}},r)}function n(a,g,r){return p({url:a,method:"put",data:g,headers:{"x-csrf-token":config.csrf_token}},r)}function s(a,g,r){return p({url:a,method:"delete",data:g,headers:{"x-csrf-token":config.csrf_token}},r)}},86193:(T,E,h)=>{var P,v;P=[h(74344),h(7927)],v=function(A,x){const b={},p={delay:200,appendTo:null};b.init=u=>{const c={...p,...u},{input:l,onSelect:f}=c;app.loadJQueryUI(function(){l.autocomplete({...c,open:function(){$(this).autocomplete("widget").css("z-index",100005)},select:function(n,s){d(l,f,n,s)}})})},b.user=function(u,c,l){typeof c=="function"&&(l=c,c={}),c=c||{},b.init({input:u,onSelect:l,source:(f,n)=>{c.query=f.term,A.get("/api/users",c,function(s,a){if(s)return x.error(s);if(a&&a.users){const g=a.users.map(function(r){const S=$("<div></div>").html(r.username).text();return r&&{label:S,value:S,user:{uid:r.uid,name:r.username,slug:r.userslug,username:r.username,userslug:r.userslug,picture:r.picture,banned:r.banned,"icon:text":r["icon:text"],"icon:bgColor":r["icon:bgColor"]}}});n(g)}$(".ui-autocomplete a").attr("data-ajaxify","false")})}})},b.group=function(u,c){b.init({input:u,onSelect:c,source:(l,f)=>{socket.emit("groups.search",{query:l.term},function(n,s){if(n)return x.error(n);if(s&&s.length){const a=s.map(function(g){return g&&{label:g.name,value:g.name,group:g}});f(a)}$(".ui-autocomplete a").attr("data-ajaxify","false")})}})},b.tag=function(u,c){b.init({input:u,onSelect:c,delay:100,source:(l,f)=>{socket.emit("topics.autocompleteTags",{query:l.term,cid:ajaxify.data.cid||0},function(n,s){if(n)return x.error(n);s&&f(s),$(".ui-autocomplete a").attr("data-ajaxify","false")})}})};function d(u,c,l,f){c=c||function(){};const n=jQuery.Event("keypress");n.which=13,n.keyCode=13,setTimeout(function(){u.trigger(n)},100),c(l,f)}return b}.apply(E,P),v!==void 0&&(T.exports=v)},22905:(T,E,h)=>{var P,v;P=[h(7927),h(73138)],v=function(A,x){const b={};return b.init=function(p,d){let u=null;d=d||{},d.privilege=d.privilege||"topics:read",d.states=d.states||["watching","notwatching","ignoring"],d.cacheList=d.hasOwnProperty("cacheList")?d.cacheList:!0;let c=[];Array.isArray(d.localCategories)&&(c=d.localCategories.map(a=>({...a}))),d.selectedCids=d.selectedCids||ajaxify.data.selectedCids||[];const l=p.find('[component="category-selector-search"]');if(!l.length)return;const f=l.parent('[component="category/dropdown"]').length>0||l.parent('[component="category-selector"]').length>0;p.on("show.bs.dropdown",function(){f&&(p.find(".dropdown-toggle").css({visibility:"hidden"}),l.removeClass("hidden"),l.css({"z-index":p.find(".dropdown-toggle").css("z-index")+1}));function a(){const g=l.find("input").val();g.length>1||!g&&!u?n(g,function(r){u=d.cacheList&&(u||r),s(r)}):!g&&u&&s(u)}l.on("click",function(g){g.preventDefault(),g.stopPropagation()}),l.find("input").val("").on("keyup",utils.debounce(a,300)),a()}),p.on("shown.bs.dropdown",function(){["xs","sm"].includes(utils.findBootstrapEnvironment())||l.find("input").focus()}),p.on("hide.bs.dropdown",function(){f&&(p.find(".dropdown-toggle").css({visibility:"inherit"}),l.addClass("hidden")),l.off("click"),l.find("input").off("keyup")});function n(a,g){socket.emit("categories.categorySearch",{search:a,query:utils.params(),parentCid:d.parentCid||0,selectedCids:d.selectedCids,privilege:d.privilege,states:d.states,showLinks:d.showLinks},function(r,S){if(r)return A.error(r);g(c.concat(S))})}function s(a){const g=d.selectedCids.map(String);a.forEach(function(r){r.selected=g.includes(String(r.cid))}),app.parseAndTranslate(d.template,{categoryItems:a.slice(0,200),selectedCategory:ajaxify.data.selectedCategory,allCategoriesUrl:ajaxify.data.allCategoriesUrl},function(r){p.find('[component="category/list"]').html(r.find('[component="category/list"]').html()),p.find('[component="category/list"] [component="category/no-matches"]').toggleClass("hidden",!!a.length);const S=x.Dropdown.getInstance(p.find(".dropdown-toggle").get(0));S&&S.update()})}},b}.apply(E,P),v!==void 0&&(T.exports=v)},50548:(T,E,h)=>{var P,v;P=[h(22905),h(63281),h(85233),h(32230)],v=function(A,x,b,p){const d={};return d.init=function(u,c){if(!u||!u.length)return;c=c||{};const l=c.onSelect||function(){};c.states=c.states||["watching","notwatching","ignoring"],c.template=c.template||"partials/category/selector-dropdown-left",b.fire("action:category.selector.options",{el:u,options:c}),A.init(u,c);const f={el:u,selectedCategory:null};u.on("click","[data-cid]",function(){const s=$(this);return s.hasClass("disabled")?!1:(f.selectCategory(s.attr("data-cid")),l(f.selectedCategory))});let n=f.el.find('[component="category-selector-selected"]').html();return p.translate(n,s=>{n=s}),f.selectCategory=function(s){const a=f.el.find('[data-cid="'+s+'"]');f.selectedCategory={cid:s,name:a.attr("data-name")},a.length?f.el.find('[component="category-selector-selected"]').html(a.find('[component="category-markup"]').html()):f.el.find('[component="category-selector-selected"]').html(n)},f.getSelectedCategory=function(){return f.selectedCategory},f.getSelectedCid=function(){return f.selectedCategory?f.selectedCategory.cid:0},c.hasOwnProperty("selectedCategory")&&app.parseAndTranslate(c.template,{selectedCategory:c.selectedCategory},function(s){f.el.find('[component="category-selector-selected"]').html(s.find('[component="category-selector-selected"]').html())}),f},d.modal=function(u){u=u||{},u.onSelect=u.onSelect||function(){},u.onSubmit=u.onSubmit||function(){},app.parseAndTranslate("admin/partials/categories/select-category",{message:u.message},function(c){const l=x.dialog({title:u.title||"[[modules:composer.select-category]]",message:c,buttons:{save:{label:"[[global:select]]",className:"btn-primary",callback:n}}}),f=d.init(l.find('[component="category-selector"]'),u);function n(s){return s.preventDefault(),f.selectedCategory&&(u.onSubmit(f.selectedCategory),l.modal("hide")),!1}u.openOnLoad&&l.on("shown.bs.modal",function(){l.find(".dropdown-toggle").dropdown("toggle")}),l.find("form").on("submit",n)})},d}.apply(E,P),v!==void 0&&(T.exports=v)}}]);
