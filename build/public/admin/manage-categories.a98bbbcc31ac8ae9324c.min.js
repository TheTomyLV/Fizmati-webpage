"use strict";(self.webpackChunknodebb=self.webpackChunknodebb||[]).push([[78996,70565,83014,66623,49286,99617],{60286:(A,x,f)=>{var b,E;b=[f(32230),f(59006),f(50548),f(74344),f(51474),f(63281),f(7927)],E=function(w,D,v,g,c,r,l){c=c.default;const i={};let s=-1,p;i.init=function(){v.init($('[component="category-selector"]'),{parentCid:ajaxify.data.selectedCategory?ajaxify.data.selectedCategory.cid:0,onSelect:function(t){ajaxify.go("/admin/manage/categories"+(t.cid?"?cid="+t.cid:""))},cacheList:!1,localCategories:[],template:"admin/partials/category/selector-dropdown-right"}),i.render(ajaxify.data.categoriesTree),$('button[data-action="create"]').on("click",i.throwCreateModal),$(".categories").on("click",'.category-tools [data-action="toggle"]',function(){const t=$(this),o=t.attr("data-disable-cid"),u=t.parents('li[data-cid="'+o+'"]'),d=u.hasClass("disabled"),m=u.find("li[data-cid]").map(function(){return $(this).attr("data-cid")}).get();i.toggle([o].concat(m),!d)}),$(".categories").on("click",".toggle",function(){const t=$(this);t.find("i").toggleClass("fa-chevron-down").toggleClass("fa-chevron-right"),t.closest("[data-cid]").find("> ul[data-cid]").toggleClass("hidden");const o=t.closest("[data-cid]").find("> ul.has-more-categories");parseInt(o.attr("data-hasmore"),10)===1&&o.toggleClass("hidden")}),$(".categories").on("click",".set-order",function(){const t=$(this).attr("data-cid"),o=$(this).attr("data-order"),u=r.dialog({title:"[[admin/manage/categories:set-order]]",message:'<input type="number" min="1" class="form-control input-lg" value='+o+' /><p class="form-text">[[admin/manage/categories:set-order-help]]</p>',show:!0,buttons:{save:{label:"[[modules:bootbox.confirm]]",className:"btn-primary",callback:function(){const d=u.find("input").val();if(d&&t){const y={};y[t]={order:Math.max(1,parseInt(d,10))},g.put("/categories/"+t,y[t]).then(function(){ajaxify.refresh()}).catch(l.error)}else return!1}}}})}),$("#toggle-collapse-all").on("click",function(){const t=$(this),o=parseInt(t.attr("data-collapsed"),10)===1;e(o),t.attr("data-collapsed",o?0:1).translateText(o?"[[admin/manage/categories:collapse-all]]":"[[admin/manage/categories:expand-all]]")});function e(t){const o=$(".categories .toggle");o.find("i").toggleClass("fa-chevron-down",t).toggleClass("fa-chevron-right",!t),o.closest("[data-cid]").find("> ul[data-cid]").toggleClass("hidden",!t)}},i.throwCreateModal=function(){D.render("admin/partials/categories/create",{}).then(function(e){const t=r.dialog({title:"[[admin/manage/categories:alert.create]]",message:e,buttons:{save:{label:"[[global:create]]",className:"btn-primary",callback:y}}}),o={localCategories:[{cid:0,name:"[[admin/manage/categories:parent-category-none]]",icon:"fa-none"}],template:"admin/partials/category/selector-dropdown-left"},u=v.init(t.find('#parentCidGroup [component="category-selector"]'),o),d=v.init(t.find('#cloneFromCidGroup [component="category-selector"]'),o);function y(){const m=t.find("form").serializeObject();return m.description="",m.icon="fa-comments",m.uid=app.user.uid,m.parentCid=u.getSelectedCid(),m.cloneFromCid=d.getSelectedCid(),i.create(m),t.modal("hide"),!1}$("#cloneChildren").on("change",function(){const m=$(this),C=t.find('#parentCidGroup [component="category-selector"] .dropdown-toggle');m.prop("checked")?(C.attr("disabled","disabled"),u.selectCategory(0)):C.removeAttr("disabled")}),t.find("form").on("submit",y)})},i.create=function(e){g.post("/categories",e,function(t,o){if(t)return l.error(t);l.alert({alert_id:"category_created",title:"[[admin/manage/categories:alert.created]]",message:"[[admin/manage/categories:alert.create-success]]",type:"success",timeout:2e3}),ajaxify.go("admin/manage/categories/"+o.cid)})},i.render=function(e){const t=$(".categories");!e||!e.length?w.translate("[[admin/manage/categories:alert.none-active]]",function(o){$("<div></div>").addClass("alert alert-info text-center").text(o).appendTo(t)}):(p={},n(e,t,{cid:0}))},i.toggle=function(e,t){const o=document.querySelector('.categories [data-cid="0"]');Promise.all(e.map(u=>g.put("/categories/"+u,{disabled:t?1:0}).then(()=>{const d=o.querySelector(`li[data-cid="${u}"]`);d.classList[t?"add":"remove"]("disabled"),$(d).find('li a[data-action="toggle"]').first().translateText(t?"[[admin/manage/categories:enable]]":"[[admin/manage/categories:disable]]")}).catch(l.error)))};function h(e){s=e.to.dataset.cid}function a(e){const t=parseInt(s,10)!==-1;if(e.newIndex!=null&&parseInt(e.oldIndex,10)!==parseInt(e.newIndex,10)||t){const o=e.item.dataset.cid,u={},d=(ajaxify.data.pagination.currentPage-1)*ajaxify.data.categoriesPerPage;if(u[o]={order:d+e.newIndex+1},t){u[o].parentCid=s;const y=parseInt(e.from.getAttribute("data-cid"),10),m=parseInt(e.to.getAttribute("data-cid"),10);if(y!==m){const C=document.querySelector(`.categories li[data-cid="${m}"] .toggle`);if(C&&C.classList.toggle("invisible",!1),!document.querySelectorAll(`.categories li[data-cid="${y}"] ul[data-cid] li[data-cid]`).length){const S=document.querySelector(`.categories li[data-cid="${y}"] .toggle`);S&&S.classList.toggle("invisible",!0)}e.item.dataset.parentCid=m}}s=-1,g.put("/categories/"+o,u[o]).catch(l.error)}}function n(e,t,o){let u=0;const d=o.cid;e.forEach(function(m,C,I){w.translate(m.name,function(S){m.name!==S&&(m.name=S),u+=1,u===I.length&&y()})}),e.length||y();function y(){app.parseAndTranslate("admin/partials/categories/category-rows",{cid:o.cid,categories:e,parentCategory:o},function(m){t.find(".category-row").length?t.find(".category-row").after(m):t.append(m),e.length||t.get(0).querySelector(".toggle").classList.toggle("invisible",!0);for(let C=0,I=e.length;C<I;C+=1)n(e[C].children,$('li[data-cid="'+e[C].cid+'"]'),e[C]);p[d]=c.create($('ul[data-cid="'+d+'"]')[0],{group:"cross-categories",animation:150,handle:".information",dataIdAttr:"data-cid",ghostClass:"placeholder",onAdd:h,onEnd:a})})}}return i}.apply(x,b),E!==void 0&&(A.exports=E)},74344:(A,x,f)=>{f.r(x),f.d(x,{del:()=>h,get:()=>r,head:()=>l,patch:()=>s,post:()=>i,put:()=>p});var b=f(85233),E=f.n(b),w=f(63281),D=f.n(w);const v=config.relative_path+"/api/v3";async function g(a,n){if(a.url=a.url.startsWith("/api")?config.relative_path+a.url:v+a.url,typeof n=="function"){c(a).then(e=>n(null,e),e=>n(e));return}try{return await c(a)}catch(e){if(e.message==="A valid login session was not found. Please log in and try again.")return(0,w.confirm)("[[error:api.reauth-required]]",t=>{t&&ajaxify.go("login")});throw e}}async function c(a){const{url:n}=a;delete a.url,a.data&&!(a.data instanceof FormData)&&(a.data=JSON.stringify(a.data||{}),a.headers["content-type"]="application/json; charset=utf-8"),{options:a}=await(0,b.fire)("filter:api.options",{options:a}),a.data&&(a.body=a.data,delete a.data);const e=await fetch(n,a),{headers:t}=e,o=t.get("content-type"),u=o&&o.startsWith("application/json");let d;if(a.method!=="head"&&(u?d=await e.json():d=await e.text()),!e.ok)throw d?new Error(u?d.status.message:d):new Error(e.statusText);return u&&d&&d.hasOwnProperty("status")&&d.hasOwnProperty("response")?d.response:d}function r(a,n,e){return g({url:a+(n&&Object.keys(n).length?"?"+$.param(n):"")},e)}function l(a,n,e){return g({url:a+(n&&Object.keys(n).length?"?"+$.param(n):""),method:"head"},e)}function i(a,n,e){return g({url:a,method:"post",data:n,headers:{"x-csrf-token":config.csrf_token}},e)}function s(a,n,e){return g({url:a,method:"patch",data:n,headers:{"x-csrf-token":config.csrf_token}},e)}function p(a,n,e){return g({url:a,method:"put",data:n,headers:{"x-csrf-token":config.csrf_token}},e)}function h(a,n,e){return g({url:a,method:"delete",data:n,headers:{"x-csrf-token":config.csrf_token}},e)}},22905:(A,x,f)=>{var b,E;b=[f(7927),f(73138)],E=function(w,D){const v={};return v.init=function(g,c){let r=null;c=c||{},c.privilege=c.privilege||"topics:read",c.states=c.states||["watching","notwatching","ignoring"],c.cacheList=c.hasOwnProperty("cacheList")?c.cacheList:!0;let l=[];Array.isArray(c.localCategories)&&(l=c.localCategories.map(a=>({...a}))),c.selectedCids=c.selectedCids||ajaxify.data.selectedCids||[];const i=g.find('[component="category-selector-search"]');if(!i.length)return;const s=i.parent('[component="category/dropdown"]').length>0||i.parent('[component="category-selector"]').length>0;g.on("show.bs.dropdown",function(){s&&(g.find(".dropdown-toggle").css({visibility:"hidden"}),i.removeClass("hidden"),i.css({"z-index":g.find(".dropdown-toggle").css("z-index")+1}));function a(){const n=i.find("input").val();n.length>1||!n&&!r?p(n,function(e){r=c.cacheList&&(r||e),h(e)}):!n&&r&&h(r)}i.on("click",function(n){n.preventDefault(),n.stopPropagation()}),i.find("input").val("").on("keyup",utils.debounce(a,300)),a()}),g.on("shown.bs.dropdown",function(){["xs","sm"].includes(utils.findBootstrapEnvironment())||i.find("input").focus()}),g.on("hide.bs.dropdown",function(){s&&(g.find(".dropdown-toggle").css({visibility:"inherit"}),i.addClass("hidden")),i.off("click"),i.find("input").off("keyup")});function p(a,n){socket.emit("categories.categorySearch",{search:a,query:utils.params(),parentCid:c.parentCid||0,selectedCids:c.selectedCids,privilege:c.privilege,states:c.states,showLinks:c.showLinks},function(e,t){if(e)return w.error(e);n(l.concat(t))})}function h(a){const n=c.selectedCids.map(String);a.forEach(function(e){e.selected=n.includes(String(e.cid))}),app.parseAndTranslate(c.template,{categoryItems:a.slice(0,200),selectedCategory:ajaxify.data.selectedCategory,allCategoriesUrl:ajaxify.data.allCategoriesUrl},function(e){g.find('[component="category/list"]').html(e.find('[component="category/list"]').html()),g.find('[component="category/list"] [component="category/no-matches"]').toggleClass("hidden",!!a.length);const t=D.Dropdown.getInstance(g.find(".dropdown-toggle").get(0));t&&t.update()})}},v}.apply(x,b),E!==void 0&&(A.exports=E)},50548:(A,x,f)=>{var b,E;b=[f(22905),f(63281),f(85233),f(32230)],E=function(w,D,v,g){const c={};return c.init=function(r,l){if(!r||!r.length)return;l=l||{};const i=l.onSelect||function(){};l.states=l.states||["watching","notwatching","ignoring"],l.template=l.template||"partials/category/selector-dropdown-left",v.fire("action:category.selector.options",{el:r,options:l}),w.init(r,l);const s={el:r,selectedCategory:null};r.on("click","[data-cid]",function(){const h=$(this);return h.hasClass("disabled")?!1:(s.selectCategory(h.attr("data-cid")),i(s.selectedCategory))});let p=s.el.find('[component="category-selector-selected"]').html();return g.translate(p,h=>{p=h}),s.selectCategory=function(h){const a=s.el.find('[data-cid="'+h+'"]');s.selectedCategory={cid:h,name:a.attr("data-name")},a.length?s.el.find('[component="category-selector-selected"]').html(a.find('[component="category-markup"]').html()):s.el.find('[component="category-selector-selected"]').html(p)},s.getSelectedCategory=function(){return s.selectedCategory},s.getSelectedCid=function(){return s.selectedCategory?s.selectedCategory.cid:0},l.hasOwnProperty("selectedCategory")&&app.parseAndTranslate(l.template,{selectedCategory:l.selectedCategory},function(h){s.el.find('[component="category-selector-selected"]').html(h.find('[component="category-selector-selected"]').html())}),s},c.modal=function(r){r=r||{},r.onSelect=r.onSelect||function(){},r.onSubmit=r.onSubmit||function(){},app.parseAndTranslate("admin/partials/categories/select-category",{message:r.message},function(l){const i=D.dialog({title:r.title||"[[modules:composer.select-category]]",message:l,buttons:{save:{label:"[[global:select]]",className:"btn-primary",callback:p}}}),s=c.init(i.find('[component="category-selector"]'),r);function p(h){return h.preventDefault(),s.selectedCategory&&(r.onSubmit(s.selectedCategory),i.modal("hide")),!1}r.openOnLoad&&i.on("shown.bs.modal",function(){i.find(".dropdown-toggle").dropdown("toggle")}),i.find("form").on("submit",p)})},c}.apply(x,b),E!==void 0&&(A.exports=E)}}]);
