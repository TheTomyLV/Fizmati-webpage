"use strict";(self.webpackChunknodebb=self.webpackChunknodebb||[]).push([[54400],{29721:(x,E,s)=>{var v,m;v=[s(32230),s(59006),s(63281),s(7927),s(62526)],m=function(f,R,p,d){const u={};u.init=function(){const o=$(".plugins"),c=o[0].querySelectorAll("li").length;let i;if(!c){f.translate("<li><p><i>[[admin/extend/plugins:none-found]]</i></p></li>",function(t){o.append(t)});return}window.location.hash&&$(`.nav-pills button[data-bs-target="${window.location.hash}"]`).trigger("click");const r=document.querySelector("#plugin-search");r.value="",o.on("click",'button[data-action="toggleActive"]',function(){const t=$(this).parents("li");i=t.attr("data-plugin-id");const l=$(this),n=ajaxify.data.installed[t.attr("data-plugin-index")];function e(){socket.emit("admin.plugins.toggleActive",i,function(a,g){if(a)return d.error(a);l.siblings('[data-action="toggleActive"]').removeClass("hidden"),l.addClass("hidden"),g.active&&!$('#active [id="'+i+'"]').length&&$("#active ul").prepend(t.clone(!0)),n.active=!n.active,d.alert({alert_id:"plugin_toggled",title:"[[admin/extend/plugins:alert."+(g.active?"enabled":"disabled")+"]]",message:"[[admin/extend/plugins:alert."+(g.active?"activate-success":"deactivate-success")+"]]",type:g.active?"warning":"success",timeout:5e3,clickfn:function(){s.e(37201).then(function(){var h=[s(64117)];(function(C){C.rebuildAndRestart()}).apply(null,h)}).catch(s.oe)}})})}n.license&&n.active!==!0?R.render("admin/partials/plugins/license",n).then(function(a){p.dialog({title:"[[admin/extend/plugins:license.title]]",message:a,size:"large",buttons:{cancel:{label:"[[modules:bootbox.cancel]]",className:"btn-link"},save:{label:"[[modules:bootbox.confirm]]",className:"btn-primary",callback:e}},onShown:function(){const g=this.querySelector("button.btn-primary");g&&g.focus()}})}):e(i)}),o.on("click",'button[data-action="toggleInstall"]',function(){const t=$(this);if(t.attr("disabled",!0),i=$(this).parents("li").attr("data-plugin-id"),$(this).attr("data-installed")==="1")return u.toggleInstall(i,$(this).parents("li").attr("data-version"));u.suggest(i,function(l,n){if(l){p.confirm(f.compile("admin/extend/plugins:alert.suggest-error",l.status,l.responseText),function(e){e?u.toggleInstall(i,"latest"):t.removeAttr("disabled")});return}n.version!=="latest"?u.toggleInstall(i,n.version):n.version==="latest"?A(i,function(e){e?u.toggleInstall(i,"latest"):t.removeAttr("disabled")}):t.removeAttr("disabled")})}),o.on("click",'button[data-action="upgrade"]',function(){const t=$(this),l=t.parents("li");i=l.attr("data-plugin-id"),u.suggest(i,function(n,e){if(n)return p.alert("[[admin/extend/plugins:alert.package-manager-unreachable]]");s.e(6445).then(function(){var a=[s(6445)];(function(g){const h=l.find(".currentVersion").text();e.version!=="latest"&&g.compare(e.version,h,">")?b(i,t,e.version):e.version==="latest"?A(i,function(){b(i,t,e.version)}):p.alert(f.compile("admin/extend/plugins:alert.incompatible",app.config.version,e.version))}).apply(null,a)}).catch(s.oe)})}),$(r).on("input propertychange",function(){const t=$(this).val();$(".plugins li").each(function(){const n=$(this).attr("data-plugin-id");$(this).toggleClass("hide",n&&n.indexOf(t)===-1)}),document.querySelectorAll(".plugins .tab-pane").forEach(n=>{const e=n.querySelectorAll("li:not(.hide)").length,a=n.querySelector(".no-plugins");a&&a.classList.toggle("hide",e!==0)})}),$("#plugin-submit-usage").on("click",function(){socket.emit("admin.config.setMultiple",{submitPluginUsage:$(this).prop("checked")?"1":"0"},function(t){if(t)return d.error(t)})}),$("#plugin-order").on("click",function(){$("#order-active-plugins-modal").modal("show"),socket.emit("admin.plugins.getActive",function(t,l){if(t)return d.error(t);let n="";if(l.forEach(function(a){n+=`
						<li class="d-flex justify-content-between gap-1 pointer border-bottom pb-2">
							${a}
							<div class="d-flex gap-1">
								<div class="btn-ghost-sm move-up">
									<i class="fa fa-chevron-up"></i>
								</div>
								<div class="btn-ghost-sm move-down">
									<i class="fa fa-chevron-down"></i>
								</div>
							</div>
						</li>
					`}),!l.length){f.translate("[[admin/extend/plugins:none-active]]",function(a){$("#order-active-plugins-modal .plugin-list").html(a).sortable()});return}const e=$("#order-active-plugins-modal .plugin-list");e.html(n).sortable(),e.find(".move-up").on("click",function(){const a=$(this).parents("li");a.prev().before(a)}),e.find(".move-down").on("click",function(){const a=$(this).parents("li");a.next().after(a)})})}),$("#save-plugin-order").on("click",function(){const t=$("#order-active-plugins-modal .plugin-list").children(),l=[];t.each(function(n,e){l.push({name:$(e).text(),order:n})}),socket.emit("admin.plugins.orderActivePlugins",l,function(n){if(n)return d.error(n);$("#order-active-plugins-modal").modal("hide"),d.alert({alert_id:"plugin_reordered",title:"[[admin/extend/plugins:alert.reorder]]",message:"[[admin/extend/plugins:alert.reorder-success]]",type:"success",timeout:5e3,clickfn:function(){s.e(37201).then(function(){var e=[s(64117)];(function(a){a.rebuildAndRestart()}).apply(null,e)}).catch(s.oe)}})})}),y(),I()};function A(o,c){p.confirm(f.compile("admin/extend/plugins:alert.possibly-incompatible",o),function(i){c(i)})}function b(o,c,i){c.attr("disabled",!0).find("i").attr("class","fa fa-refresh fa-spin"),socket.emit("admin.plugins.upgrade",{id:o,version:i},function(r,t){if(r)return d.error(r);const l=c.parents("li");l.find(".fa-exclamation-triangle").remove(),l.find(".currentVersion").text(i),c.remove(),t&&d.alert({alert_id:"plugin_upgraded",title:"[[admin/extend/plugins:alert.upgraded]]",message:"[[admin/extend/plugins:alert.upgrade-success]]",type:"warning",timeout:5e3,clickfn:function(){s.e(37201).then(function(){var n=[s(64117)];(function(e){e.rebuildAndRestart()}).apply(null,n)}).catch(s.oe)}})})}u.toggleInstall=function(o,c,i){const r=$('li[data-plugin-id="'+o+'"] button[data-action="toggleInstall"]');r.find("i").attr("class","fa fa-refresh fa-spin"),socket.emit("admin.plugins.toggleInstall",{id:o,version:c},function(t,l){if(t)return r.removeAttr("disabled"),d.error(t);function n(e){$(`${e} [data-plugin-id="${o}"]`).remove();const a=$(`${e} [data-plugin-id]`).length;$(`[data-bs-target="${e}"] .badge`).text(a)}l.installed?ajaxify.refresh():["#installed","#active","#deactive","#upgrade"].forEach(n),d.alert({alert_id:"plugin_toggled",title:"[[admin/extend/plugins:alert."+(l.installed?"installed":"uninstalled")+"]]",message:"[[admin/extend/plugins:alert."+(l.installed?"install-success":"uninstall-success")+"]]",type:"info",timeout:5e3}),typeof i=="function"&&i.apply(this,arguments)})},u.suggest=function(o,c){const i=app.config.version.match(/^\d+\.\d+\.\d+/);$.ajax((app.config.registry||"https://packages.nodebb.org")+"/api/v1/suggest",{type:"GET",data:{package:o,version:i[0]},dataType:"json"}).done(function(r){c(void 0,r)}).fail(c)};function y(){$("#installed ul li").each(function(){$(this).find('[data-action="upgrade"]').length&&$("#upgrade ul").append($(this).clone(!0))})}function I(){$("#installed ul li").each(function(){$(this).hasClass("active")?$("#active ul").append($(this).clone(!0)):$("#deactive ul").append($(this).clone(!0))})}return u}.apply(E,v),m!==void 0&&(x.exports=m)}}]);
