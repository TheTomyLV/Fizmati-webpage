"use strict";(self.webpackChunknodebb=self.webpackChunknodebb||[]).push([[77884,70565,83014,66623,49286,99617],{15260:(w,b,f)=>{var p,y;p=[f(50431),f(18487),f(50548),f(59006),f(74344),f(63281),f(7927),f(99764)],y=function(E,x,C,u,o,i,r,d){const s={};let h={};s.init=function(){const a=$("#category-settings"),t=$('[component="category/preview"]');a.find("select").each(function(){const n=$(this);n.val(n.attr("data-value"))}),C.init($('[component="settings/main/header"] [component="category-selector"]'),{onSelect:function(n){ajaxify.go("admin/manage/categories/"+n.cid)},cacheList:!1,showLinks:!0,template:"admin/partials/category/selector-dropdown-right"}),C.init($('#parent-category-selector [component="category-selector"]'),{onSelect:function(n){const c=$("#parent-cid");c.val(n.cid),l(c[0])},selectedCategory:ajaxify.data.category.parent,localCategories:[{cid:0,name:"[[admin/manage/categories:parent-category-none]]",icon:"fa-list"}],cacheList:!1,showLinks:!0,template:"admin/partials/category/selector-dropdown-right"}),e(),a.find("input, select, textarea").on("change",function(n){l(n.target)}),$('[type="checkbox"]').on("change",function(){l($(this))}),$('[data-name="imageClass"]').on("change",function(){$(".category-preview").css("background-size",$(this).val())}),$('[data-name="bgColor"], [data-name="color"]').on("input",function(){const n=$(this);n.attr("data-name")==="bgColor"?t.css("background-color",n.val()):n.attr("data-name")==="color"&&t.css("color",n.val()),l(n[0])}),$("#save").on("click",function(){const n=$("#tag-whitelist").val()?$("#tag-whitelist").val().split(","):[];if(n.length&&n.length<parseInt($("#cid-min-tags").val(),10))return r.error("[[admin/manage/categories:alert.not-enough-whitelisted-tags]]");const c=ajaxify.data.category.cid;return o.put("/categories/"+c,h).then(()=>{app.flags._unsaved=!1,d.toggleSaveSuccess($("#save")),h={}}).catch(r.error),!1}),$(".purge").on("click",function(n){n.preventDefault(),u.render("admin/partials/categories/purge",{name:ajaxify.data.category.name,topic_count:ajaxify.data.category.topic_count}).then(function(c){const m=i.dialog({title:"[[admin/manage/categories:purge]]",message:c,size:"large",buttons:{save:{label:"[[modules:bootbox.confirm]]",className:"btn-primary",callback:function(){m.find(".modal-footer button").prop("disabled",!0);const g=setInterval(function(){socket.emit("categories.getTopicCount",ajaxify.data.category.cid,function(v,A){if(v)return r.error(v);let k=0;ajaxify.data.category.topic_count>0&&(k=Math.max(0,1-A/ajaxify.data.category.topic_count)*100),m.find(".progress-bar").css({width:k+"%"})})},1e3);return o.del("/categories/"+ajaxify.data.category.cid).then(()=>{g&&clearInterval(g),m.modal("hide"),r.success("[[admin/manage/categories:alert.purge-success]]"),ajaxify.go("admin/manage/categories")}).catch(r.error),!1}}}})})}),$(".copy-settings").on("click",function(){return u.render("admin/partials/categories/copy-settings",{}).then(function(n){let c;const m=i.dialog({title:"[[modules:composer.select-category]]",message:n,buttons:{save:{label:"[[modules:bootbox.confirm]]",className:"btn-primary",callback:function(){if(!(!c||parseInt(c,10)===parseInt(ajaxify.data.category.cid,10)))return socket.emit("admin.categories.copySettingsFrom",{fromCid:c,toCid:ajaxify.data.category.cid,copyParent:m.find("#copyParent").prop("checked")},function(g){if(g)return r.error(g);m.modal("hide"),alert.success("[[admin/manage/categories:alert.copy-success]]"),ajaxify.refresh()}),!1}}}});m.find(".modal-footer button").prop("disabled",!0),C.init(m.find('[component="category-selector"]'),{onSelect:function(g){c=g&&g.cid,c&&m.find(".modal-footer button").prop("disabled",!1)},showLinks:!0})}),!1}),$(".upload-button").on("click",function(){const c=$(this).attr("data-cid");E.show({title:"[[admin/manage/categories:alert.upload-image]]",route:config.relative_path+"/api/admin/category/uploadpicture",params:{cid:c}},function(m){$("#category-image").val(m),t.css("background-image","url("+m+"?"+new Date().getTime()+")"),l($("#category-image"))})}),$("#category-image").on("change",function(){t.css("background-image",$(this).val()?'url("'+$(this).val()+'")':""),l($("#category-image"))}),$(".delete-image").on("click",function(n){n.preventDefault();const c=$("#category-image");c.val(""),t.css("background-image",""),l(c[0])}),t.on("click",function(){x.init($(this).find("i"),l)}),$('button[data-action="toggle"]').on("click",function(){const n=$(this),c=n.attr("data-disabled")==="1";o.put("/categories/"+ajaxify.data.category.cid,{disabled:c?0:1}).then(()=>{n.find(".label").translateText(c?"[[admin/manage/categories:disable]]":"[[admin/manage/categories:enable]]"),n.find("i").toggleClass(["fa-check","text-success"],!c).toggleClass(["fa-ban","text-danger"],c),n.attr("data-disabled",c?0:1)}).catch(r.error)})};function l(a){let t;$(a).is(":checkbox")?t=$(a).is(":checked")?1:0:t=$(a).val();const c=$(a).attr("data-name").match(/[^\][.]+/g);function m(g,v){v!==c.length&&(g[c[v]]=g[c[v]]||{},v===c.length-1&&(g[c[v]]=t),m(g[c[v]],v+1))}c&&c.length&&(c.length===1?h[c[0]]=t:c.length>1&&m(h,0)),app.flags=app.flags||{},app.flags._unsaved=!0}function e(){const a=$("#tag-whitelist");a.tagsinput({tagClass:"badge bg-info",confirmKeys:[13,44],trimValue:!0}),ajaxify.data.category.tagWhitelist.forEach(function(t){a.tagsinput("add",t)}),a.on("itemAdded itemRemoved",function(){l(a)})}return s}.apply(b,p),y!==void 0&&(w.exports=y)},74344:(w,b,f)=>{f.r(b),f.d(b,{del:()=>l,get:()=>i,head:()=>r,patch:()=>s,post:()=>d,put:()=>h});var p=f(85233),y=f.n(p),E=f(63281),x=f.n(E);const C=config.relative_path+"/api/v3";async function u(e,a){if(e.url=e.url.startsWith("/api")?config.relative_path+e.url:C+e.url,typeof a=="function"){o(e).then(t=>a(null,t),t=>a(t));return}try{return await o(e)}catch(t){if(t.message==="A valid login session was not found. Please log in and try again.")return(0,E.confirm)("[[error:api.reauth-required]]",n=>{n&&ajaxify.go("login")});throw t}}async function o(e){const{url:a}=e;delete e.url,e.data&&!(e.data instanceof FormData)&&(e.data=JSON.stringify(e.data||{}),e.headers["content-type"]="application/json; charset=utf-8"),{options:e}=await(0,p.fire)("filter:api.options",{options:e}),e.data&&(e.body=e.data,delete e.data);const t=await fetch(a,e),{headers:n}=t,c=n.get("content-type"),m=c&&c.startsWith("application/json");let g;if(e.method!=="head"&&(m?g=await t.json():g=await t.text()),!t.ok)throw g?new Error(m?g.status.message:g):new Error(t.statusText);return m&&g&&g.hasOwnProperty("status")&&g.hasOwnProperty("response")?g.response:g}function i(e,a,t){return u({url:e+(a&&Object.keys(a).length?"?"+$.param(a):"")},t)}function r(e,a,t){return u({url:e+(a&&Object.keys(a).length?"?"+$.param(a):""),method:"head"},t)}function d(e,a,t){return u({url:e,method:"post",data:a,headers:{"x-csrf-token":config.csrf_token}},t)}function s(e,a,t){return u({url:e,method:"patch",data:a,headers:{"x-csrf-token":config.csrf_token}},t)}function h(e,a,t){return u({url:e,method:"put",data:a,headers:{"x-csrf-token":config.csrf_token}},t)}function l(e,a,t){return u({url:e,method:"delete",data:a,headers:{"x-csrf-token":config.csrf_token}},t)}},22905:(w,b,f)=>{var p,y;p=[f(7927),f(73138)],y=function(E,x){const C={};return C.init=function(u,o){let i=null;o=o||{},o.privilege=o.privilege||"topics:read",o.states=o.states||["watching","notwatching","ignoring"],o.cacheList=o.hasOwnProperty("cacheList")?o.cacheList:!0;let r=[];Array.isArray(o.localCategories)&&(r=o.localCategories.map(e=>({...e}))),o.selectedCids=o.selectedCids||ajaxify.data.selectedCids||[];const d=u.find('[component="category-selector-search"]');if(!d.length)return;const s=d.parent('[component="category/dropdown"]').length>0||d.parent('[component="category-selector"]').length>0;u.on("show.bs.dropdown",function(){s&&(u.find(".dropdown-toggle").css({visibility:"hidden"}),d.removeClass("hidden"),d.css({"z-index":u.find(".dropdown-toggle").css("z-index")+1}));function e(){const a=d.find("input").val();a.length>1||!a&&!i?h(a,function(t){i=o.cacheList&&(i||t),l(t)}):!a&&i&&l(i)}d.on("click",function(a){a.preventDefault(),a.stopPropagation()}),d.find("input").val("").on("keyup",utils.debounce(e,300)),e()}),u.on("shown.bs.dropdown",function(){["xs","sm"].includes(utils.findBootstrapEnvironment())||d.find("input").focus()}),u.on("hide.bs.dropdown",function(){s&&(u.find(".dropdown-toggle").css({visibility:"inherit"}),d.addClass("hidden")),d.off("click"),d.find("input").off("keyup")});function h(e,a){socket.emit("categories.categorySearch",{search:e,query:utils.params(),parentCid:o.parentCid||0,selectedCids:o.selectedCids,privilege:o.privilege,states:o.states,showLinks:o.showLinks},function(t,n){if(t)return E.error(t);a(r.concat(n))})}function l(e){const a=o.selectedCids.map(String);e.forEach(function(t){t.selected=a.includes(String(t.cid))}),app.parseAndTranslate(o.template,{categoryItems:e.slice(0,200),selectedCategory:ajaxify.data.selectedCategory,allCategoriesUrl:ajaxify.data.allCategoriesUrl},function(t){u.find('[component="category/list"]').html(t.find('[component="category/list"]').html()),u.find('[component="category/list"] [component="category/no-matches"]').toggleClass("hidden",!!e.length);const n=x.Dropdown.getInstance(u.find(".dropdown-toggle").get(0));n&&n.update()})}},C}.apply(b,p),y!==void 0&&(w.exports=y)},50548:(w,b,f)=>{var p,y;p=[f(22905),f(63281),f(85233),f(32230)],y=function(E,x,C,u){const o={};return o.init=function(i,r){if(!i||!i.length)return;r=r||{};const d=r.onSelect||function(){};r.states=r.states||["watching","notwatching","ignoring"],r.template=r.template||"partials/category/selector-dropdown-left",C.fire("action:category.selector.options",{el:i,options:r}),E.init(i,r);const s={el:i,selectedCategory:null};i.on("click","[data-cid]",function(){const l=$(this);return l.hasClass("disabled")?!1:(s.selectCategory(l.attr("data-cid")),d(s.selectedCategory))});let h=s.el.find('[component="category-selector-selected"]').html();return u.translate(h,l=>{h=l}),s.selectCategory=function(l){const e=s.el.find('[data-cid="'+l+'"]');s.selectedCategory={cid:l,name:e.attr("data-name")},e.length?s.el.find('[component="category-selector-selected"]').html(e.find('[component="category-markup"]').html()):s.el.find('[component="category-selector-selected"]').html(h)},s.getSelectedCategory=function(){return s.selectedCategory},s.getSelectedCid=function(){return s.selectedCategory?s.selectedCategory.cid:0},r.hasOwnProperty("selectedCategory")&&app.parseAndTranslate(r.template,{selectedCategory:r.selectedCategory},function(l){s.el.find('[component="category-selector-selected"]').html(l.find('[component="category-selector-selected"]').html())}),s},o.modal=function(i){i=i||{},i.onSelect=i.onSelect||function(){},i.onSubmit=i.onSubmit||function(){},app.parseAndTranslate("admin/partials/categories/select-category",{message:i.message},function(r){const d=x.dialog({title:i.title||"[[modules:composer.select-category]]",message:r,buttons:{save:{label:"[[global:select]]",className:"btn-primary",callback:h}}}),s=o.init(d.find('[component="category-selector"]'),i);function h(l){return l.preventDefault(),s.selectedCategory&&(i.onSubmit(s.selectedCategory),d.modal("hide")),!1}i.openOnLoad&&d.on("shown.bs.modal",function(){d.find(".dropdown-toggle").dropdown("toggle")}),d.find("form").on("submit",h)})},o}.apply(b,p),y!==void 0&&(w.exports=y)}}]);
