"use strict";(self.webpackChunknodebb=self.webpackChunknodebb||[]).push([[77129,70565,83014,28253,66623,49286,99617,86193],{38618:(v,C,u)=>{var g,m;g=[u(86193),u(74344),u(63281),u(7927),u(50548)],m=function(y,h,f,l,d){const i={};return i.init=function(){y.user($("#admin-search"),function(t,n){socket.emit("admin.user.makeAdmins",[n.item.user.uid],function(r){if(r)return l.error(r);$("#admin-search").val(""),!$('.administrator-area [data-uid="'+n.item.user.uid+'"]').length&&app.parseAndTranslate("admin/manage/admins-mods","admins.members",{admins:{members:[n.item.user]}},function(c){$(".administrator-area").prepend(c)})})}),$(".administrator-area").on("click",".remove-user-icon",function(){const t=$(this).parents("[data-uid]"),n=t.attr("data-uid");if(parseInt(n,10)===parseInt(app.user.uid,10))return l.error("[[admin/manage/users:alerts.no-remove-yourself-admin]]");f.confirm("[[admin/manage/users:alerts.confirm-remove-admin]]",function(r){r&&socket.emit("admin.user.removeAdmins",[n],function(c){if(c)return l.error(c.message);t.remove()})})}),y.user($("#global-mod-search"),function(t,n){h.put("/groups/global-moderators/membership/"+n.item.user.uid).then(()=>{$("#global-mod-search").val(""),!$('.global-moderator-area [data-uid="'+n.item.user.uid+'"]').length&&app.parseAndTranslate("admin/manage/admins-mods","globalMods.members",{globalMods:{members:[n.item.user]}},function(r){$(".global-moderator-area").prepend(r),$("#no-global-mods-warning").addClass("hidden")})}).catch(l.error)}),$(".global-moderator-area").on("click",".remove-user-icon",function(){const t=$(this).parents("[data-uid]"),n=t.attr("data-uid");f.confirm("[[admin/manage/users:alerts.confirm-remove-global-mod]]",function(r){r&&h.del("/groups/global-moderators/membership/"+n).then(()=>{t.remove(),$(".global-moderator-area").children().length||$("#no-global-mods-warning").removeClass("hidden")}).catch(l.error)})}),d.init($('[component="category-selector"]'),{parentCid:ajaxify.data.selectedCategory?ajaxify.data.selectedCategory.cid:0,onSelect:function(t){ajaxify.go("admin/manage/admins-mods"+(t.cid?"?cid="+t.cid:""))},localCategories:[]}),y.user($(".moderator-search"),function(t,n){const r=$(t.target),c=$(t.target).attr("data-cid");h.put(`/categories/${c}/moderator/${n.item.user.uid}`,{},function(s){if(s)return l.error(s);r.val(""),!$('.moderator-area[data-cid="'+c+'"] [data-uid="'+n.item.user.uid+'"]').length&&app.parseAndTranslate("admin/manage/admins-mods","globalMods.members",{globalMods:{members:[n.item.user]}},function(e){$('.moderator-area[data-cid="'+c+'"]').prepend(e),$('.no-moderator-warning[data-cid="'+c+'"]').addClass("hidden")})})}),$(".moderator-area").on("click",".remove-user-icon",function(){const t=$(this).parents("[data-cid]"),n=t.attr("data-cid"),r=$(this).parents("[data-uid]"),c=r.attr("data-uid");f.confirm("[[admin/manage/users:alerts.confirm-remove-moderator]]",function(s){s&&h.del(`/categories/${n}/moderator/${c}`,{},function(e){if(e)return l.error(e);r.remove(),t.children().length||$('.no-moderator-warning[data-cid="'+n+'"]').removeClass("hidden")})})})},i}.apply(C,g),m!==void 0&&(v.exports=m)},74344:(v,C,u)=>{u.r(C),u.d(C,{del:()=>s,get:()=>i,head:()=>t,patch:()=>r,post:()=>n,put:()=>c});var g=u(85233),m=u.n(g),y=u(63281),h=u.n(y);const f=config.relative_path+"/api/v3";async function l(e,o){if(e.url=e.url.startsWith("/api")?config.relative_path+e.url:f+e.url,typeof o=="function"){d(e).then(a=>o(null,a),a=>o(a));return}try{return await d(e)}catch(a){if(a.message==="A valid login session was not found. Please log in and try again.")return(0,y.confirm)("[[error:api.reauth-required]]",p=>{p&&ajaxify.go("login")});throw a}}async function d(e){const{url:o}=e;delete e.url,e.data&&!(e.data instanceof FormData)&&(e.data=JSON.stringify(e.data||{}),e.headers["content-type"]="application/json; charset=utf-8"),{options:e}=await(0,g.fire)("filter:api.options",{options:e}),e.data&&(e.body=e.data,delete e.data);const a=await fetch(o,e),{headers:p}=a,A=p.get("content-type"),b=A&&A.startsWith("application/json");let E;if(e.method!=="head"&&(b?E=await a.json():E=await a.text()),!a.ok)throw E?new Error(b?E.status.message:E):new Error(a.statusText);return b&&E&&E.hasOwnProperty("status")&&E.hasOwnProperty("response")?E.response:E}function i(e,o,a){return l({url:e+(o&&Object.keys(o).length?"?"+$.param(o):"")},a)}function t(e,o,a){return l({url:e+(o&&Object.keys(o).length?"?"+$.param(o):""),method:"head"},a)}function n(e,o,a){return l({url:e,method:"post",data:o,headers:{"x-csrf-token":config.csrf_token}},a)}function r(e,o,a){return l({url:e,method:"patch",data:o,headers:{"x-csrf-token":config.csrf_token}},a)}function c(e,o,a){return l({url:e,method:"put",data:o,headers:{"x-csrf-token":config.csrf_token}},a)}function s(e,o,a){return l({url:e,method:"delete",data:o,headers:{"x-csrf-token":config.csrf_token}},a)}},86193:(v,C,u)=>{var g,m;g=[u(74344),u(7927)],m=function(y,h){const f={},l={delay:200,appendTo:null};f.init=i=>{const t={...l,...i},{input:n,onSelect:r}=t;app.loadJQueryUI(function(){n.autocomplete({...t,open:function(){$(this).autocomplete("widget").css("z-index",100005)},select:function(c,s){d(n,r,c,s)}})})},f.user=function(i,t,n){typeof t=="function"&&(n=t,t={}),t=t||{},f.init({input:i,onSelect:n,source:(r,c)=>{t.query=r.term,y.get("/api/users",t,function(s,e){if(s)return h.error(s);if(e&&e.users){const o=e.users.map(function(a){const p=$("<div></div>").html(a.username).text();return a&&{label:p,value:p,user:{uid:a.uid,name:a.username,slug:a.userslug,username:a.username,userslug:a.userslug,picture:a.picture,banned:a.banned,"icon:text":a["icon:text"],"icon:bgColor":a["icon:bgColor"]}}});c(o)}$(".ui-autocomplete a").attr("data-ajaxify","false")})}})},f.group=function(i,t){f.init({input:i,onSelect:t,source:(n,r)=>{socket.emit("groups.search",{query:n.term},function(c,s){if(c)return h.error(c);if(s&&s.length){const e=s.map(function(o){return o&&{label:o.name,value:o.name,group:o}});r(e)}$(".ui-autocomplete a").attr("data-ajaxify","false")})}})},f.tag=function(i,t){f.init({input:i,onSelect:t,delay:100,source:(n,r)=>{socket.emit("topics.autocompleteTags",{query:n.term,cid:ajaxify.data.cid||0},function(c,s){if(c)return h.error(c);s&&r(s),$(".ui-autocomplete a").attr("data-ajaxify","false")})}})};function d(i,t,n,r){t=t||function(){};const c=jQuery.Event("keypress");c.which=13,c.keyCode=13,setTimeout(function(){i.trigger(c)},100),t(n,r)}return f}.apply(C,g),m!==void 0&&(v.exports=m)},22905:(v,C,u)=>{var g,m;g=[u(7927),u(73138)],m=function(y,h){const f={};return f.init=function(l,d){let i=null;d=d||{},d.privilege=d.privilege||"topics:read",d.states=d.states||["watching","notwatching","ignoring"],d.cacheList=d.hasOwnProperty("cacheList")?d.cacheList:!0;let t=[];Array.isArray(d.localCategories)&&(t=d.localCategories.map(e=>({...e}))),d.selectedCids=d.selectedCids||ajaxify.data.selectedCids||[];const n=l.find('[component="category-selector-search"]');if(!n.length)return;const r=n.parent('[component="category/dropdown"]').length>0||n.parent('[component="category-selector"]').length>0;l.on("show.bs.dropdown",function(){r&&(l.find(".dropdown-toggle").css({visibility:"hidden"}),n.removeClass("hidden"),n.css({"z-index":l.find(".dropdown-toggle").css("z-index")+1}));function e(){const o=n.find("input").val();o.length>1||!o&&!i?c(o,function(a){i=d.cacheList&&(i||a),s(a)}):!o&&i&&s(i)}n.on("click",function(o){o.preventDefault(),o.stopPropagation()}),n.find("input").val("").on("keyup",utils.debounce(e,300)),e()}),l.on("shown.bs.dropdown",function(){["xs","sm"].includes(utils.findBootstrapEnvironment())||n.find("input").focus()}),l.on("hide.bs.dropdown",function(){r&&(l.find(".dropdown-toggle").css({visibility:"inherit"}),n.addClass("hidden")),n.off("click"),n.find("input").off("keyup")});function c(e,o){socket.emit("categories.categorySearch",{search:e,query:utils.params(),parentCid:d.parentCid||0,selectedCids:d.selectedCids,privilege:d.privilege,states:d.states,showLinks:d.showLinks},function(a,p){if(a)return y.error(a);o(t.concat(p))})}function s(e){const o=d.selectedCids.map(String);e.forEach(function(a){a.selected=o.includes(String(a.cid))}),app.parseAndTranslate(d.template,{categoryItems:e.slice(0,200),selectedCategory:ajaxify.data.selectedCategory,allCategoriesUrl:ajaxify.data.allCategoriesUrl},function(a){l.find('[component="category/list"]').html(a.find('[component="category/list"]').html()),l.find('[component="category/list"] [component="category/no-matches"]').toggleClass("hidden",!!e.length);const p=h.Dropdown.getInstance(l.find(".dropdown-toggle").get(0));p&&p.update()})}},f}.apply(C,g),m!==void 0&&(v.exports=m)},50548:(v,C,u)=>{var g,m;g=[u(22905),u(63281),u(85233),u(32230)],m=function(y,h,f,l){const d={};return d.init=function(i,t){if(!i||!i.length)return;t=t||{};const n=t.onSelect||function(){};t.states=t.states||["watching","notwatching","ignoring"],t.template=t.template||"partials/category/selector-dropdown-left",f.fire("action:category.selector.options",{el:i,options:t}),y.init(i,t);const r={el:i,selectedCategory:null};i.on("click","[data-cid]",function(){const s=$(this);return s.hasClass("disabled")?!1:(r.selectCategory(s.attr("data-cid")),n(r.selectedCategory))});let c=r.el.find('[component="category-selector-selected"]').html();return l.translate(c,s=>{c=s}),r.selectCategory=function(s){const e=r.el.find('[data-cid="'+s+'"]');r.selectedCategory={cid:s,name:e.attr("data-name")},e.length?r.el.find('[component="category-selector-selected"]').html(e.find('[component="category-markup"]').html()):r.el.find('[component="category-selector-selected"]').html(c)},r.getSelectedCategory=function(){return r.selectedCategory},r.getSelectedCid=function(){return r.selectedCategory?r.selectedCategory.cid:0},t.hasOwnProperty("selectedCategory")&&app.parseAndTranslate(t.template,{selectedCategory:t.selectedCategory},function(s){r.el.find('[component="category-selector-selected"]').html(s.find('[component="category-selector-selected"]').html())}),r},d.modal=function(i){i=i||{},i.onSelect=i.onSelect||function(){},i.onSubmit=i.onSubmit||function(){},app.parseAndTranslate("admin/partials/categories/select-category",{message:i.message},function(t){const n=h.dialog({title:i.title||"[[modules:composer.select-category]]",message:t,buttons:{save:{label:"[[global:select]]",className:"btn-primary",callback:c}}}),r=d.init(n.find('[component="category-selector"]'),i);function c(s){return s.preventDefault(),r.selectedCategory&&(i.onSubmit(r.selectedCategory),n.modal("hide")),!1}i.openOnLoad&&n.on("shown.bs.modal",function(){n.find(".dropdown-toggle").dropdown("toggle")}),n.find("form").on("submit",c)})},d}.apply(C,g),m!==void 0&&(v.exports=m)}}]);
