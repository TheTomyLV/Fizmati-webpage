(self.webpackChunknodebb=self.webpackChunknodebb||[]).push([[70071,38786,28306],{69986:(b,I,p)=>{"use strict";var v,u;v=[p(32230),p(7237),p(42840),p(16943),p(85233),p(7927)],u=function(f,s,a,g,C,d){const r={};let h={};const N=({notifications:n})=>new Promise(o=>{for(let i=0;i<n.length;i+=1)n[i].timeagoLong=$.timeago(new Date(parseInt(n[i].datetime,10)));f.toggleTimeagoShorthand(function(){for(let i=0;i<n.length;i+=1)n[i].timeago=$.timeago(new Date(parseInt(n[i].datetime,10))),n[i].timeagoShort=n[i].timeago;f.toggleTimeagoShorthand(),o({notifications:n})})});C.on("filter:notifications.load",N),r.loadNotifications=function(n,o){o=o||function(){},socket.emit("notifications.get",null,function(i,c){if(i)return d.error(i);const E=c.unread.concat(c.read).sort(function(B,F){return parseInt(B.datetime,10)>parseInt(F.datetime,10)?-1:1});C.fire("filter:notifications.load",{notifications:E}).then(({notifications:B})=>{app.parseAndTranslate("partials/notifications_list",{notifications:B},function(F){n.html(F),n.off("click").on("click","[data-nid]",function(D){const P=$(this);if(A(P)&&(D.stopPropagation(),D.preventDefault(),s.get("notifications/list").dropdown("toggle")),!P.hasClass("unread"))return;const M=P.attr("data-nid");m(M,!0)}),s.get("notifications").on("click",".mark-all-read",r.markAllRead),r.handleUnreadButton(n),C.fire("action:notifications.loaded",{notifications:E,list:n}),o()})})})},r.handleUnreadButton=function(n){n.on("click",".mark-read",function(){const o=$(this),i=o.parents("[data-nid]"),c=i.hasClass("unread"),E=i.attr("data-nid");return m(E,c,function(){i.toggleClass("unread"),o.find(".unread").toggleClass("hidden",c),o.find(".read").toggleClass("hidden",!c)}),!1})},r.onNewNotification=function(n){ajaxify.currentPage==="notifications"&&ajaxify.refresh(),!(ajaxify.data.template.chats&&parseInt(ajaxify.data.roomId,10)===parseInt(n.roomId,10))&&(socket.emit("notifications.getCount",function(o,i){if(o)return d.error(o);r.updateNotifCount(i)}),h[n.nid]||(h[n.nid]=!0))},r.markNotification=function(n,o,i){m(n,o,i)};function m(n,o,i){socket.emit("notifications.mark"+(o?"Read":"Unread"),n,function(c){if(c)return d.error(c);o&&h[n]&&delete h[n],i&&i()})}function A(n){const o=n.attr("data-pid"),i=n.attr("data-path"),c=s.get("post","pid",o);return i.startsWith(config.relative_path+"/post/")&&o&&c.length&&ajaxify.data.template.topic?(a.scrollToIndex(c.attr("data-index"),!0),!0):!1}return r.updateNotifCount=function(n){const o=s.get("notifications/icon");n=Math.max(0,n),o.toggleClass("fa-bell",n>0).toggleClass("fa-bell-o",n<=0);const i=n>99?"99+":n;o.toggleClass("unread-count",n>0),o.attr("data-content",i),s.get("notifications/count").toggleClass("hidden",n<=0).text(i);const c={count:n,updateFavicon:!0};C.fire("action:notification.updateCount",c),c.updateFavicon&&g.setBubble(i),a.setAppBadge&&a.setAppBadge(n)},r.markAllRead=function(){socket.emit("notifications.markAllRead",function(n){n&&d.error(n),h={};const o=$('[component="notifications/list"] [data-nid]');o.removeClass("unread"),o.find(".mark-read .unread").addClass("hidden"),o.find(".mark-read .read").removeClass("hidden")})},r}.apply(I,v),u!==void 0&&(b.exports=u)},66603:(b,I,p)=>{"use strict";var v;v=function(){function u(){this._store={},this._keys=[]}u.prototype.isMock=!0,u.prototype.setItem=function(a,g){a=String(a),this._keys.indexOf(a)===-1&&this._keys.push(a),this._store[a]=g},u.prototype.getItem=function(a){return a=String(a),this._keys.indexOf(a)===-1?null:this._store[a]},u.prototype.removeItem=function(a){a=String(a),this._keys=this._keys.filter(function(g){return g!==a}),this._store[a]=null},u.prototype.clear=function(){this._keys=[],this._store={}},u.prototype.key=function(a){return a=parseInt(a,10)||0,this._keys[a]},Object.defineProperty&&Object.defineProperty(u.prototype,"length",{get:function(){return this._keys.length}});let f;const s=Date.now().toString();try{if(f=window.localStorage,f.setItem(s,s),f.getItem(s)!==s)throw Error("localStorage behaved unexpectedly");return f.removeItem(s),f}catch(a){console.warn(a),console.warn("localStorage failed, falling back on sessionStorage");try{if(f=window.sessionStorage,f.setItem(s,s),f.getItem(s)!==s)throw Error("sessionStorage behaved unexpectedly");return f.removeItem(s),f}catch(g){return console.warn(g),console.warn("sessionStorage failed, falling back on memory storage"),new u}}}.call(I,p,I,b),v!==void 0&&(b.exports=v)},16943:(b,I,p)=>{var v,u;/*!
* Tinycon - A small library for manipulating the Favicon
* Tom Moor, http://tommoor.com
* Copyright (c) 2015 Tom Moor
* @license MIT Licensed
*/(function(){var f={},s=null,a=null,g=null,C=null,d={},r=Math.ceil(window.devicePixelRatio)||1,h=16*r,N={width:7,height:9,font:10*r+"px arial",color:"#ffffff",background:"#F03D25",fallback:!0,crossOrigin:!0,abbreviate:!0},m=function(){var t=navigator.userAgent.toLowerCase();return function(e){return t.indexOf(e)!==-1}}(),A={ie:m("trident"),chrome:m("chrome"),webkit:m("chrome")||m("safari"),safari:m("safari")&&!m("chrome"),mozilla:m("mozilla")&&!m("chrome")&&!m("safari")},n=function(){for(var t=document.getElementsByTagName("link"),e=0,l=t.length;e<l;e++)if((t[e].getAttribute("rel")||"").match(/\bicon\b/i))return t[e];return!1},o=function(){for(var t=document.getElementsByTagName("link"),e=0,l=t.length;e<l;e++){var _=typeof t[e]<"u";_&&(t[e].getAttribute("rel")||"").match(/\bicon\b/i)&&t[e].parentNode.removeChild(t[e])}},i=function(){if(!a||!s){var t=n();s=t?t.getAttribute("href"):"/favicon.ico",a||(a=s)}return s},c=function(){return C||(C=document.createElement("canvas"),C.width=h,C.height=h),C},E=function(t){if(t){o();var e=document.createElement("link");e.type="image/x-icon",e.rel="icon",e.href=t,document.getElementsByTagName("head")[0].appendChild(e)}},B=function(t){window.console&&window.console.log(t)},F=function(t,_){if(!c().getContext||A.ie||A.safari||d.fallback==="force")return D(t);var l=c().getContext("2d"),_=_||"#000000",O=i();g=document.createElement("img"),g.onload=function(){l.clearRect(0,0,h,h),l.drawImage(g,0,0,g.width,g.height,0,0,h,h),(t+"").length>0&&P(l,t,_),R()},!O.match(/^data/)&&d.crossOrigin&&(g.crossOrigin="anonymous"),g.src=O},D=function(t){if(d.fallback){var e=document.title;e[0]==="("&&(e=e.slice(e.indexOf(" "))),(t+"").length>0?document.title="("+t+") "+e:document.title=e}},P=function(t,e,l){typeof e=="number"&&e>99&&d.abbreviate&&(e=M(e));var _=(e+"").length-1,O=d.width*r+6*r*_,x=d.height*r,S=h-x,k=h-O-r,y=16*r,T=16*r,w=2*r;t.font=(A.webkit?"bold ":"")+d.font,t.fillStyle=d.background,t.strokeStyle=d.background,t.lineWidth=r,t.beginPath(),t.moveTo(k+w,S),t.quadraticCurveTo(k,S,k,S+w),t.lineTo(k,y-w),t.quadraticCurveTo(k,y,k+w,y),t.lineTo(T-w,y),t.quadraticCurveTo(T,y,T,y-w),t.lineTo(T,S+w),t.quadraticCurveTo(T,S,T-w,S),t.closePath(),t.fill(),t.beginPath(),t.strokeStyle="rgba(0,0,0,0.3)",t.moveTo(k+w/2,y),t.lineTo(T-w/2,y),t.stroke(),t.fillStyle=d.color,t.textAlign="right",t.textBaseline="top",t.fillText(e,r===2?29:15,A.mozilla?7*r:6*r)},R=function(){c().getContext&&E(c().toDataURL())},M=function(t){for(var e=[["G",1e9],["M",1e6],["k",1e3]],l=0;l<e.length;++l)if(t>=e[l][1]){t=j(t/e[l][1])+e[l][0];break}return t},j=function(t,e){var l=new Number(t);return l.toFixed(e)};f.setOptions=function(t){d={},t.colour&&(t.color=t.colour);for(var e in N)d[e]=t.hasOwnProperty(e)?t[e]:N[e];return this},f.setImage=function(t){return s=t,R(),this},f.setBubble=function(t,e){return t=t||"",F(t,e),this},f.reset=function(){s=a,E(a)},f.setOptions(N),v=f,u=typeof v=="function"?v.call(I,p,I,b):v,u!==void 0&&(b.exports=u)})()}}]);
