(self.webpackChunknodebb=self.webpackChunknodebb||[]).push([[99098,38786,70565,83014,99617,28306,43034,79191,3564],{74344:(p,E,a)=>{"use strict";a.r(E),a.d(E,{del:()=>o,get:()=>i,head:()=>l,patch:()=>t,post:()=>u,put:()=>s});var g=a(85233),m=a.n(g),d=a(63281),h=a.n(d);const n=config.relative_path+"/api/v3";async function f(e,c){if(e.url=e.url.startsWith("/api")?config.relative_path+e.url:n+e.url,typeof c=="function"){k(e).then(r=>c(null,r),r=>c(r));return}try{return await k(e)}catch(r){if(r.message==="A valid login session was not found. Please log in and try again.")return(0,d.confirm)("[[error:api.reauth-required]]",A=>{A&&ajaxify.go("login")});throw r}}async function k(e){const{url:c}=e;delete e.url,e.data&&!(e.data instanceof FormData)&&(e.data=JSON.stringify(e.data||{}),e.headers["content-type"]="application/json; charset=utf-8"),{options:e}=await(0,g.fire)("filter:api.options",{options:e}),e.data&&(e.body=e.data,delete e.data);const r=await fetch(c,e),{headers:A}=r,b=A.get("content-type"),v=b&&b.startsWith("application/json");let y;if(e.method!=="head"&&(v?y=await r.json():y=await r.text()),!r.ok)throw y?new Error(v?y.status.message:y):new Error(r.statusText);return v&&y&&y.hasOwnProperty("status")&&y.hasOwnProperty("response")?y.response:y}function i(e,c,r){return f({url:e+(c&&Object.keys(c).length?"?"+$.param(c):"")},r)}function l(e,c,r){return f({url:e+(c&&Object.keys(c).length?"?"+$.param(c):""),method:"head"},r)}function u(e,c,r){return f({url:e,method:"post",data:c,headers:{"x-csrf-token":config.csrf_token}},r)}function t(e,c,r){return f({url:e,method:"patch",data:c,headers:{"x-csrf-token":config.csrf_token}},r)}function s(e,c,r){return f({url:e,method:"put",data:c,headers:{"x-csrf-token":config.csrf_token}},r)}function o(e,c,r){return f({url:e,method:"delete",data:c,headers:{"x-csrf-token":config.csrf_token}},r)}},47913:(p,E,a)=>{p.exports=a(66485)},45482:(p,E,a)=>{p.exports=a(35729)},83713:(p,E,a)=>{p.exports=a(51077)},38259:(p,E,a)=>{p.exports=a(65616)},6e4:(p,E,a)=>{"use strict";var g,m;g=[a(7237),a(44541),a(2585),a(74344),a(7927),a(33371),a(42441),a(66603)],m=function(d,h,n,f,k,i,l,u){const t={};t.init=function(){const o=d.get("topic/quickreply/text"),e=`qr:draft:tid:${ajaxify.data.tid}`,c={element:o,strategies:[],options:{style:{"z-index":100}}};s(),$(window).one("action:ajaxify.start",()=>{s()}),$(window).trigger("composer:autocomplete:init",c),n._active.core_qr=n.setup(c),l.bind("ctrl+return",b=>{b.target===o.get(0)&&d.get("topic/quickreply/button").get(0).click()}),i.init({dragDropAreaEl:$('[component="topic/quickreply/container"] .quickreply-message'),pasteEl:o,uploadFormEl:$('[component="topic/quickreply/upload"]'),inputEl:o,route:"/api/post/upload",callback:function(b){let v=o.val();b.forEach(y=>{v=v+(v?`
`:"")+(y.isImage?"!":"")+`[${y.filename}](${y.url})`}),o.val(v)}});let r=!0;d.get("topic/quickreply/button").on("click",function(b){if(b.preventDefault(),!r)return;const v=d.get("topic/quickreply/text").val(),y={tid:ajaxify.data.tid,handle:void 0,content:v},P=v.length;if(P<parseInt(config.minimumPostLength,10))return k.error("[[error:content-too-short, "+config.minimumPostLength+"]]");if(P>parseInt(config.maximumPostLength,10))return k.error("[[error:content-too-long, "+config.maximumPostLength+"]]");r=!1,f.post(`/topics/${ajaxify.data.tid}`,y,function(w,x){if(r=!0,w)return k.error(w);x&&x.queued&&k.alert({type:"success",title:"[[global:alert.success]]",message:x.message,timeout:1e4,clickfn:function(){ajaxify.go(`/post-queue/${x.id}`)}}),d.get("topic/quickreply/text").val(""),u.removeItem(e),n._active.core_qr.hide()})});const A=u.getItem(e);A&&o.val(A),o.on("keyup",utils.debounce(function(){const b=o.val();b?u.setItem(e,b):u.removeItem(e)},1e3)),d.get("topic/quickreply/expand").on("click",b=>{b.preventDefault(),u.removeItem(e);const v=d.get("topic/quickreply/text");h.newReply({tid:ajaxify.data.tid,title:ajaxify.data.title,body:v.val()}),v.val("")})};function s(){n._active.core_qr&&(n._active.core_qr.destroy(),n._active.core_qr=null)}return t}.apply(E,g),m!==void 0&&(p.exports=m)},66603:(p,E,a)=>{"use strict";var g;g=function(){function m(){this._store={},this._keys=[]}m.prototype.isMock=!0,m.prototype.setItem=function(n,f){n=String(n),this._keys.indexOf(n)===-1&&this._keys.push(n),this._store[n]=f},m.prototype.getItem=function(n){return n=String(n),this._keys.indexOf(n)===-1?null:this._store[n]},m.prototype.removeItem=function(n){n=String(n),this._keys=this._keys.filter(function(f){return f!==n}),this._store[n]=null},m.prototype.clear=function(){this._keys=[],this._store={}},m.prototype.key=function(n){return n=parseInt(n,10)||0,this._keys[n]},Object.defineProperty&&Object.defineProperty(m.prototype,"length",{get:function(){return this._keys.length}});let d;const h=Date.now().toString();try{if(d=window.localStorage,d.setItem(h,h),d.getItem(h)!==h)throw Error("localStorage behaved unexpectedly");return d.removeItem(h),d}catch(n){console.warn(n),console.warn("localStorage failed, falling back on sessionStorage");try{if(d=window.sessionStorage,d.setItem(h,h),d.getItem(h)!==h)throw Error("sessionStorage behaved unexpectedly");return d.removeItem(h),d}catch(f){return console.warn(f),console.warn("sessionStorage failed, falling back on memory storage"),new m}}}.call(E,a,E,p),g!==void 0&&(p.exports=g)},27145:(p,E,a)=>{"use strict";p=a.nmd(p);var g,m;g=[a(32230),a(85233)],m=function(d,h){const n={};let f=!1;n.init=function(){if(n.taskbar=$('[component="taskbar"]'),n.tasklist=n.taskbar.find("ul"),!n.taskbar.length||!n.tasklist.length){f=!0;return}n.taskbar.on("click","li",async function(){const t=$(this),s=t.attr("data-module"),o=t.attr("data-uuid"),e=await app.require(s);return t.hasClass("active")?e.minimize(o):(i(),e.load(o),n.toggleNew(o,!1),n.tasklist.removeClass("active"),t.addClass("active")),!1}),$(window).on("action:app.loggedOut",function(){n.closeAll()})},n.close=async function(t,s){if(f)return;if(n.tasklist.find('[data-module="'+p+'"][data-uuid="'+s+'"]').length){const e=await app.require(t);e&&typeof e.close=="function"&&e.close(s)}},n.closeAll=function(t){if(f)return;let s="[data-uuid]";t&&(s='[data-module="'+t+'"]'+s),n.tasklist.find(s).each(function(o,e){n.close(t||e.getAttribute("data-module"),e.getAttribute("data-uuid"))})},n.discard=function(t,s){if(f)return;n.tasklist.find('[data-module="'+t+'"][data-uuid="'+s+'"]').remove(),k()},n.push=function(t,s,o,e){if(e=e||function(){},f)return e();const c=n.tasklist.find('li[data-uuid="'+s+'"]'),r={module:t,uuid:s,options:o,element:c};h.fire("filter:taskbar.push",r),!c.length&&r.module?l(r,e):e(c)},n.get=function(t){return f?[]:$('[data-module="'+t+'"]').map(function(o,e){return $(e).data()})},n.minimize=function(t,s){if(f)return;n.tasklist.find('[data-module="'+t+'"][data-uuid="'+s+'"]').toggleClass("active",!1)},n.toggleNew=function(t,s,o){if(f)return;n.tasklist.find('[data-uuid="'+t+'"]').toggleClass("new",s),o||h.fire("action:taskbar.toggleNew",t)},n.updateActive=function(t){if(f)return;const s=n.tasklist.find("li");s.removeClass("active"),s.filter('[data-uuid="'+t+'"]').addClass("active"),$("[data-uuid]:not([data-module])").toggleClass("modal-unfocused",!0),$('[data-uuid="'+t+'"]:not([data-module])').toggleClass("modal-unfocused",!1)},n.isActive=function(t){return f?!1:n.tasklist.find('li[data-uuid="'+t+'"]').hasClass("active")};function k(){if(f)return;n.tasklist.find("li").length>0?n.taskbar.attr("data-active","1"):n.taskbar.removeAttr("data-active")}function i(){f||n.tasklist.find(".active").removeClass("active")}function l(t,s){if(f)return s();d.translate(t.options.title,function(o){const e=$("<div></div>").text(o||"NodeBB Task").html(),c=$("<li></li>").addClass(t.options.className).html('<a href="#"'+(t.options.image?` style="background-image: url('`+t.options.image.replace(/&#x2F;/g,"/")+`'); background-size: cover;"`:"")+">"+(t.options.icon?'<i class="fa '+t.options.icon+'"></i> ':"")+'<span aria-label="'+e+'" component="taskbar/title">'+e+"</span></a>").attr({title:e,"data-module":t.module,"data-uuid":t.uuid}).addClass(t.options.state!==void 0?t.options.state:"active");(!t.options.state||t.options.state==="active")&&i(),n.tasklist.append(c),k(),t.element=c,c.data(t),h.fire("action:taskbar.pushed",t),s(c)})}const u=function(t,s,o){switch(s){case"title":t.find('[component="taskbar/title"]').text(o);break;case"icon":t.find("i").attr("class","fa fa-"+o);break;case"image":t.find("a").css("background-image",o?'url("'+o.replace(/&#x2F;/g,"/")+'")':"");break;case"background-color":t.find("a").css("background-color",o);break;case"color":t.find("a").css("color",o);break}};return n.update=function(t,s,o){if(f)return;const e=n.tasklist.find('[data-module="'+t+'"][data-uuid="'+s+'"]');if(!e.length)return;const c=e.data();Object.keys(o).forEach(function(r){c[r]=o[r],u(e,r,o[r])}),e.data(c)},n}.apply(E,g),m!==void 0&&(p.exports=m)},62023:(p,E,a)=>{"use strict";var g,m;g=[a(74344),a(63281),a(7927),a(50431),a(59006),a(32230),a(62526)],m=function(d,h,n,f,k,i){const l={};return l.get=u=>d.get(`/topics/${u}/thumbs`,{}),l.getByPid=u=>d.get(`/posts/${u}`,{}).then(t=>l.get(t.tid)),l.delete=(u,t)=>d.del(`/topics/${u}/thumbs`,{path:t}),l.deleteAll=u=>{l.get(u).then(t=>{Promise.all(t.map(s=>l.delete(u,s.url)))})},l.upload=u=>new Promise(t=>{f.show({title:"[[topic:composer.thumb-title]]",method:"put",route:config.relative_path+`/api/v3/topics/${u}/thumbs`},function(s){t(s)})}),l.modal={},l.modal.open=function(u){const{id:t,pid:s}=u;let{modal:o}=u,e;return new Promise(c=>{Promise.all([l.get(t),s?l.getByPid(s):[]]).then(r=>new Promise(A=>{const b=r.reduce((v,y)=>v.concat(y));e=b.length,A(b)})).then(r=>k.render("modals/topic-thumbs",{thumbs:r})).then(r=>{o?i.translate(r,function(A){o.find(".bootbox-body").html(A),l.modal.handleSort({modal:o,numThumbs:e})}):(o=h.dialog({title:"[[modules:thumbs.modal.title]]",message:r,onEscape:!0,backdrop:!0,buttons:{add:{label:'<i class="fa fa-plus"></i> [[modules:thumbs.modal.add]]',className:"btn-success",callback:()=>(l.upload(t).then(()=>{l.modal.open({...u,modal:o}),Promise.all([a.e(61006),a.e(18099),a.e(10830),a.e(8311)]).then(function(){var A=[a(44541)];(b=>{b.updateThumbCount(t,$(`[component="composer"][data-uuid="${t}"]`)),c()}).apply(null,A)}).catch(a.oe)}),!1)},close:{label:"[[global:close]]",className:"btn-primary"}}}),l.modal.handleDelete({...u,modal:o}),l.modal.handleSort({modal:o,numThumbs:e}))})})},l.modal.handleDelete=u=>{u.modal.get(0).addEventListener("click",s=>{s.target.closest('button[data-action="remove"]')&&h.confirm("[[modules:thumbs.modal.confirm-remove]]",o=>{if(!o)return;const e=s.target.closest("[data-id]").getAttribute("data-id"),c=s.target.closest("[data-path]").getAttribute("data-path");d.del(`/topics/${e}/thumbs`,{path:c}).then(()=>{l.modal.open(u)}).catch(n.error)})})},l.modal.handleSort=({modal:u,numThumbs:t})=>{if(t>1){const s=u.find(".topic-thumbs-modal");s.sortable({items:"[data-id]"}),s.on("sortupdate",l.modal.handleSortChange)}},l.modal.handleSortChange=(u,t)=>{const s=t.item.get(0).parentNode.querySelectorAll("[data-id]");Array.from(s).forEach((o,e)=>{const c=o.getAttribute("data-id");let r=o.getAttribute("data-path");r=r.replace(new RegExp(`^${config.upload_url}`),""),d.put(`/topics/${c}/thumbs/order`,{path:r,order:e}).catch(n.error)})},l}.apply(E,g),m!==void 0&&(p.exports=m)},50431:(p,E,a)=>{"use strict";var g,m;g=[a(86569)],m=function(){const d={};d.show=function(i,l){const u=i.hasOwnProperty("fileSize")&&i.fileSize!==void 0?parseInt(i.fileSize,10):!1;app.parseAndTranslate("modals/upload-file",{showHelp:i.hasOwnProperty("showHelp")&&i.showHelp!==void 0?i.showHelp:!0,fileSize:u,title:i.title||"[[global:upload-file]]",description:i.description||"",button:i.button||"[[global:upload]]",accept:i.accept?i.accept.replace(/,/g,"&#44; "):""},function(t){t.modal("show"),t.on("hidden.bs.modal",function(){t.remove()});const s=t.find("#uploadForm");s.attr("action",i.route),s.find("#params").val(JSON.stringify(i.params)),t.find("#fileUploadSubmitBtn").on("click",function(){$(this).addClass("disabled"),s.submit()}),s.submit(function(){return h(t,u,l),!1})})},d.hideAlerts=function(i){$(i).find("#alert-status, #alert-success, #alert-error, #upload-progress-box").addClass("hide")};function h(i,l,u){n(i,"status","[[uploads:uploading-file]]"),i.find("#upload-progress-bar").css("width","0%"),i.find("#upload-progress-box").show().removeClass("hide");const t=i.find("#fileInput");if(!t.val())return n(i,"error","[[uploads:select-file-to-upload]]");if(!k(t[0],l))return n(i,"error","[[error:file-too-big, "+l+"]]");d.ajaxSubmit(i,u)}function n(i,l,u){d.hideAlerts(i),l==="error"&&i.find("#fileUploadSubmitBtn").removeClass("disabled"),u=u.replace(/&amp;#44/g,"&#44"),i.find("#alert-"+l).translateText(u).removeClass("hide")}d.ajaxSubmit=function(i,l){i.find("#uploadForm").ajaxSubmit({headers:{"x-csrf-token":config.csrf_token},error:function(t){t=f(t),n(i,"error",t.responseJSON?.status?.message||t.responseJSON?.error||`[[error:upload-error-fallback, ${t.status} ${t.statusText}]]`)},uploadProgress:function(t,s,o,e){i.find("#upload-progress-bar").css("width",e+"%")},success:function(t){let s=f(t);t.hasOwnProperty("response")&&t.hasOwnProperty("status")&&t.status.code==="ok"&&(s=t.response.images),l(s[0].url),n(i,"success","[[uploads:upload-success]]"),setTimeout(function(){d.hideAlerts(i),i.modal("hide")},750)}})};function f(i){if(typeof i=="string")try{return JSON.parse(i)}catch{return{error:"[[error:parse-error]]"}}return i}function k(i,l){return window.FileReader&&l?i.files[0].size<=l*1e3:!0}return d}.apply(E,g),m!==void 0&&(p.exports=m)}}]);
