"use strict";(self.webpackChunknodebb=self.webpackChunknodebb||[]).push([[42840,82344],{78989:(Y,R,T)=>{var k,P;k=[T(63281)],P=function(v){const w={};return w.init=function(){$("body").on("click",'[component="pagination/select-page"]',function(){return v.prompt("[[global:enter-page-number]]",function(h){w.loadPage(h)}),!1})},w.loadPage=function(h,j){if(j=j||function(){},h=parseInt(h,10),!utils.isNumber(h)||h<1||h>ajaxify.data.pagination.pageCount)return;const A=utils.params();A.page=h;const K=window.location.pathname+"?"+$.param(A);ajaxify.go(K,j)},w.nextPage=function(h){w.loadPage(ajaxify.data.pagination.currentPage+1,h)},w.previousPage=function(h){w.loadPage(ajaxify.data.pagination.currentPage-1,h)},w}.apply(R,k),P!==void 0&&(Y.exports=P)},42840:(Y,R,T)=>{var k,P;k=[T(78989),T(7237),T(85233),T(7927),T(32230),T(66603)],P=function(v,w,h,j,A,K){const o={};let c=0,g=0,M=0,W,C,O,B,X,E=!1,I=!0,H="";o.scrollActive=!1;let i=$(".pagination-block"),_=i.find(".pagination-text"),tt=i.find("meter"),ot=i.find(".progress-bar"),F=i.find(".unread"),y;$(window).on("action:ajaxify.start",function(){$(window).off("keydown",J)}),o.init=function(t,n,a,e,d){c=0,o.selector=t,o.callback=d,o.toTop=a||function(){},o.toBottom=e||function(){},i=$(".pagination-block"),_=i.find(".pagination-text"),tt=i.find("meter"),ot=i.find(".progress-bar"),F=i.find(".unread"),y=$(".scroller-thumb"),H=utils.findBootstrapEnvironment(),$(window).off("scroll",o.delayedUpdate).on("scroll",o.delayedUpdate),i.find(".dropdown-menu").off("click").on("click",function(l){l.stopPropagation()}),i.off("shown.bs.dropdown",".wrapper").on("shown.bs.dropdown",".wrapper",function(){const l=$(this);setTimeout(async function(){["lg","xl","xxl"].includes(utils.findBootstrapEnvironment())&&l.find("input").trigger("focus"),await socket.emit("topics.getPostCountInTopic",ajaxify.data.tid)>0&&i.find("#myNextPostBtn").removeAttr("disabled")},100)}),i.find(".pageup").off("click").on("click",o.scrollUp),i.find(".pagedown").off("click").on("click",o.scrollDown),i.find(".pagetop").off("click").on("click",o.toTop),i.find(".pagebottom").off("click").on("click",o.toBottom),i.find(".pageprev").off("click").on("click",v.previousPage),i.find(".pagenext").off("click").on("click",v.nextPage),i.find("#myNextPostBtn").off("click").on("click",at),i.find("input").on("keydown",function(l){if(l.which===13){const f=$(this);if(!utils.isNumber(f.val())){f.val("");return}const m=parseInt(f.val(),10),r=D(m);f.val(""),i.find(".dopdown-menu.show").removeClass("show"),ajaxify.go(r)}}),ajaxify.data.template.topic&&(st(),M=ajaxify.data.postcount,et(ajaxify.data.postIndex)),ct(),o.setCount(n),o.update()};let L=0;async function at(){async function t(n){return await socket.emit("topics.getMyNextPostIndex",{tid:ajaxify.data.tid,index:Math.max(1,n),sort:config.topicPostSort})}if(ajaxify.data.template.topic){let n=await t(c);L===n&&(n=await t(n)),n&&c!==n+1?(L=n,$(window).one("action:ajaxify.end",function(){i.find(".dropdown-menu").is(":hidden")&&i.find(".dropdown-toggle").dropdown("toggle")}),o.scrollToIndex(n,!0,0)):(j.alert({message:"[[topic:no-more-next-post]]",type:"info"}),L=1)}}function N(t,n){const a=t.parent(),e=a.offset(),l=t.find(".scroller-thumb-icon").height();return n<e.top?n=e.top:n>e.top+a.height()-l&&(n=e.top+a.height()-l),n}function U(t){!y||!y.length||!y.is(":visible")||(y.each((n,a)=>{const e=$(a);if(e.is(":hidden"))return;const d=e.parent(),l=d.offset(),m=e.find(".scroller-thumb-icon").height(),r=(d.height()-m)/(ajaxify.data.postcount-1),s={top:N(e,l.top+(t-1)*r),left:e.offset().left};e.offset(s),V(e,t),nt(e,t)}),et(t),G(t))}function V(t,n){H==="xs"||H==="sm"||H==="md"?t.find(".thumb-text").text(`${n}/${ajaxify.data.postcount}`):t.find(".thumb-text").translateText(`[[topic:navigator.index, ${n}, ${ajaxify.data.postcount}]]`)}async function nt(t,n){const a=t.find(".thumb-timestamp");if(a.length){const e=await it(n);a.attr("title",utils.toISOString(e)).timeago()}}async function it(t){const n=$(`[component="post"][data-index=${t-1}]`);return n.length?parseInt(n.attr("data-timestamp"),10):await socket.emit("posts.getPostTimestampByIndex",{tid:ajaxify.data.tid,index:t-1})}function st(){if(!y.length)return;y.parent().off("click").on("click",function(r){if($(r.target).hasClass("scroller-container")){const p=$(r.target).find(".scroller-thumb"),s=n(p,r.pageY);return o.scrollToIndex(s-1,!0,0),!1}});function n(r,p){const s=r.parent(),x=r.find(".scroller-thumb-icon").height(),b=N(r,p-x/2),Q=s.offset(),Z=(b-Q.top)/(s.height()-x);return c=Math.max(1,Math.ceil(ajaxify.data.postcount*Z)),c>ajaxify.data.postcount?ajaxify.data.postcount:c}let a=!1;h.on("action:ajaxify.end",function(){X=null}),i.find(".dropdown-menu").parent().off("shown.bs.dropdown").on("shown.bs.dropdown",function(){U(c)});let e=null;const d=utils.debounce(nt,50);function l(r){if(!e||!e.length)return;const s=e.find(".scroller-thumb-icon").height(),u=N(e,r.pageY-s/2);e.offset({top:u,left:e.offset().left});const x=n(e,r.pageY);return o.updateTextAndProgressBar(),V(e,x),d(e,x),I&&m(),I=!1,r.stopPropagation(),!1}y.off("mousedown").on("mousedown",function(r){r.originalEvent.button===0&&(a=!0,e=$(this),e.addClass("active"),$(window).on("mousemove",l),I=!0)});function f(){$(window).off("mousemove",l),a&&(o.scrollToIndex(c-1,!0,0),i.find(".dropdown-menu.show").removeClass("show")),z(),a=!1,I=!1,e&&e.length&&e.removeClass("active"),e=null}function m(){z(),C=setInterval(function(){G(c)},250)}$(window).off("mousemove",l),$(window).off("mouseup",f).on("mouseup",f),y.each((r,p)=>{const s=$(p);s.off("touchstart").on("touchstart",function(u){E=!0,O=Math.min($(window).width(),Math.max(0,u.touches[0].clientX)),B=Math.min($(window).height(),Math.max(0,u.touches[0].clientY)),I=!0,s.addClass("active")}),s.off("touchmove").on("touchmove",function(u){const x=$(window).width(),b=$(window).height(),Q=Math.abs(O-Math.min(x,Math.max(0,u.touches[0].clientX))),Z=Math.abs(B-Math.min(b,Math.max(0,u.touches[0].clientY)));if(O=Math.min(x,Math.max(0,u.touches[0].clientX)),B=Math.min(b,Math.max(0,u.touches[0].clientY)),Z>=Q&&I&&(E=!0,m()),E&&u.cancelable){u.preventDefault(),u.stopPropagation();const rt=s.find(".scroller-thumb-icon").height(),lt=N(s,B+$(window).scrollTop()-rt/2);s.offset({top:lt,left:s.offset().left});const q=n(s,B+$(window).scrollTop());o.updateTextAndProgressBar(),V(s,q),d(s,q),I&&G(q)}I=!1}),s.off("touchend").on("touchend",function(){z(),E&&(s.removeClass("active"),o.scrollToIndex(c-1,!0,0),E=!1,i.find(".dropdown-menu.show").removeClass("show"))})})}async function et(t){if(!F.length||ajaxify.data.postcount<=ajaxify.data.bookmarkThreshold)return;const n=ajaxify.data.bookmark||K.getItem("topic:"+ajaxify.data.tid+":bookmark");t=Math.max(t,Math.min(n,ajaxify.data.postcount));const a=F.get(0),e=a.parentNode,d=e.getBoundingClientRect().height,l=1-t/ajaxify.data.postcount;a.style.height=`${d*l}px`;const f=e.querySelector(".scroller-thumb"),m=parseInt(f.style.height,10),r=parseInt(f.style.top||0,10)+m,p=a.querySelector(".meta a");if(M=Math.min(M,ajaxify.data.postcount-t),M>0&&d-r>=m){const s=await A.translate(`[[topic:navigator.unread, ${M}]]`);p.href=`${config.relative_path}/topic/${ajaxify.data.slug}/${Math.min(t+1,ajaxify.data.postcount)}`,p.innerText=s}else p.href=ajaxify.data.url,p.innerText=""}function z(){C&&(clearInterval(C),C=0)}async function G(t){if(!t||X===t||!i.find(".post-content").is(":visible"))return;X=t;const n=await socket.emit("posts.getPostSummaryByIndex",{tid:ajaxify.data.tid,index:t-1}),a=await app.parseAndTranslate("partials/topic/navigation-post",{post:n});i.find(".post-content").html(a).find(".timeago").timeago()}function ct(){config.usePagination||$(window).off("keydown",J).on("keydown",J)}function J(t){if(t.target.nodeName==="BODY"){if(t.shiftKey||t.ctrlKey||t.altKey)return;if(t.which===36&&o.toTop)return o.toTop(),!1;if(t.which===35&&o.toBottom)return o.toBottom(),!1}}function D(t){const a=window.location.pathname.replace(config.relative_path,"").split("/");return a[1]+"/"+a[2]+"/"+a[3]+(t?"/"+t:"")}o.getCount=()=>g,o.setCount=function(t){t=parseInt(t,10),t!==g&&(g=t,o.updateTextAndProgressBar(),U(c),S(g>0))},o.show=function(){S(!0)},o.disable=function(){g=0,c=1,o.callback=null,o.selector=null,$(window).off("scroll",o.delayedUpdate),S(!1)};function S(t){const n=ajaxify.removeRelativePath(window.location.pathname.slice(1));t&&!n.startsWith("topic")&&!n.startsWith("category")||(i.toggleClass("ready",t),i.toggleClass("noreplies",g<=1))}return o.delayedUpdate=function(){W||(W=setTimeout(function(){o.update(),W=void 0},100))},o.update=function(){let t=c;const n=$(o.selector).filter((p,s)=>!s.getAttribute("data-navigator-ignore"));n.length&&(t=parseInt(n.first().attr("data-index"),10)+1);const a=$(window).scrollTop(),e=$(window).height(),d=$(document).height(),l=a+e/2;let f=Number.MAX_VALUE;n.each(function(){const p=$(this),s=parseInt(p.attr("data-index"),10);if(s>=0){const u=Math.abs(l-(p.offset().top+p.outerHeight(!0)/2));if(u>f)return!1;u<f&&(t=s+1,f=u)}});const m=a===0&&parseInt(n.first().attr("data-index"),10)===0,r=a+e>d-100&&parseInt(n.last().attr("data-index"),10)===g-1;m?t=1:r&&(t=g),h.fire("action:navigator.update",{newIndex:t,index:c}),t!==c&&(typeof o.callback=="function"&&o.callback(t,g),c=t,o.updateTextAndProgressBar(),U(c)),S(g>0)},o.getIndex=()=>c,o.setIndex=t=>{c=t+1,typeof o.callback=="function"&&o.callback(c,g),o.updateTextAndProgressBar(),U(c)},o.updateTextAndProgressBar=function(){if(!utils.isNumber(c))return;c=c>g?g:c,config.usePagination?_.html(`<i class="fa fa-file"></i> ${ajaxify.data.pagination.currentPage} / ${ajaxify.data.pagination.pageCount}`):_.translateHtml("[[global:pagination.out-of, "+c+", "+g+"]]");const t=(c-1)/(g-1||1);tt.val(t),ot.width(t*100+"%")},o.scrollUp=function(){const t=$(window);if(config.usePagination&&t.scrollTop()<=0)return v.previousPage(function(){$("body,html").scrollTop($(document).height()-t.height())});$("body,html").animate({scrollTop:t.scrollTop()-t.height()})},o.scrollDown=function(){const t=$(window);if(config.usePagination&&t.scrollTop()>=$(document).height()-t.height())return v.nextPage();$("body,html").animate({scrollTop:t.scrollTop()+t.height()})},o.scrollTop=function(t){$(`${o.selector}[data-index="${t}"]:not([data-navigator-ignore])`).length?o.scrollToIndex(t,!0):ajaxify.go(D())},o.scrollBottom=function(t){parseInt(t,10)<0||($(`${o.selector}[data-index="${t}"]:not([data-navigator-ignore])`).length?o.scrollToIndex(t,!0):(t=parseInt(t,10)+1,ajaxify.go(D(t))))},o.scrollToIndex=function(t,n,a){const e=ajaxify.data.template.topic,d=ajaxify.data.template.category;if(!utils.isNumber(t)||!e&&!d)return;if(a=a!==void 0?a:400,o.scrollActive=!0,e&&w.get("post/anchor",t).length)return o.scrollToPostIndex(t,n,a);if(d&&$('[component="category/topic"][data-index="'+t+'"]').length)return o.scrollToTopicIndex(t,n,a);if(!config.usePagination){o.scrollActive=!1,t=parseInt(t,10)+1,ajaxify.go(D(t));return}const l=e?o.scrollToPostIndex:o.scrollToTopicIndex,f=1+Math.floor(t/config.postsPerPage);parseInt(f,10)!==ajaxify.data.pagination.currentPage?v.loadPage(f,function(){l(t,n,a)}):l(t,n,a)},o.shouldScrollToPost=function(t){if(!ajaxify.data.template.topic||t<=1)return!1;const n=$('[component="topic"] [component="post"]').first();return parseInt(n.attr("data-index"),10)!==t-1},o.scrollToPostIndex=function(t,n,a){const e=$(`[component="post"][data-index="${t}"]:not([data-navigator-ignore])`);o.scrollToElement(e,n,a,t)},o.scrollToTopicIndex=function(t,n,a){const e=$('[component="category/topic"][data-index="'+t+'"]');o.scrollToElement(e,n,a,t)},o.scrollToElement=async(t,n,a,e=null)=>{if(!t.length){o.scrollActive=!1;return}await h.fire("filter:navigator.scroll",{scrollTo:t,highlight:n,duration:a,newIndex:e+1});const d=t.outerHeight(!0),l=w.get("navbar").outerHeight(!0)||0,f=$(".topic-main-buttons").outerHeight(!0)||0,m=$(window).height();$(window).off("scroll",o.delayedUpdate),a=a!==void 0?a:400,o.scrollActive=!0;let r=!1;function p(){function u(){setTimeout(()=>{$(window).off("scroll",o.delayedUpdate).on("scroll",o.delayedUpdate),h.fire("action:navigator.scrolled",{scrollTo:t,highlight:n,duration:a,newIndex:e+1})},50)}function x(){if(r){u();return}r=!0,o.scrollActive=!1,s(),e?o.setIndex(e):o.update()}let b=0;if(d<m-l-f?b=t.offset().top-m/2+d/2:b=t.offset().top-l-f,a===0){$(window).scrollTop(b),x(),u();return}$("html, body").animate({scrollTop:b+"px"},a,x)}function s(){n&&($('[component="post"],[component="category/topic"]').removeClass("highlight"),t.addClass("highlight"),setTimeout(function(){t.removeClass("highlight")},1e4))}p()},o}.apply(R,k),P!==void 0&&(Y.exports=P)}}]);
