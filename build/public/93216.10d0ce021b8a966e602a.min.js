"use strict";(self.webpackChunknodebb=self.webpackChunknodebb||[]).push([[93216,43034],{93216:(y,H,r)=>{var k,A;k=[r(7237),r(27145),r(32230),r(85233),r(63281),r(7927),r(74344)],A=function(B,p,d,g,U,v,I){const i={};let o=!1;i.openChat=function(t,e){if(!app.user.uid)return v.error("[[error:not-logged-in]]");function s(c){i.load(c.attr("data-uuid")),i.center(c),i.focusInput(c)}g.fire("filter:chat.openChat",{modal:!0,roomId:t,uid:e}).then(c=>{if(!c.modal)return ajaxify.go(`/chats/${t}`);i.modalExists(t)?s(i.getModal(t)):I.get(`/chats/${t}`,{uid:e||app.user.uid}).then(a=>{a.users=a.users.filter(function(f){return f&&parseInt(f.uid,10)!==parseInt(app.user.uid,10)}),a.uid=e||app.user.uid,a.isSelf=!0,i.createModal(a,s)}).catch(v.error)})},i.newChat=function(t,e){function s(){I.post("/chats",{uids:[t]}).then(({roomId:c})=>{ajaxify.data.template.chats?ajaxify.go("chats/"+c):i.openChat(c),e(null,c)}).catch(v.error)}if(e=e||function(){},!app.user.uid)return v.error("[[error:not-logged-in]]");if(parseInt(t,10)===parseInt(app.user.uid,10))return v.error("[[error:cant-chat-with-yourself]]");socket.emit("modules.chats.isDnD",t,function(c,a){if(c)return v.error(c);if(!a)return s();U.confirm("[[modules:chat.confirm-chat-with-dnd-user]]",function(f){f&&s()})})},i.loadChatsDropdown=function(t){socket.emit("modules.chats.getRecentChats",{uid:app.user.uid,after:0},function(e,s){if(e)return v.error(e);const c=s.rooms.map(a=>(a&&a.teaser&&(a.teaser.timeagoLong=$.timeago(new Date(parseInt(a.teaser.timestamp,10)))),a));d.toggleTimeagoShorthand(async function(){c.forEach(h=>{h&&h.teaser&&(h.teaser.timeago=$.timeago(new Date(parseInt(h.teaser.timestamp,10))),h.teaser.timeagoShort=h.teaser.timeago)}),d.toggleTimeagoShorthand();const a=await app.parseAndTranslate("partials/chats/dropdown",{rooms:c}),f=t.get(0);t.find("*").not(".navigation-link").remove(),t.prepend(a),t.off("click").on("click","[data-roomid]",function(h){if([".user-link",".mark-read"].some(m=>h.target.closest(m)))return;const n=$(this).attr("data-roomid");ajaxify.currentPage.match(/^chats\//)?ajaxify.go("user/"+app.user.userslug+"/chats/"+n):i.openChat(n)}),f.removeEventListener("click",u),f.addEventListener("click",u),$('[component="chats/mark-all-read"]').off("click").on("click",async function(){await socket.emit("modules.chats.markAllRead"),ajaxify.data.template.chats&&$('[component="chat/nav-wrapper"] [data-roomid]').each((h,n)=>{i.markChatElUnread($(n),!1)})})})})};function u(t){if(!t.target.closest(".mark-read"))return;t.stopPropagation();const s=t.target.closest("[data-roomid]");i.toggleReadState(s)}i.toggleReadState=function(t){const e=!t.classList.contains("unread"),s=t.getAttribute("data-roomid");I[e?"put":"del"](`/chats/${s}/state`,{}).catch(c=>{v.error(c),i.markChatElUnread($(t),!e)}),i.markChatElUnread($(t),e)},i.isFromBlockedUser=function(t){return app.user.blocks.includes(parseInt(t,10))},i.isLookingAtRoom=function(t){return ajaxify.data.template.chats&&parseInt(ajaxify.data.roomId,10)===parseInt(t,10)},i.markChatElUnread=function(t,e){if(t.length>0){t.toggleClass("unread",e);const s=t.find(".mark-read");s.length&&(s.find(".read").toggleClass("hidden",e),s.find(".unread").toggleClass("hidden",!e))}},i.onChatMessageReceived=function(t){app.user.blocks.includes(parseInt(t.fromUid,10))||i.modalExists(t.roomId)&&(t.self=parseInt(app.user.uid,10)===parseInt(t.fromUid,10)?1:0,o||(o=t.self===0),t.message.self=t.self,t.message.timestamp=Math.min(Date.now(),t.message.timestamp),t.message.timestampISO=utils.toISOString(t.message.timestamp),l(t))};function l(t){const e=i.getModal(t.roomId),s=t.message.fromUser.username,c=t.self===1;r.e(46862).then(function(){var a=[r(46862)];(function(f){e.find('[data-mid="'+t.message.messageId+'"]').length||f.appendChatMessage(e.find('[component="chat/message/content"]'),t.message),e.is(":visible")?(p.updateActive(e.attr("data-uuid")),f.isAtBottom(e.find('[component="chat/message/content"]'))&&f.scrollToBottomAfterImageLoad(e.find('[component="chat/message/content"]'))):ajaxify.data.template.chats||i.toggleNew(e.attr("data-uuid"),!0,!0),!c&&(!e.is(":visible")||!app.isFocused)&&p.push("chat",e.attr("data-uuid"),{title:"[[modules:chat.chatting-with]] "+(t.roomName||s),touid:t.message.fromUser.uid,roomId:t.roomId,isSelf:!1})}).apply(null,a)}).catch(r.oe)}return i.onRoomRename=function(t){const e=i.getModal(t.roomId),s=e.find('[component="chat/room/name"]'),c=s.attr("data-icon");s.length&&s.html(t.newName?`<i class="fa ${c} text-muted"></i> ${t.newName}`:t.chatWithMessage);const a=$("<div></div>").html(t.newName).text();p.update("chat",e.attr("data-uuid"),{title:a}),g.fire("action:chat.renamed",Object.assign(t,{modal:e}))},i.onUserTyping=function(t){if(i.isFromBlockedUser(t.uid))return;const e=i.getModal(t.roomId);e.length&&i.updateTypingUserList(e,t)},i.updateTypingUserList=async function(t,{uid:e,username:s,typing:c}){const a=t.find('[component="chat/composer/typing"]'),f=a.find('[component="chat/composer/typing/users"]'),h=f.find(`[data-uid="${e}"]`);c&&!h.length?$("<div/>").attr("data-uid",e).text(s).appendTo(f):!c&&h.length&&h.remove();const n=[];f.children().each((x,C)=>{n.push($(C).text())});const m=a.find('[component="chat/composer/typing/text"]'),E=n.length>3?"n":n.length;if(E){const x=`modules:chat.user-typing-${E}`,C=d.compile.apply(null,[x,...n]);m.html(await d.translate(C))}m.toggleClass("hidden",!n.length)},i.getModal=function(t){return $("#chat-modal-"+t)},i.modalExists=function(t){return $("#chat-modal-"+t).length!==0},i.createModal=function(t,e){e=e||function(){},Promise.all([r.e(42441),r.e(61006),r.e(46862),r.e(54271),r.e(40855)]).then(function(){var s=[r(75203),r(30524),r(46862),r(57930)];(function(c,a,f,h){app.parseAndTranslate("chat",t,function(n){const m=t.roomId;if(i.modalExists(m))return e(i.getModal(t.roomId));const E=utils.generateUUID();let x=!1;n.attr("id","chat-modal-"+m),n.attr("data-roomid",m),n.attr("intervalId",0),n.attr("data-uuid",E),n.css("position","fixed"),n.appendTo($("body")),n.find(".timeago").timeago(),n.find('[data-bs-toggle="tooltip"]').tooltip({trigger:"hover",container:"#content"}),f.wrapImagesInLinks(n.find('[component="chat/messages"] .chat-content')),i.center(n),app.loadJQueryUI(function(){n.find(".modal-content").resizable({handles:"n, e, s, w, se",minHeight:250,minWidth:400}),n.find(".modal-content").on("resize",function(R,T){T.originalSize.height!==T.size.height&&n.find(".modal-body").css("height",i.calculateChatListHeight(n))}),n.draggable({start:function(){p.updateActive(E),n.css({bottom:"auto",right:"auto"})},stop:function(){i.focusInput(n)},distance:10,handle:".modal-header"})}),c.apply(n.find('[component="chat/messages"] .chat-content')),n.find("#chat-close-btn").on("click",function(){i.close(E)});function C(){const R=B.get("chat/input").val();$(window).one("action:ajaxify.end",function(){B.get("chat/input").val(R)}),ajaxify.go(`user/${app.user.userslug}/chats/${m}`),i.close(E)}n.find(".modal-header").on("dblclick",C),n.find('button[data-action="maximize"]').on("click",C),n.find('button[data-action="minimize"]').on("click",function(){const R=n.attr("data-uuid");i.minimize(R)}),n.on("mouseup",function(){p.updateActive(n.attr("data-uuid")),x&&(x=!1)}),n.on("mousemove",function(R){R.which===1&&(x=!0)}),n.on("mousemove keypress click",function(){o&&(I.del(`/chats/${m}/state`,{}),o=!1)}),a.addActionHandlers(n.find('[component="chat/message/window"]'),m),a.addRenameHandler(m,n.find('[data-action="rename"]')),a.addLeaveHandler(m,n.find('[data-action="leave"]')),a.addDeleteHandler(m,n.find('[data-action="delete"]')),a.addSendHandlers(m,n.find(".chat-input"),n.find('[data-action="send"]')),a.addManageHandler(m,n.find('[data-action="manage"]')),a.createAutoComplete(m,n.find('[component="chat/input"]')),a.addScrollHandler(m,t.uid,n.find('[component="chat/message/content"]')),a.addScrollBottomHandler(n.find('[component="chat/message/content"]')),a.addParentHandler(n.find('[component="chat/message/content"]')),a.addCharactersLeftHandler(n),a.addTextareaResizeHandler(n),a.addTypingHandler(n,m),a.addIPHandler(n),a.addTooltipHandler(n),a.addUploadHandler({dragDropAreaEl:n.find(".modal-content"),pasteEl:n,uploadFormEl:n.find('[component="chat/upload"]'),uploadBtnEl:n.find('[component="chat/upload/button"]'),inputEl:n.find('[component="chat/input"]')}),f.addSocketListeners(),h.init(m,n),a.addNotificationSettingHandler(m,n),p.push("chat",n.attr("data-uuid"),{title:"[[modules:chat.chatting-with]] "+(t.roomName||(t.users.length?t.users[0].username:"")),roomId:t.roomId,icon:"fa-comment",state:"",isSelf:t.isSelf},function(){p.toggleNew(n.attr("data-uuid"),!t.isSelf),g.fire("action:chat.loaded",n),typeof e=="function"&&e(n)})})}).apply(null,s)}).catch(r.oe)},i.focusInput=function(t){setTimeout(function(){t.find('[component="chat/input"]').focus()},20)},i.close=function(t){const e=$('.chat-modal[data-uuid="'+t+'"]');clearInterval(e.attr("intervalId")),e.attr("intervalId",0),e.remove(),e.data("modal",null),p.discard("chat",t),e.attr("data-mobile")&&i.disableMobileBehaviour(e);const s=e.attr("data-roomid");Promise.all([r.e(42441),r.e(61006),r.e(46862),r.e(54271),r.e(81018)]).then(function(){var c=[r(30524)];(function(a){a.destroyAutoComplete(s)}).apply(null,c)}).catch(r.oe),socket.emit("modules.chats.leave",s),g.fire("action:chat.closed",{uuid:t,modal:e})},i.center=function(t){const e=t.attr("data-center");if(!e||e==="false")return;let s=!1;return t.hasClass("hide")&&(t.removeClass("hide"),s=!0),t.css("left",Math.max(0,($(window).width()-$(t).outerWidth())/2+$(window).scrollLeft())+"px"),t.css("top",Math.max(0,$(window).height()/2-$(t).outerHeight()/2)+"px"),s&&t.addClass("hide"),t},i.load=function(t){r.e(46862).then(function(){var e=[r(46862)];(function(s){const c=$('.chat-modal[data-uuid="'+t+'"]');c.removeClass("hide"),p.updateActive(t),s.scrollToBottomAfterImageLoad(c.find(".chat-content")),i.focusInput(c);const a=c.attr("data-roomid");I.del(`/chats/${a}/state`,{}),socket.emit("modules.chats.enter",a);const f=utils.findBootstrapEnvironment();(f==="xs"||f==="sm")&&i.enableMobileBehaviour(c)}).apply(null,e)}).catch(r.oe)},i.enableMobileBehaviour=function(t){app.toggleNavbar(!1),t.attr("data-mobile","1");const e=t.find(".modal-body");e.css("height",i.calculateChatListHeight(t));function s(){e.css("height",i.calculateChatListHeight(t)),r.e(46862).then(function(){var c=[r(46862)];(function(a){a.scrollToBottom(t.find(".chat-content"))}).apply(null,c)}).catch(r.oe)}$(window).on("resize",s),$(window).one("action:ajaxify.start",function(){i.close(t.attr("data-uuid")),$(window).off("resize",s)})},i.disableMobileBehaviour=function(){app.toggleNavbar(!0)},i.calculateChatListHeight=function(t){return t.find(".modal-content").outerHeight()-t.find(".modal-header").outerHeight()},i.minimize=function(t){const e=$('.chat-modal[data-uuid="'+t+'"]');e.addClass("hide"),p.minimize("chat",t),clearInterval(e.attr("intervalId")),e.attr("intervalId",0),g.fire("action:chat.minimized",{uuid:t,modal:e})},i.toggleNew=p.toggleNew,i}.apply(H,k),A!==void 0&&(y.exports=A)},27145:(y,H,r)=>{y=r.nmd(y);var k,A;k=[r(32230),r(85233)],A=function(B,p){const d={};let g=!1;d.init=function(){if(d.taskbar=$('[component="taskbar"]'),d.tasklist=d.taskbar.find("ul"),!d.taskbar.length||!d.tasklist.length){g=!0;return}d.taskbar.on("click","li",async function(){const o=$(this),u=o.attr("data-module"),l=o.attr("data-uuid"),t=await app.require(u);return o.hasClass("active")?t.minimize(l):(v(),t.load(l),d.toggleNew(l,!1),d.tasklist.removeClass("active"),o.addClass("active")),!1}),$(window).on("action:app.loggedOut",function(){d.closeAll()})},d.close=async function(o,u){if(g)return;if(d.tasklist.find('[data-module="'+y+'"][data-uuid="'+u+'"]').length){const t=await app.require(o);t&&typeof t.close=="function"&&t.close(u)}},d.closeAll=function(o){if(g)return;let u="[data-uuid]";o&&(u='[data-module="'+o+'"]'+u),d.tasklist.find(u).each(function(l,t){d.close(o||t.getAttribute("data-module"),t.getAttribute("data-uuid"))})},d.discard=function(o,u){if(g)return;d.tasklist.find('[data-module="'+o+'"][data-uuid="'+u+'"]').remove(),U()},d.push=function(o,u,l,t){if(t=t||function(){},g)return t();const e=d.tasklist.find('li[data-uuid="'+u+'"]'),s={module:o,uuid:u,options:l,element:e};p.fire("filter:taskbar.push",s),!e.length&&s.module?I(s,t):t(e)},d.get=function(o){return g?[]:$('[data-module="'+o+'"]').map(function(l,t){return $(t).data()})},d.minimize=function(o,u){if(g)return;d.tasklist.find('[data-module="'+o+'"][data-uuid="'+u+'"]').toggleClass("active",!1)},d.toggleNew=function(o,u,l){if(g)return;d.tasklist.find('[data-uuid="'+o+'"]').toggleClass("new",u),l||p.fire("action:taskbar.toggleNew",o)},d.updateActive=function(o){if(g)return;const u=d.tasklist.find("li");u.removeClass("active"),u.filter('[data-uuid="'+o+'"]').addClass("active"),$("[data-uuid]:not([data-module])").toggleClass("modal-unfocused",!0),$('[data-uuid="'+o+'"]:not([data-module])').toggleClass("modal-unfocused",!1)},d.isActive=function(o){return g?!1:d.tasklist.find('li[data-uuid="'+o+'"]').hasClass("active")};function U(){if(g)return;d.tasklist.find("li").length>0?d.taskbar.attr("data-active","1"):d.taskbar.removeAttr("data-active")}function v(){g||d.tasklist.find(".active").removeClass("active")}function I(o,u){if(g)return u();B.translate(o.options.title,function(l){const t=$("<div></div>").text(l||"NodeBB Task").html(),e=$("<li></li>").addClass(o.options.className).html('<a href="#"'+(o.options.image?` style="background-image: url('`+o.options.image.replace(/&#x2F;/g,"/")+`'); background-size: cover;"`:"")+">"+(o.options.icon?'<i class="fa '+o.options.icon+'"></i> ':"")+'<span aria-label="'+t+'" component="taskbar/title">'+t+"</span></a>").attr({title:t,"data-module":o.module,"data-uuid":o.uuid}).addClass(o.options.state!==void 0?o.options.state:"active");(!o.options.state||o.options.state==="active")&&v(),d.tasklist.append(e),U(),o.element=e,e.data(o),p.fire("action:taskbar.pushed",o),u(e)})}const i=function(o,u,l){switch(u){case"title":o.find('[component="taskbar/title"]').text(l);break;case"icon":o.find("i").attr("class","fa fa-"+l);break;case"image":o.find("a").css("background-image",l?'url("'+l.replace(/&#x2F;/g,"/")+'")':"");break;case"background-color":o.find("a").css("background-color",l);break;case"color":o.find("a").css("color",l);break}};return d.update=function(o,u,l){if(g)return;const t=d.tasklist.find('[data-module="'+o+'"][data-uuid="'+u+'"]');if(!t.length)return;const e=t.data();Object.keys(l).forEach(function(s){e[s]=l[s],i(t,s,l[s])}),t.data(e)},d}.apply(H,k),A!==void 0&&(y.exports=A)}}]);
